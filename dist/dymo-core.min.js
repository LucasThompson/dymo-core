var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[$jscomp.global.Symbol.iterator])return a[$jscomp.global.Symbol.iterator]();if(!(a instanceof Array||"string"==typeof a||a instanceof String))throw new TypeError(a+" is not iterable");var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.arrayFromArguments=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b};$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if($jscomp.global.Object.defineProperties){var e=$jscomp.global.Object.getOwnPropertyDescriptor(b,d);$jscomp.global.Object.defineProperty(a,d,e)}else a[d]=b[d]};
$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};$jscomp.array.arrayIterator_=function(a,b){a instanceof String&&(a=String(a));var c=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={},e=(d.next=function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}e.next=$jscomp.array.done_;return $jscomp.array.done_()},d[Symbol.iterator]=function(){return e},d);return e};
$jscomp.array.findInternal_=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};
$jscomp.array.from=function(a,b,c){b=void 0===b?function(a){return a}:b;var d=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(a[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=a[Symbol.iterator]();for(var e;!(e=a.next()).done;)d.push(b.call(c,e.value))}else{e=a.length;for(var g=0;g<e;g++)d.push(b.call(c,a[g]))}return d};$jscomp.array.of=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return $jscomp.array.from(b)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return[a,b]})};$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(a){return a})};$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return b})};
$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)};$jscomp.array.copyWithin=function(a,b,c){var d=this.length;a=Number(a);b=Number(b);c=Number(null!=c?c:d);if(a<b)for(c=Math.min(c,d);b<c;)b in this?this[a++]=this[b++]:(delete this[a++],b++);else for(c=Math.min(c,d+b-a),a+=c-b;c>b;)--c in this?this[--a]=this[c]:delete this[a];return this};$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)};
$jscomp.array.fill=function(a,b,c){null!=c&&a.length||(c=this.length||0);c=Number(c);for(b=Number((void 0===b?0:b)||0);b<c;b++)this[b]=a;return this};$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)};$jscomp.array.find=function(a,b){return $jscomp.array.findInternal_(this,a,b).v};$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)};
$jscomp.array.findIndex=function(a,b){return $jscomp.array.findInternal_(this,a,b).i};$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)};$jscomp.Map=function(a){a=void 0===a?[]:a;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,this.set(b[0],b[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var a=$jscomp.global.Map;if(!a||!a.prototype.entries||!Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(g){return!1}};
$jscomp.Map.createHead_=function(){var a={};return a.previous=a.next=a.head=a};$jscomp.Map.getId_=function(a){if(!(a instanceof Object))return String(a);$jscomp.Map.key_ in a||a instanceof Object&&Object.isExtensible&&Object.isExtensible(a)&&$jscomp.Map.defineProperty_(a,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in a?a[$jscomp.Map.key_]:" "+a};
$jscomp.Map.prototype.set=function(a,b){var c=this.maybeGetEntry_(a),d=c.id,e=c.list,c=c.entry;e||(e=this.data_[d]=[]);c?c.value=b:(c={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},e.push(c),this.head_.previous.next=c,this.head_.previous=c,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(a){var b=this.maybeGetEntry_(a);a=b.id;var c=b.list,d=b.index;return(b=b.entry)&&c?(c.splice(d,1),c.length||delete this.data_[a],b.previous.next=b.next,b.next.previous=b.previous,b.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(a){return!!this.maybeGetEntry_(a).entry};
$jscomp.Map.prototype.get=function(a){return(a=this.maybeGetEntry_(a).entry)&&a.value};$jscomp.Map.prototype.maybeGetEntry_=function(a){var b=$jscomp.Map.getId_(a),c=this.data_[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];if(a!==a&&e.key!==e.key||a===e.key)return{id:b,list:c,index:d,entry:e}}return{id:b,list:c,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(a){return[a.key,a.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(a){return a.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(a){return a.value})};$jscomp.Map.prototype.forEach=function(a,b){for(var c=$jscomp.makeIterator(this.entries()),d=c.next();!d.done;d=c.next())d=d.value,a.call(b,d[1],d[0],this)};
$jscomp.Map.prototype.iter_=function(a){var b=this,c=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={};return d.next=function(){if(c){for(;c.head!=b.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:a(c)};c=null}return{done:!0,value:void 0}},d[Symbol.iterator]=function(){return this},d};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(a,b,c){Object.defineProperty(a,b,{value:String(c)})}:function(a,b,c){a[b]=String(c)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(a){a=Number(a)>>>0;if(0===a)return 32;var b=0;0===(a&4294901760)&&(a<<=16,b+=16);0===(a&4278190080)&&(a<<=8,b+=8);0===(a&4026531840)&&(a<<=4,b+=4);0===(a&3221225472)&&(a<<=2,b+=2);0===(a&2147483648)&&b++;return b};$jscomp.math.imul=function(a,b){a=Number(a);b=Number(b);var c=a&65535,d=b&65535;return c*d+((a>>>16&65535)*d+c*(b>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1};
$jscomp.math.log10=function(a){return Math.log(a)/Math.LN10};$jscomp.math.log2=function(a){return Math.log(a)/Math.LN2};$jscomp.math.log1p=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,c=1,d=a,e=0,g=1;e!=d;)b*=a,g*=-1,d=(e=d)+g*b/++c;return d}return Math.log(1+a)};$jscomp.math.expm1=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,c=1,d=a,e=0;e!=d;)b*=a/++c,d=(e=d)+b;return d}return Math.exp(a)-1};$jscomp.math.cosh=function(a){a=Number(a);return(Math.exp(a)+Math.exp(-a))/2};
$jscomp.math.sinh=function(a){a=Number(a);return 0===a?a:(Math.exp(a)-Math.exp(-a))/2};$jscomp.math.tanh=function(a){a=Number(a);if(0===a)return a;var b=Math.exp(2*-Math.abs(a)),b=(1-b)/(1+b);return 0>a?-b:b};$jscomp.math.acosh=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};$jscomp.math.asinh=function(a){a=Number(a);if(0===a)return a;var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return 0>a?-b:b};
$jscomp.math.atanh=function(a){a=Number(a);return($jscomp.math.log1p(a)-$jscomp.math.log1p(-a))/2};
$jscomp.math.hypot=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];a=Number(a);b=Number(b);for(var g=Math.max(Math.abs(a),Math.abs(b)),f=$jscomp.makeIterator(d),e=f.next();!e.done;e=f.next())g=Math.max(g,Math.abs(e.value));if(1E100<g||1E-100>g){a/=g;b/=g;f=a*a+b*b;d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())e=e.value,e=Number(e)/g,f+=e*e;return Math.sqrt(f)*g}g=a*a+b*b;d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())e=e.value,g+=e*e;return Math.sqrt(g)};
$jscomp.math.trunc=function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||0===a)return a;var b=Math.floor(Math.abs(a));return 0>a?-b:b};$jscomp.math.cbrt=function(a){if(0===a)return a;a=Number(a);var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a};$jscomp.number.isInteger=function(a){return $jscomp.number.isFinite(a)?a===Math.floor(a):!1};
$jscomp.number.isNaN=function(a){return"number"===typeof a&&isNaN(a)};$jscomp.number.isSafeInteger=function(a){return $jscomp.number.isInteger(a)&&Math.abs(a)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];c=$jscomp.makeIterator(c);for(d=c.next();!d.done;d=c.next()){var d=d.value,e;for(e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a};$jscomp.object.is=function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b};$jscomp.Set=function(a){a=void 0===a?[]:a;this.map_=new $jscomp.Map;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this.add(b.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var a=$jscomp.global.Set;if(!a||!a.prototype.entries||!Object.seal)return!1;var b=Object.seal({x:4}),a=new a($jscomp.makeIterator([b]));if(a.has(b)||1!=a.size||a.add(b)!=a||1!=a.size||a.add({x:4})!=a||2!=a.size)return!1;var a=a.entries(),c=a.next();if(c.done||c.value[0]!=b||c.value[1]!=b)return!1;c=a.next();return c.done||c.value[0]==b||4!=c.value[0].x||c.value[1]!=c.value[0]?!1:a.next().done};
$jscomp.Set.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(a){return this.map_.has(a)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noRegExp_=function(a,b){if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];for(var c="",b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next()){d=d.value;d=+d;if(0>d||1114111<d||d!==Math.floor(d))throw new RangeError("invalid_code_point "+d);65535>=d?c+=String.fromCharCode(d):(d-=65536,c+=String.fromCharCode(d>>>10&1023|55296),c+=String.fromCharCode(d&1023|56320))}return c};
$jscomp.string.repeat=function(a){var b=this.toString();if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=b),a>>>=1)b+=b;return c};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(a){var b=this.toString(),c=b.length;a=Number(a)||0;if(0<=a&&a<c){a|=0;var d=b.charCodeAt(a);if(55296>d||56319<d||a+1===c)return d;a=b.charCodeAt(a+1);return 56320>a||57343<a?d:1024*(d-55296)+a+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"includes");return-1!==this.toString().indexOf(a,b)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"startsWith");var c=this.toString();a+="";for(var d=c.length,e=a.length,g=Math.max(0,Math.min(b|0,c.length)),f=0;f<e&&g<d;)if(c[g++]!=a[f++])return!1;return f>=e};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(a,b){$jscomp.string.noRegExp_(a,"endsWith");var c=this.toString();a+="";void 0===b&&(b=c.length);for(var d=Math.max(0,Math.min(b|0,c.length)),e=a.length;0<e&&0<d;)if(c[--d]!=a[--e])return!1;return 0>=e};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};var SCHEDULE_AHEAD_TIME=.1,FADE_LENGTH=.02,DYMO_ONTOLOGY_URI="http://tiny.cc/dymo-ontology#";var RDFS_URI="http://www.w3.org/2000/01/rdf-schema#",CONTEXT_URI="http://tiny.cc/dymo-context/",TYPE="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",FIRST="http://www.w3.org/1999/02/22-rdf-syntax-ns#first",REST="http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",NIL="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil",DOMAIN="http://www.w3.org/2000/01/rdf-schema#domain",RANGE="http://www.w3.org/2000/01/rdf-schema#range",LABEL="http://www.w3.org/2000/01/rdf-schema#label",NAME="http://schema.org/name",
CDT="http://tiny.cc/charm-ontology#cdt",ADT="http://tiny.cc/charm-ontology#adt",VALUE="http://tiny.cc/charm-ontology#value",HAS_PART="http://tiny.cc/charm-ontology#hasPart",DYMO="http://tiny.cc/dymo-ontology#Dymo",DYMO_TYPE="http://tiny.cc/dymo-ontology#DymoType",CONJUNCTION="http://tiny.cc/dymo-ontology#Conjunction",DISJUNCTION="http://tiny.cc/dymo-ontology#Disjunction",SEQUENCE="http://tiny.cc/dymo-ontology#Sequence",FEATURE="http://tiny.cc/dymo-ontology#Feature",PARAMETER="http://tiny.cc/dymo-ontology#Parameter",
FEATURE_TYPE="http://tiny.cc/dymo-ontology#FeatureType",PARAMETER_TYPE="http://tiny.cc/dymo-ontology#ParameterType",LEVEL_FEATURE="http://tiny.cc/dymo-ontology#LevelFeature",INDEX_FEATURE="http://tiny.cc/dymo-ontology#IndexFeature",ONSET_FEATURE="http://tiny.cc/dymo-ontology#OnsetFeature",DURATION_FEATURE="http://tiny.cc/dymo-ontology#DurationFeature",TIME_FEATURE="http://tiny.cc/dymo-ontology#TimeFeature",SEGMENT_LABEL_FEATURE="http://tiny.cc/dymo-ontology#SegmentLabelFeature",CUSTOM_FEATURE="http://tiny.cc/dymo-ontology#CustomFeature",
AUDIO_PARAMETER="http://tiny.cc/dymo-ontology#AudioParameter",HAS_STANDARD_VALUE="http://tiny.cc/dymo-ontology#hasStandardValue",IS_INTEGER="http://tiny.cc/dymo-ontology#isInteger",PLAY="http://tiny.cc/dymo-ontology#Play",LOOP="http://tiny.cc/dymo-ontology#Loop",ONSET="http://tiny.cc/dymo-ontology#Onset",DURATION_RATIO="http://tiny.cc/dymo-ontology#DurationRatio",AMPLITUDE="http://tiny.cc/dymo-ontology#Amplitude",PLAYBACK_RATE="http://tiny.cc/dymo-ontology#PlaybackRate",TIME_STRETCH_RATIO="http://tiny.cc/dymo-ontology#TimeStretchRatio",
PAN="http://tiny.cc/dymo-ontology#Pan",DISTANCE="http://tiny.cc/dymo-ontology#Distance",HEIGHT="http://tiny.cc/dymo-ontology#Height",REVERB="http://tiny.cc/dymo-ontology#Reverb",DELAY="http://tiny.cc/dymo-ontology#Delay",FILTER="http://tiny.cc/dymo-ontology#Filter",STRUCTURAL_PARAMETER="http://tiny.cc/dymo-ontology#StructuralParameter",PART_COUNT="http://tiny.cc/dymo-ontology#PartCount",PART_DURATION_RATIO="http://tiny.cc/dymo-ontology#PartDurationRatio",PART_PROPORTION="http://tiny.cc/dymo-ontology#PartProportion",
CUSTOM_PARAMETER="http://tiny.cc/dymo-ontology#CustomParameter",HAS_SOURCE="http://tiny.cc/dymo-ontology#hasSource",HAS_PARAMETER="http://tiny.cc/dymo-ontology#hasParameter",HAS_FEATURE="http://tiny.cc/dymo-ontology#hasFeature",HAS_PARAMETER_TYPE="http://tiny.cc/dymo-ontology#hasParameterType",HAS_FEATURE_TYPE="http://tiny.cc/dymo-ontology#hasFeatureType",HAS_SIMILAR="http://tiny.cc/dymo-ontology#hasSimilar",HAS_SUCCESSOR="http://tiny.cc/dymo-ontology#hasSuccessor",RENDERING="http://tiny.cc/mobile-audio-ontology#Rendering",
MAPPING="http://tiny.cc/mobile-audio-ontology#Mapping",FUNCTION="http://tiny.cc/mobile-audio-ontology#Function",MOBILE_CONTROL="http://tiny.cc/mobile-audio-ontology#MobileControl",SENSOR_CONTROL="http://tiny.cc/mobile-audio-ontology#SensorControl",UI_CONTROL="http://tiny.cc/mobile-audio-ontology#UiControl",AUTO_CONTROL="http://tiny.cc/mobile-audio-ontology#AutoControl",ACCELEROMETER_X="http://tiny.cc/mobile-audio-ontology#AccelerometerX",ACCELEROMETER_Y="http://tiny.cc/mobile-audio-ontology#AccelerometerY",
ACCELEROMETER_Z="http://tiny.cc/mobile-audio-ontology#AccelerometerZ",TILT_X="http://tiny.cc/mobile-audio-ontology#TiltX",TILT_Y="http://tiny.cc/mobile-audio-ontology#TiltY",TILT_Z="http://tiny.cc/mobile-audio-ontology#TiltZ",GEOLOCATION_LATITUDE="http://tiny.cc/mobile-audio-ontology#GeolocationLatitude",GEOLOCATION_LONGITUDE="http://tiny.cc/mobile-audio-ontology#GeolocationLongitude",GEOLOCATION_DISTANCE="http://tiny.cc/mobile-audio-ontology#GeolocationDistance",COMPASS_HEADING="http://tiny.cc/mobile-audio-ontology#CompassHeading",
BEACON="http://tiny.cc/mobile-audio-ontology#Beacon",SLIDER="http://tiny.cc/mobile-audio-ontology#Slider",TOGGLE="http://tiny.cc/mobile-audio-ontology#Toggle",BUTTON="http://tiny.cc/mobile-audio-ontology#Button",CUSTOM_CONTROL="http://tiny.cc/mobile-audio-ontology#CustomControl",RANDOM="http://tiny.cc/mobile-audio-ontology#Random",BROWNIAN="http://tiny.cc/mobile-audio-ontology#Brownian",RAMP="http://tiny.cc/mobile-audio-ontology#Ramp",MOBILE_PARAMETER="http://tiny.cc/mobile-audio-ontology#MobileParameter",
GLOBAL_PARAMETER="http://tiny.cc/mobile-audio-ontology#GlobalParameter",CONTROL_PARAMETER="http://tiny.cc/mobile-audio-ontology#ControlParameter",LISTENER_ORIENTATION="http://tiny.cc/mobile-audio-ontology#ListenerOrientation",AUTO_CONTROL_FREQUENCY="http://tiny.cc/mobile-audio-ontology#AutoControlFrequency",AUTO_CONTROL_TRIGGER="http://tiny.cc/mobile-audio-ontology#AutoControlTrigger",BROWNIAN_MAX_STEP_SIZE="http://tiny.cc/mobile-audio-ontology#BrownianMaxStepSize",LEAPING_PROBABILITY="http://tiny.cc/mobile-audio-ontology#LeapingProbability",
CONTINUE_AFTER_LEAPING="http://tiny.cc/mobile-audio-ontology#ContinueAfterLeaping",NAVIGATOR="http://tiny.cc/mobile-audio-ontology#Navigator",ONE_SHOT_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#OneShotNavigator",REPEATED_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#RepeatedNavigator",SEQUENTIAL_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#SequentialNavigator",SIMILARITY_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#SimilarityNavigator",GRAPH_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#GraphNavigator",
DOMAIN_DIMENSION="http://tiny.cc/mobile-audio-ontology#DomainDimension",MAPPING_TARGET="http://tiny.cc/mobile-audio-ontology#MappingTarget",MAPPING_RANGE="http://tiny.cc/mobile-audio-ontology#MappingRange",MAPPING_OWNERS="http://tiny.cc/mobile-audio-ontology#MappingOwners",HAS_DYMO="http://tiny.cc/mobile-audio-ontology#hasDymo",HAS_MAPPING="http://tiny.cc/mobile-audio-ontology#hasMapping",HAS_DOMAIN_DIMENSION="http://tiny.cc/mobile-audio-ontology#hasDomainDimension",HAS_FUNCTION="http://tiny.cc/mobile-audio-ontology#hasFunction",
HAS_ARGUMENT="http://tiny.cc/mobile-audio-ontology#hasArgument",HAS_BODY="http://tiny.cc/mobile-audio-ontology#hasBody",TO_TARGET="http://tiny.cc/mobile-audio-ontology#toTarget",HAS_RANGE="http://tiny.cc/mobile-audio-ontology#hasRange",IS_RELATIVE="http://tiny.cc/mobile-audio-ontology#isRelative",HAS_INITIAL_VALUE="http://tiny.cc/mobile-audio-ontology#hasInitialValue",IS_SMOOTH="http://tiny.cc/mobile-audio-ontology#isSmooth",IS_AVERAGE_OF="http://tiny.cc/mobile-audio-ontology#isAverageOf",HAS_UUID=
"http://tiny.cc/mobile-audio-ontology#hasUuid",HAS_MAJOR="http://tiny.cc/mobile-audio-ontology#hasMajor",HAS_MINOR="http://tiny.cc/mobile-audio-ontology#hasMinor",HAS_DURATION="http://tiny.cc/mobile-audio-ontology#hasDuration",HAS_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#hasNavigator",NAV_DYMOS="http://tiny.cc/mobile-audio-ontology#navDymos";function DymoManager(a,b,c,d,e){function g(a,b){m=b[0];m.dymos=a[0];k=a[1];for(var e in b[1]){var g=b[1][e];h.isSubclassOf(g.getType(),UI_CONTROL)&&(n[e]=new UIControl(g,d));h.isSubclassOf(g.getType(),SENSOR_CONTROL)&&(p[e]=g)}c||(c="bower_components/dymo-core/audio/impulse_rev.wav");f.initEffectSends(h,c)}var f=new Scheduler(a,e);isNaN(b)||(SCHEDULE_AHEAD_TIME=b);var h,k,m,n={},p={};this.loadDymoAndRenderingFromStore=function(a,b){h=a;var c=new DymoLoader(f);c.setStore(h);g(c.createDymoFromStore(),
c.createRenderingFromStore());f.loadBuffers(m.dymos,b)};this.loadDymoAndRendering=function(a,b,c,d){var e=new DymoLoader(f,function(){e.loadDymoFromJson(a,function(a){e.loadRenderingFromJson(b,function(b){h=e.getStore();g(a,b);f.loadBuffers(m.dymos,d);c&&c()})})})};this.loadDymoFromJson=function(a,b){var c=new DymoLoader(f,function(){c.loadDymoFromJson(a,function(a){b&&b(a[0][0])})})};this.parseDymoFromJson=function(a,b){var c=new DymoLoader(f,function(){c.parseDymoFromJson(a,function(a){b(a[0][0])})})};
this.replacePartOfTopDymo=function(a,b){var c=m.dymos[0].getPart(a);m.dymos[0].replacePart(a,b);f.stop(c)};this.updateNavigatorPosition=function(a,b,c){f.updateNavigatorPosition(a,b,c)};this.getNavigatorPosition=function(a,b){return f.getNavigatorPosition(a,b)};this.syncNavigators=function(a,b,c){f.syncNavigators(a,b,c)};this.startPlayingUri=function(a){f.play(k[a])};this.stopPlayingUri=function(a){f.stop(k[a])};this.startPlaying=function(){for(var a=0;a<m.dymos.length;a++)m.dymos[a].updatePartOrder(ONSET),
f.play(m.dymos[a],m.getNavigator())};this.stopPlaying=function(){for(var a=0;a<m.dymos.length;a++)f.stop(m.dymos[a])};this.getTopDymo=function(){return m.dymos[0]};this.getRendering=function(){return m};this.getUIControls=function(){return n};this.getUIControl=function(a){return n[a]};this.getSensorControls=function(){return p}};var URI_TO_TERM={"http://tiny.cc/dymo-ontology#LevelFeature":"level","http://tiny.cc/dymo-ontology#IndexFeature":"index","http://tiny.cc/dymo-ontology#OnsetFeature":"onset","http://tiny.cc/dymo-ontology#DurationFeature":"duration","http://tiny.cc/dymo-ontology#TimeFeature":"time","http://tiny.cc/dymo-ontology#SegmentLabelFeature":"segmentLabel","http://tiny.cc/dymo-ontology#hasSource":"source","http://tiny.cc/dymo-ontology#hasParameter":"parameters","http://tiny.cc/dymo-ontology#hasFeature":"features",
"http://tiny.cc/dymo-ontology#hasParameterType":"paramType","http://tiny.cc/dymo-ontology#hasFeatureType":"featureType","http://tiny.cc/dymo-ontology#hasSimilar":"similars","http://tiny.cc/dymo-ontology#hasSuccessor":"successors","http://tiny.cc/mobile-audio-ontology#hasDymo":"dymo","http://tiny.cc/mobile-audio-ontology#hasMapping":"mappings","http://tiny.cc/mobile-audio-ontology#hasDomainDimension":"domainDims","http://tiny.cc/mobile-audio-ontology#hasFunction":"function","http://tiny.cc/mobile-audio-ontology#hasArgument":"args",
"http://tiny.cc/mobile-audio-ontology#hasBody":"body","http://tiny.cc/mobile-audio-ontology#toTarget":"targets","http://tiny.cc/mobile-audio-ontology#hasRange":"range","http://tiny.cc/mobile-audio-ontology#isRelative":"relative","http://tiny.cc/mobile-audio-ontology#hasInitialValue":"init","http://tiny.cc/mobile-audio-ontology#isSmooth":"smooth","http://tiny.cc/mobile-audio-ontology#isAverageOf":"average","http://tiny.cc/mobile-audio-ontology#hasUuid":"uuid","http://tiny.cc/mobile-audio-ontology#hasMajor":"major",
"http://tiny.cc/mobile-audio-ontology#hasMinor":"minor","http://tiny.cc/mobile-audio-ontology#hasDuration":"rampDuration","http://tiny.cc/mobile-audio-ontology#hasNavigator":"navigators","http://tiny.cc/mobile-audio-ontology#navDymos":"dymos"};function AutoControl(a,b,c){function d(a){var b=a.getName();g[b]=a;g[b].addObserver(e)}var e=this,g={};d(new Parameter(AUTO_CONTROL_FREQUENCY,100));d(new Parameter(AUTO_CONTROL_TRIGGER,0));Control.call(this,a,AUTO_CONTROL,g);var f;this.addParameter=d;this.getParameter=function(a){return g[a]};this.startUpdate=function(){f=setInterval(b,g[AUTO_CONTROL_FREQUENCY].getValue())};this.reset=function(){clearInterval(f);f=null;c&&c()};this.observedParameterChanged=function(a){a==g[AUTO_CONTROL_FREQUENCY]?
f&&(this.reset(),this.startUpdate()):a==g[AUTO_CONTROL_TRIGGER]&&(f?this.reset():this.startUpdate())}}inheritPrototype(AutoControl,Control);function BrownianControl(a){var b=this;a||(a=.5);AutoControl.call(this,BROWNIAN,function(){var a=b.getParameter(BROWNIAN_MAX_STEP_SIZE).getValue(),a=2*a*Math.random()-a,a=b.getValue()+a,a=Math.min(Math.max(a,0),1);b.update(a)});this.addParameter(new Parameter(BROWNIAN_MAX_STEP_SIZE,.1));this.update(a);this.startUpdate()}inheritPrototype(BrownianControl,AutoControl);function RampControl(a,b){var c=this;a||(a=1E4);var d=0;b&&(d=b);var e=1!=d;AutoControl.call(this,RAMP,function(){var b=1/a*c.getParameter(AUTO_CONTROL_FREQUENCY).getValue();e||(b*=-1);d+=b;0<d&&1>d?c.update(d):1<=d?(c.update(1),c.reset()):0>=d&&(c.update(0),c.reset())},function(){e=!e});this.update(d)}inheritPrototype(RampControl,AutoControl);function RandomControl(){var a=this;AutoControl.call(this,RANDOM,function(){a.update(Math.random())});this.startUpdate()}inheritPrototype(RandomControl,AutoControl);function UIControl(a,b){var c=this;this.value=a.getValue();a.setUpdateFunction(function(a){c.value=a;b&&setTimeout(function(){b.$apply()},10)});this.getName=function(){return a.getName()};this.getType=function(){return a.getType()};this.update=function(){a.getType()==BUTTON&&(isNaN(this.value)&&(this.value=0),this.value=1-this.value);1==this.value?a.update(1):0==this.value?a.update(0):a.update(this.value)}};function DymoNode(a,b,c,d){this.POSITION_PARAMS=[PAN,HEIGHT,DISTANCE];this.dymo=a;this.parameters={};this.init(b,c,d)}
DymoNode.prototype.init=function(a,b,c){this.dryGain=a.createGain();this.addParameter(AMPLITUDE,this.dryGain.gain);b&&(this.reverbGain=this.createGain(a,this.dryGain,b),this.addParameter(REVERB,this.reverbGain.gain));c&&(this.delayGain=this.createGain(a,this.dryGain,c),this.addParameter(DELAY,this.delayGain.gain));if(this.dymo.getParameter(PAN)||this.dymo.getParameter(HEIGHT)||this.dymo.getParameter(DISTANCE))this.panner=a.createPanner(),this.panner.connect(this.dryGain),this.addParameter(PAN,{value:0}),
this.addParameter(HEIGHT,{value:0}),this.addParameter(DISTANCE,{value:0});this.dymo.getParameter(FILTER)&&(this.filter=a.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency.value=2E4,this.panner?this.filter.connect(this.panner):this.filter.connect(this.dryGain),this.addParameter(FILTER,this.filter.frequency))};DymoNode.prototype.createGain=function(a,b,c){a=a.createGain();a.connect(c);a.gain.value=0;b.connect(a);return a};
DymoNode.prototype.addParameter=function(a,b){this.parameters[a]=b;if(this.dymo.hasParameter(a)){var c=this.dymo.getParameter(a);this.setParameter(a,c.getValue());c.addObserver(this)}};
DymoNode.prototype.setParameter=function(a,b){isNaN(b)||(this.parameters[a]&&(this.parameters[a].value||0==this.parameters[a].value?this.parameters[a].value=b:this.parameters[a].setValue(b)),0<=this.POSITION_PARAMS.indexOf(a)&&this.parameters[PAN]&&this.parameters[HEIGHT]&&this.parameters[DISTANCE]&&(0==this.parameters[DISTANCE].value&&(this.parameters[DISTANCE].value=-.01),this.panner.setPosition(this.parameters[PAN].value,this.parameters[HEIGHT].value,this.parameters[DISTANCE].value)))};
DymoNode.prototype.getDymo=function(){return this.dymo};DymoNode.prototype.observedParameterChanged=function(a){this.setParameter(a.getName(),a.getValue())};DymoNode.prototype.getParameterValue=function(a){if(this.parameters[a])return this.parameters[a].value||0==this.parameters[a].value?this.parameters[a].value:this.parameters[a].getValue()};DymoNode.prototype.getInput=function(){return this.filter?this.filter:this.panner?this.panner:this.dryGain};DymoNode.prototype.connect=function(a){this.dryGain.connect(a)};
DymoNode.prototype.removeAndDisconnect=function(){for(var a in this.parameters){var b=this.dymo.getParameter(a);b&&b.removeObserver(this)}this.dryGain.disconnect();this.reverbGain&&this.reverbGain.disconnect();this.delayGain&&this.delayGain.disconnect()};function AudioProcessor(a){function b(a){return{extract:function(b,e,g){for(var f=[],h=0;h<a.numberOfChannels;h++)f.push(a.getChannelData(h));for(h=0;h<e;h++)for(var k=0;k<f.length;k++)b[h*f.length+k%f.length]=f[k][h+g];return Math.min(e,f[0].length-g)}}}this.timeStretch=function(c,d){var e=new SoundTouch(c.sampleRate);e.tempo=d;for(var g=b(c),e=new SimpleFilter(g,e),g=a.createBuffer(c.numberOfChannels,1/d*c.length,c.sampleRate),f=[],h=0;h<c.numberOfChannels;h++)f.push(g.getChannelData(h));for(var k=
new Float32Array(2048),m=e.extract(k,1024),n=0;m;){for(h=0;h<m;h++)for(var p=0;p<f.length;p++)f[p][h+n]=k[h*f.length+p%f.length];n+=m;m=e.extract(k,1024)}return g}};function AudioProcessorSource(a,b,c){var d=this,e=new SoundTouch(b.sampleRate);this.stretchRatio={setValue:function(a){e.tempo=a},getValue:function(){return e.tempo}};this.playbackRate={setValue:function(a){e.rate=a},getValue:function(){return e.rate}};var g=new SimpleFilter({extract:function(a,c,d){for(var f=[],e=0;e<b.numberOfChannels;e++)f.push(b.getChannelData(e));for(e=0;e<c;e++)for(var g=0;g<f.length;g++)a[e*f.length+g%f.length]=f[g][e+d];return Math.min(c,f[0].length-d)}},e),f=a.createScriptProcessor(1024,
2,b.numberOfChannels),h=new Float32Array(2048);f.onaudioprocess=function(a){for(var c=[],f=0;f<b.numberOfChannels;f++)c.push(a.outputBuffer.getChannelData(f));a=g.extract(h,1024);0==a&&d.stop();for(f=0;f<a;f++)for(var e=0;e<c.length;e++)c[e][f]=h[f*c.length+e%c.length]};this.start=function(a){setTimeout(function(){f.connect(c)},a)};this.stop=function(){f.disconnect()}};function Scheduler(a,b){function c(a){f.splice(f.indexOf(a),1)}function d(){for(var a=[],c=0;c<f.length;c++)for(var d=$jscomp.makeIterator(f[c].getAllSources().keys()),e=d.next();!e.done;e=d.next())for(e=e.value;null!=e;)0>a.indexOf(e.getUri())&&a.push(e.getUri()),e=e.getParent();a.sort();h=a;b&&b(h)}function e(b,c){m++;var d=new XMLHttpRequest;d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){a.decodeAudioData(d.response,function(a){c(a,b)})};d.error=function(){};d.send()}var g=
{},f=[],h=[];this.listenerOrientation=new Parameter(LISTENER_ORIENTATION,0);this.listenerOrientation.addObserver(this);var k,m=0;this.initEffectSends=function(b,c){0<b.find(null,null,REVERB).length&&(k=a.createConvolver(),k.connect(a.destination),e(c,function(a){k.buffer=a;0<m&&m--}));if(0<b.find(null,null,DELAY).length){var d=a.createDelay();d.delayTime.value=.5;d.connect(a.destination);var f=a.createGain();f.gain.value=.6;d.connect(f);f.connect(d)}};this.loadBuffers=function(a,b){for(var c=[],d=
0,f=a.length;d<f;d++)c=c.concat(a[d].getAllSourcePaths());d=0;for(f=c.length;d<f;d++)g[c[d]]||e(c[d],function(a,c){g[c]=a;0<m&&m--;0==m&&b&&b()});0==m&&b&&b()};this.getBuffer=function(a){return g[a.getSourcePath()]};this.getParameter=function(a){if(a==LISTENER_ORIENTATION)return this.listenerOrientation};this.updateNavigatorPosition=function(a,b,c){for(var d=0,e=f.length;d<e;d++)f[d].hasDymo(a)&&f[d].getNavigator().setPosition(c,b,a)};this.getNavigatorPosition=function(a,b){for(var c=0,d=f.length;c<
d;c++)if(f[c].hasDymo(a))return f[c].getNavigator().getPosition(b,a)};this.syncNavigators=function(a,b,c){for(var d,e,g=0,h=f.length;g<h;g++)f[g].hasDymo(a)&&(d=f[g].getNavigator()),f[g].hasDymo(b)&&(e=f[g].getNavigator());e&&(b=e.getPosition(c,b),d.setPosition(b,c,a))};this.play=function(b,e){var h=new SchedulerThread(b,e,a,g,k,void 0,d,c);f.push(h)};this.pause=function(a){if(a)for(var b=0;b<f.length;b++)f[b].pause(a)};this.stop=function(a){if(a)for(var b=0;b<f.length;b++)f[b].stop(a)};this.getSources=
function(a){for(var b=[],c=0;c<f.length;c++){var d=f[c].getSources(a);if(d)for(var e=0;e<d.length;e++)b=b.concat(d)}return b};this.getUrisOfPlayingDymos=function(){return h};this.observedParameterChanged=function(b){b=this.listenerOrientation.getValue()/180*Math.PI;a.listener.setOrientation(Math.sin(b),0,-Math.cos(b),0,1,0)}};function DymoSource(a,b,c,d,e,g){function f(b,d){var f=b[0],e=b[1],e=1!=d?e+.3:e+FADE_LENGTH;if(c||isNaN(f+e)){if(0!=f||e<c.duration)c=n(c,m(f,c),m(e,c));return h(c,e,d)}p(a.getSourcePath(),f,f+e,function(a){return h(a,e,d)})}function h(a,c,d){1!=d&&(a=(new AudioProcessor(b)).timeStretch(a,d),a=n(a,0,m(c/d+FADE_LENGTH,a)));c=a;d=a.length;for(var f=c.sampleRate*FADE_LENGTH,e=0;e<c.numberOfChannels;e++)for(var g=c.getChannelData(e),h=0;h<f;h++)g[h]*=h/f,g[d-h-1]*=h/f;return a}function k(){u=!1;var a=
b.currentTime;l.parameters[AMPLITUDE].setValueAtTime(l.parameters[AMPLITUDE].value,a);l.parameters[AMPLITUDE].linearRampToValueAtTime(0,a+FADE_LENGTH);v.stop(a+2*FADE_LENGTH)}function m(a,b){if(a||0==a)return Math.round(a*b.sampleRate)}function n(a,c,d){d=Math.min(a.length-c,d);for(var f=b.createBuffer(a.numberOfChannels,d,a.sampleRate),e=0;e<a.numberOfChannels;e++)for(var g=f.getChannelData(e),h=a.getChannelData(e),k=0;k<d;k++)g[k]=h[c+k];return f}function p(a,b,c,d){var f=a.lastIndexOf("/");f&&
(a=a.substring(f+1));r("http://localhost:8060/getAudioChunk?filename="+a+"&fromSecond="+b+"&toSecond="+c,function(a){d(a)})}function r(a,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){b.decodeAudioData(d.response,function(a){c(a)},function(a){console.log("audio from server is faulty")})};d.send()}DymoNode.call(this,a,b,d,e);var l=this,u,q,t,v=b.createBufferSource();v.connect(this.getInput());(function(){var b=a.getSegment();b[0]||(b[0]=0);!b[1]&&c&&
(b[1]=c.duration-b[0]);if(a.hasParameter(DURATION_RATIO)){var d=a.getParameter(DURATION_RATIO).getValue();0<d&&1>d&&(b[1]*=d)}t=b[1];d=a.hasParameter(TIME_STRETCH_RATIO)?a.getParameter(TIME_STRETCH_RATIO).getValue():1;v.buffer=f(b,d)})();this.addParameter(PLAYBACK_RATE,v.playbackRate);this.addParameter(TIME_STRETCH_RATIO,{value:0});this.addParameter(LOOP,{value:0});this.getDuration=function(){return t};this.isLoopingAndPlaying=function(){return v.loop&&u};this.play=function(a){v.onended=function(){v.disconnect();
l.removeAndDisconnect();g&&g(l)};a||(a=0);v.start(a);u=!0};this.pause=function(){u?(k(),q=!0):q&&(q=!1,this.play())};this.stop=function(){u&&k()}}inheritPrototype(DymoSource,DymoNode);function SchedulerThread(a,b,c,d,e,g,f,h){function k(){x=v?v:l();m(x);if(!z){var a=x.keys().next().value;a.hasParameter(ONSET)&&(z=a.getParameter(ONSET).getValue())}a=w?w-c.currentTime:SCHEDULE_AHEAD_TIME;for(var b=c.currentTime+a,d=$jscomp.makeIterator(x.values()),e=d.next();!e.done;e=d.next())e.value.play(b);setTimeout(function(){f()},a);(v=l())&&0<v.size?(w=r(b),a=w[1],w=w[0],a.getDymo().hasParameter(LOOP)&&a.getDymo().getParameter(LOOP).getValue()&&(w-=FADE_LENGTH),a=1E3*(w-c.currentTime-SCHEDULE_AHEAD_TIME),
y=setTimeout(function(){k()},a)):(w=r(b),a=1E3*(w-c.currentTime),setTimeout(function(){p()},a+100))}function m(a){for(var b=$jscomp.makeIterator(a.keys()),c=b.next();!c.done;c=b.next())c=c.value,q.get(c)||q.set(c,[]),q.get(c).push(a.get(c))}function n(a){var b=q.get(a.getDymo());b.splice(b.indexOf(a),1);0>=b.length&&q.delete(a.getDymo());f();p()}function p(){if(0==q.size&&(!v||0==v.size)){window.clearTimeout(y);b.reset();for(var c=a.getAllDymosInHierarchy(),d=0,f=c.length;d<f;d++){var e=t.get(c[d]);
e&&e.removeAndDisconnect()}h&&h()}}function r(a){if(v){var b=v.keys().next().value,c;b.hasParameter(ONSET)&&(c=b.getParameter(ONSET).getValue());b=c-z;z=c;if(!isNaN(c))return a+b}c=0;for(var d,b=$jscomp.makeIterator(x.values()),f=b.next();!f.done;f=b.next()){var f=f.value,e=f.getDuration();e>c&&(c=e,d=f)}return[a+c,d]}function l(){var a=b.getNextParts();if(a){console.log(a.map(function(a){return isNaN(a.getIndex())?"top":a.getIndex()}));for(var f=new Map,w=0;w<a.length;w++)if(a[w].getSourcePath()){var h=
d[a[w].getSourcePath()],h=new DymoSource(a[w],c,h,e,g,n);u(h);f.set(a[w],h)}return f}}function u(a){var b=a;for(a=a.getDymo().getParent();a;){if(t.has(a)){b.connect(t.get(a).getInput());return}var d=new DymoNode(a,c,e,g);b.connect(d.getInput());t.set(a,d);a=a.getParent();b=d}b.connect(c.destination)}var q=new Map,t=new Map,v,y,x=[],w,z;b||(b=new DymoNavigator(a,new SequentialNavigator(a)));k();this.hasDymo=function(b){if(a.getAllDymosInHierarchy().indexOf(b))return!0};this.getNavigator=function(){return b};
this.stop=function(a){a=a.getAllDymosInHierarchy();for(var b=0,c=a.length;b<c;b++){var d=q.get(a[b]);if(d)for(var f=0;f<d.length;f++)d[f].stop();v&&(v.delete(a[b]),0>=v.size&&(v=void 0))}};this.getAllSources=function(){return q};this.getSources=function(a){return q.get(a)}};function OntologyLoader2(a,b,c){};function DymoLoader(a,b){function c(a,b){d(a,"",function(a){l.loadData(a,!0,b)})}function d(a,b,c){loadFile(a,function(f){if(0>f.indexOf("Cannot GET")){var g;a:{try{JSON.parse(f)}catch(h){g=!1;break a}g=!0}g&&(b?(0<=a.indexOf(u)&&(a=a.replace(u,"")),b=b.replace('"'+a+'"',f)):b=f);(f=e(b))?(0>f.indexOf(u)&&(f=u+f),d(f,b,c)):b&&c(JSON.parse(b))}})}function e(a){var b=a.indexOf(".json");if(0<=b){if(b!=a.indexOf("context.json")+7){var c=a.substring(0,b).lastIndexOf('"');return a.substring(c+1,b+5)}return e(a.substring(b+
1))}}function g(b){var c=l.findFirstObjectUri(b,CDT),c=new DynamicMusicObject(b,c,a);c.setBasePath(u);t[b]=c;c.setSourcePath(l.findFirstObjectValue(b,HAS_SOURCE));for(var d=l.findAllObjectUris(b,HAS_FEATURE),f=0;f<d.length;f++)l.findFirstObjectUri(d[f],TYPE),c.setFeature(l.findFirstObjectUri(d[f],TYPE),l.findFeatureValue(d[f]));d=l.findAllObjectUris(b,HAS_PARAMETER);for(f=0;f<d.length;f++)n(c,l.findFirstObjectUri(d[f],TYPE),l.findFirstObjectValue(d[f],VALUE));b=l.findParts(b);for(f=0;f<b.length;f++)c.addPart(g(b[f]));
return c}function f(a){for(var b=t[a],c=l.findAllObjectUris(a,HAS_SIMILAR),d=0;d<c.length;d++)b.addSimilar(t[c[d]]);c=l.findAllObjectUris(a,HAS_SUCCESSOR);for(d=0;d<c.length;d++)b.addSuccessor(t[c[d]]);c=l.findAllObjectUris(a,HAS_MAPPING);h(c);for(d=0;d<c.length;d++)b.addMapping(k(c[d],b));a=l.findParts(a);for(d=0;d<a.length;d++)f(a[d])}function h(a){for(var b=0;b<a.length;b++)for(var c=l.findAllObjectUris(a[b],HAS_DOMAIN_DIMENSION),d=0;d<c.length;d++){var f=l.findFirstObjectUri(c[d],TYPE),e=l.findFirstObjectValue(c[d],
NAME);e||(e=c[d]);if(l.isSubclassOf(f,MOBILE_CONTROL)&&!q[c[d]]){var g=c[d],h=f,f=void 0;h==ACCELEROMETER_X||h==ACCELEROMETER_Y||h==ACCELEROMETER_Z?f=new AccelerometerControl(h):h==TILT_X||h==TILT_Y?f=new TiltControl(h):h==GEOLOCATION_LATITUDE||h==GEOLOCATION_LONGITUDE?f=new GeolocationControl(h):h==GEOLOCATION_DISTANCE?f=new DistanceControl:h==COMPASS_HEADING?f=new CompassControl:h==BEACON?(f=l.findFirstObjectValue(g,HAS_UUID),e=l.findFirstObjectValue(g,HAS_MAJOR),h=l.findFirstObjectValue(g,HAS_MINOR),
f=new BeaconControl(f,e,h)):h==SLIDER||h==TOGGLE||h==BUTTON||h==CUSTOM_CONTROL?(f=new Control(e,h),e=l.findFirstObjectValue(g,HAS_INITIAL_VALUE),f.update(e)):h==RANDOM?f=new RandomControl:h==BROWNIAN?(e=l.findFirstObjectValue(g,HAS_INITIAL_VALUE),f=new BrownianControl(e)):h==RAMP&&(f=Math.round(1E3*l.findFirstObjectUri(g,HAS_DURATION)),e=l.findFirstObjectValue(g,HAS_INITIAL_VALUE),f=new RampControl(f,e));l.findFirstObjectValue(g,IS_SMOOTH)&&f.setSmooth&&f.setSmooth(!0);g=l.findFirstObjectValue(g,
IS_AVERAGE_OF);!isNaN(g)&&f.setAverageOf&&f.setAverageOf(g);q[c[d]]=f}}}function k(b,c){var d=l.findAllObjectUris(b,TO_TARGET);if(0<d.length){var f=[],e=l.findFunction(d[0]);if(e)d=Object.keys(t).map(function(a){return t[a]}),Array.prototype.push.apply(f,d.filter(e));else for(var h=0;h<d.length;h++)l.findFirstObjectUri(d[h],TYPE)==DYMO?f.push(t[d[h]]):f.push(q[d[h]]);return m(b,c,f,e)}return m(b,c,[a])}function m(a,b,c,d){for(var f=l.findFirstObjectUri(a,IS_RELATIVE),e=[],h=l.findAllObjectUris(a,
HAS_DOMAIN_DIMENSION),g=0;g<h.length;g++){var k=l.findFirstObjectUri(h[g],TYPE);k==FEATURE_TYPE||l.isSubtypeOf(k,FEATURE_TYPE)?e.push(k):k==PARAMETER_TYPE||l.isSubtypeOf(k,PARAMETER_TYPE)?(k=b?n(b,k):new Parameter(k,0),e.push(k)):e.push(q[h[g]])}h=$jscomp.makeIterator(l.findArgsAndBody(l.findFirstObjectUri(a,HAS_FUNCTION)));b=h.next().value;h=h.next().value;a=l.findFirstObjectUri(a,HAS_RANGE);for(g=0;g<c.length;g++)c[g]instanceof DynamicMusicObject&&!c[g].getParameter(a)&&n(c[g],a);return new Mapping(e,
f,{args:b,body:h},c,a,d)}function n(a,b,c){var d=a.getParameter(b);d?d.update(c):(isNaN(c)&&(c=l.findFirstObjectValue(b,HAS_STANDARD_VALUE,null),isNaN(c)&&(c=0)),d=l.findFirstObjectValue(b,IS_INTEGER,null),d=new Parameter(b,c,d),a.addParameter(d));return d}function p(a){return a==SIMILARITY_NAVIGATOR?new SimilarityNavigator(void 0):a==GRAPH_NAVIGATOR?new GraphNavigator(void 0):a==ONE_SHOT_NAVIGATOR?new OneShotNavigator(void 0):a==REPEATED_NAVIGATOR?new RepeatedNavigator(void 0):new SequentialNavigator(void 0)}
var r=this,l=new DymoStore(b),u="",q={},t={};this.setStore=function(a){l=a};this.getStore=function(){return l};this.loadDymoFromJson=function(a,b){var d=a.lastIndexOf("/")+1;u=a.substring(0,d);c(a,function(){b(r.createDymoFromStore())})};this.parseDymoFromJson=function(a,b){l.loadData(a,!0,function(){b(r.createDymoFromStore())})};this.loadRenderingFromJson=function(a,b){c(a,function(){b(r.createRenderingFromStore())})};this.loadGraphFromJson=function(a,b){d(a,"",function(a){for(var c=0;c<a.length;c++)if(a[c])for(var d=
0;d<a[c].length;d++){var f=t[CONTEXT_URI+"dymo"+c],e=t[CONTEXT_URI+"dymo"+a[c][d]];f&&e&&f.addSimilar(e)}b(void 0)})};this.createDymoFromStore=function(){for(var a=[],b=l.findTopDymos(),c=0;c<b.length;c++)a.push(g(b[c])),f(b[c]);return[a,t]};this.createRenderingFromStore=function(){var a=l.findFirstSubjectUri(TYPE,RENDERING),b=new Rendering(t[l.findFirstObjectUri(a,HAS_DYMO)]),c=l.findAllObjectUris(a,HAS_MAPPING);h(c);for(var d=0;d<c.length;d++)b.addMapping(k(c[d]));a=l.findAllObjectUris(a,HAS_NAVIGATOR);
for(d=0;d<a.length;d++)c=l.findFirstObjectUri(a[d],NAV_DYMOS),c=l.findFunction(c),b.addSubsetNavigator(c,p(l.findFirstObjectUri(a[d],TYPE)));return[b,q]}};function DymoStore(a){function b(a,b,d){g.triplesToRdf(a,function(a){c(a,b,d)})}function c(a,b,c){a=a.split("_b").join("b");jsonld.fromRDF(a,{format:"application/nquads"},function(a,d){jsonld.frame(d,{"@id":b},function(a,b){jsonld.compact(b,"http://tiny.cc/dymo-context",function(a,b){jsonld.compact(b,"http://tiny.cc/dymo-context-simple",function(a,b){e(b);b=JSON.stringify(b,null,2);b=b.replace(/http:\/\/tiny.cc\/dymo-context\//g,"");b=b.replace("http://tiny.cc/dymo-context-simple","http://tiny.cc/dymo-context");
c(b)})})})})}function d(a,c){var d=g.findFirstObjectUri(a,TYPE,null),d=g.recursiveFindAllTriplesExcept(a,d);b(d,a,function(a){c(null,JSON.parse(a))})}function e(a){if(a&&a instanceof Object)for(var b in a)"@id"==b&&a[b].includes("_:b")?delete a[b]:e(a[b])}var g=this;EasyStore.call(this);(function(){g.loadFileIntoStore("http://tiny.cc/dymo-ontology",!1,function(){g.loadFileIntoStore("http://tiny.cc/mobile-audio-ontology",!1,function(){a&&a()})})})();this.addDymo=function(a,b,c,d){this.addTriple(a,
TYPE,DYMO);b&&g.addObjectToList(b,HAS_PART,a);c&&g.addObjectToList(a,HAS_PART,c);d&&this.addTriple(a,HAS_SOURCE,N3.Util.createLiteral(d))};this.addSimilar=function(a,b){this.addTriple(a,HAS_SIMILAR,b)};this.addSuccessor=function(a,b){this.addTriple(a,HAS_SUCCESSOR,b)};this.setFeature=function(a,b,c){var d=this.findFirstObjectUriOfType(a,HAS_FEATURE,b);d?this.removeTriple(d,VALUE):(d=this.createBlankNode(),this.addTriple(a,HAS_FEATURE,d),this.addTriple(d,TYPE,b));if(Array.isArray(c))for(a=0;a<c.length;a++)this.addObjectToList(d,
VALUE,N3.Util.createLiteral(c[a]));else this.addTriple(d,VALUE,N3.Util.createLiteral(c))};this.addRendering=function(a,b){this.addTriple(a,TYPE,RENDERING);this.addTriple(a,HAS_DYMO,b)};this.addMapping=function(a,b,c,d,e,g){var r=this.createBlankNode();this.addTriple(a,HAS_MAPPING,r);for(a=0;a<b.length;a++){var l=this.createBlankNode();this.addTriple(r,HAS_DOMAIN_DIMENSION,l);b[a].name&&this.addTriple(l,NAME,N3.Util.createLiteral(b[a].name));b[a].type&&this.addTriple(l,TYPE,b[a].type)}b=this.addFunction(c[0],
c[1]);this.addTriple(r,HAS_FUNCTION,b);if(d)for(a=0;a<d.length;a++)this.addTriple(r,TO_TARGET,d[a]);e&&(b=this.addFunction(e[0],e[1]),this.addTriple(r,TO_TARGET,b));this.addTriple(r,HAS_RANGE,g)};this.addNavigator=function(a,b,c,d){var e=this.createBlankNode();this.addTriple(a,HAS_NAVIGATOR,e);this.addTriple(e,TYPE,b);a=this.addFunction(c,d);this.addTriple(e,NAV_DYMOS,a)};this.addFunction=function(a,b){var c=this.createBlankNode();this.addTriple(c,HAS_ARGUMENT,N3.Util.createLiteral(a));this.addTriple(c,
HAS_BODY,N3.Util.createLiteral(b));return c};this.findTopDymos=function(){var a=this.findAllSubjectUris(TYPE,DYMO),b=this.findAllSubjectUris(HAS_PART),c=[].concat.apply([],b.map(function(a){return g.findParts(a)}));return a.filter(function(a){return 0>c.indexOf(a)})};this.findParts=function(a){return this.findAllObjectUris(a,HAS_PART)};this.findParents=function(a){var b=this.findContainingLists(a);return b[0].filter(function(a,c){return b[1][c]==HAS_PART})};this.findAllObjectsInHierarchy=function(a){var b=
[a];a=this.findParts(a);for(var c=0;c<a.length;c++)b=b.concat(this.findAllObjectsInHierarchy(a[c]));return b};this.findDymoRelations=function(){var a=this.findAllSubjectUris(DOMAIN,DYMO),b=this.findAllSubjectUris(RANGE,DYMO);return[HAS_PART].concat(intersectArrays(a,b))};this.findMappings=function(a){return this.findAllObjectUris(a,HAS_MAPPING)};this.findNavigators=function(a){return this.findAllObjectUris(a,HAS_NAVIGATOR)};this.findFunction=function(a){var b=$jscomp.makeIterator(this.findArgsAndBody(a));
a=b.next().value;b=b.next().value;if(a&&b)return Function.apply(null,a.concat(b))};this.findArgsAndBody=function(a){var b=this.findAllObjectValues(a,HAS_ARGUMENT);a=this.findFirstObjectValue(a,HAS_BODY);return[b,a]};this.findFeature=function(a,b){var c=this.findFirstObjectUriOfType(a,HAS_FEATURE,b);if(c)return this.findFeatureValue(c)};this.findAllFeatureValues=function(a){var b=[];a=this.findAllObjectUris(a,HAS_FEATURE);for(var c=0;c<a.length;c++)b.push(this.findFeatureValue(a[c]));return b};this.findAllNumericFeatureValues=
function(a){return this.findAllFeatureValues(a).filter(function(a){return!isNaN(a)})};this.findFeatureValue=function(a){a=this.findAllObjectValues(a,VALUE);1==a.length&&(a=a[0]);return a};this.getLevel=function(a){var b=0;for(a=this.findParents(a)[0];a;)b++,a=this.findParents(a)[0];return b};this.getMaxLevel=function(){for(var a=this.findAllSubjectUris(TYPE,DYMO),b=0,c=0;c<a.length;c++)b=Math.max(b,this.getLevel(a[c]));return b};this.toJsonld=function(a){var b=this.findTopDymos()[0];this.toRdf(function(d){c(d,
b,a)})};this.toJsonGraph=function(a,b,c){var e={nodes:[],edges:[]},n={},p=this.findAllSubjectUris(TYPE,a),r=this.find(null,b,null);async.map(p,d,function(d,u){e.nodes=u;for(var q=0;q<p.length;q++)n[p[q]]=e.nodes[q];e.edges=[];for(q=0;q<r.length;q++)if(0==g.find(r[q].object,TYPE,a).length){if(0<g.find(r[q].object,FIRST).length){var t=g.findObjectListUris(r[q].subject,b),t=t.map(function(a){return{source:n[r[q].subject],target:n[a],value:1}});e.edges=e.edges.concat(t)}}else e.edges.push({source:n[r[q].subject],
target:n[r[q].object],value:1});c(e)})}}inheritPrototype(DymoStore,EasyStore);function DymoWriter(a,b){function c(a,b){var c=new XMLHttpRequest;c.send(b);c.addEventListener("save",function(){console.log("saved "+a)});c.addEventListener("error",function(){console.log("saving "+a+" failed")});c.open("POST",a);c.send()}this.writeToJsonld=function(b,e){e||(e="dymo.json");a.toJsonld(function(a){c(b+e,a)})}};function EasyStore(){function a(a,b,c){b?jsonld.toRDF(a,{format:"application/nquads"},function(a,b){c(b)}):c(a)}function b(a){var b=d.findFirstObjectUri(a,FIRST);if(b){var c=[];c.push(b);for(a=d.findFirstObjectUri(a,REST);a!=NIL;)c.push(d.findFirstObjectUri(a,FIRST)),a=d.findFirstObjectUri(a,REST);return c}}function c(a){var b=N3.Util.getLiteralValue(a);"http://www.w3.org/2001/XMLSchema#string"!=N3.Util.getLiteralType(a)&&(b=Number(b));return b}var d=this,e=N3.Store();this.addTriple=function(a,b,
c){return e.addTriple(a,b,c)};this.removeTriple=function(a,b,c){c||(c=this.findFirstObjectUri(a,b));return e.removeTriple(a,b,c)};this.createBlankNode=function(){return e.createBlankNode()};this.loadData=function(b,c,d){a(b,c,function(a){N3.Parser().parse(a,function(a,b,c){b?e.addTriple(b):d&&d()})})};this.loadFileIntoStore=function(a,b,c){loadFile(a,function(a){d.loadData(a,b,c)})};this.addObjectToList=function(a,b,c){var d=this.findFirstObjectUri(a,b),e=this.createBlankNode();if(d){a=d;for(b=this.findFirstObjectUri(a,
REST);b!=NIL;)a=b,b=this.findFirstObjectUri(a,REST);this.removeTriple(a,REST,NIL);this.addTriple(a,REST,e)}else this.addTriple(a,b,e);this.addTriple(e,FIRST,c);this.addTriple(e,REST,NIL)};this.find=function(a,b,c){return e.find(a,b,c)};this.findFirstObjectUri=function(a,b){var c=e.find(a,b);if(0<c.length)return c[0].object};this.findFirstObjectUriOfType=function(a,b,c){a=e.find(a,b).map(function(a){return a.object});a=a.filter(function(a){return 0<e.find(a,TYPE,c).length});if(0<a.length)return a[0]};
this.findFirstSubjectUri=function(a,b){var c=e.find(null,a,b);if(0<c.length)return c[0].subject};this.findFirstObjectValue=function(a,b){var d=this.findFirstObjectUri(a,b);if(d)return c(d)};this.findAllSubjectUris=function(a,b){return e.find(null,a,b).map(function(a){return a.subject})};this.findAllObjectUris=function(a,c){for(var d=e.find(a,c,null).map(function(a){return a.object}),k=0;k<d.length;k++){var m=b(d[k]);m&&(d[k]=m)}return flattenArray(d)};this.findAllObjectValues=function(a,b){return this.findAllObjectUris(a,
b).map(c)};this.findObjectListUris=function(a,c){var d=this.findFirstObjectUri(a,c);return b(d)};this.findContainingLists=function(a){var b=[],c=[];a=this.findAllSubjectUris(FIRST,a);for(var d=0;d<a.length;d++){for(var e=a[d],n=this.findFirstSubjectUri(REST,e);n;)e=n,n=this.findFirstSubjectUri(REST,e);e=this.find(null,null,e)[0];b[d]=e.subject;c[d]=e.predicate}return[b,c]};this.recursiveFindAllTriplesExcept=function(a,b){for(var c=e.find(a,null,null),d=[],m=c.length-1;0<=m;m--)0<e.find(c[m].object,
TYPE,b).length?c.splice(m,1):d=d.concat(this.recursiveFindAllTriplesExcept(c[m].object,b));return c.concat(d)};this.findAllSubClasses=function(a){return this.findAllSubjectUris(RDFS_URI+"subClassOf",a)};this.isSubclassOf=function(a,b){for(var c=this.findFirstObjectUri(a,RDFS_URI+"subClassOf");c;){if(c==b)return!0;c=this.findFirstObjectUri(c,RDFS_URI+"subClassOf")}return!1};this.isSubtypeOf=function(a,b){for(var c=this.findFirstObjectUri(a,TYPE);c;){if(c==b)return!0;c=this.findFirstObjectUri(c,TYPE)}return!1};
this.toRdf=function(a){var b=e.find(null,null,null);this.triplesToRdf(b,a)};this.triplesToRdf=function(a,b){for(var c=N3.Writer({format:"application/nquads"}),d=0;d<a.length;d++)c.addTriple(a[d]);c.end(function(a,c){b(c)})};this.logData=function(){var a=e.find(null).map(function(a){return a.subject+"\n"+a.predicate+"\n"+a.object}),b;for(b in a)console.log(a[b])}};function Control(a,b,c){this.name=a;this.type=b;this.parameters=c;this.mappings=[]}Control.prototype.getName=function(){return this.name};Control.prototype.getParameter=function(a){if(this.parameters)return this.parameters[a]};Control.prototype.getValue=function(){return this.value};Control.prototype.getType=function(){return this.type};Control.prototype.setUpdateFunction=function(a){this.updateFunction=a};
Control.prototype.addMapping=function(a){this.mappings.push(a);a.updateParameter(this.value,this)};Control.prototype.removeMapping=function(a){a=this.mappings.indexOf(a);-1<a&&this.mappings.splice(a,1)};Control.prototype.backpropagate=function(a,b){isFinite(a)&&(this.setValue(a,b),this.updateFunction&&this.updateFunction(this.value))};Control.prototype.update=function(a){isNaN(a)||this.setValue(a)};
Control.prototype.setValue=function(a,b){if(void 0==this.value||1E-6<Math.abs(a-this.value))this.value=a,this.updateMappings(b)};Control.prototype.updateMappings=function(a){for(var b=0;b<this.mappings.length;b++)this.mappings[b]!=a&&this.mappings[b].updateParameter(this.value,this)};function DynamicMusicObject(a,b,c){function d(a,b){b[a.getUri()]=a;for(var c=0;c<a.getParts().length;c++)d(a.getParts()[c],b)}function e(a,b,c,d){var f=a-b,g=d.getParts();if(d.getLevel()==c&&0==f)return d;if(d.getLevel()>=c-1)return f<g.length?g[f]:b+g.length;for(d=0;d<g.length;d++)if(b=e(a,b,c,g[d]),isNaN(b))return b}function g(a,b,c){c(a,b);a=a.getParts();for(var d=0,e=a.length;d<e;d++)g(a[d],b,c)}function f(a,b,c){var d=b.toFlatJson();a.nodes.push(d);c&&a.links.push(k(c,d));for(c=0;c<b.getParts().length;c++)f(a,
b.getParts()[c],d)}function h(a,b,c){c||(c={});c[b.getUri()]||(c[b.getUri()]=b.toFlatJson());var d=c[b.getUri()];a.nodes.push(d);for(var e=0;e<b.getSimilars().length;e++){var f=b.getSimilars()[e];c[f.getUri()]||(c[f.getUri()]=f.toFlatJson());a.links.push(k(d,c[f.getUri()]))}for(e=0;e<b.getParts().length;e++)h(a,b.getParts()[e],c)}function k(a,b){return{source:a,target:b,value:1}}var m=this,n=null,p=[],r=[],l=[],u={},q={},t=[],v=[],y="",x;this.setType=function(a){b=a};this.getType=function(){return b};
this.getUri=function(){return a};this.setParent=function(a){n=a;a=n.getMappings();for(var b=this.getMapOfDymosInSubtree(),b=Object.keys(b).map(function(a){return b[a]}),c=0;c<a.length;c++){var d=a[c].getDymoConstraint();d&&(d=a[c].getTargets().concat(b.filter(d)),a[c].setTargets(d))}};this.removeParent=function(){for(var a=0;a<v.length;a++)v[a].disconnect();v=[];for(var b=n.getMappings(),c=this,a=0;a<b.length;a++){var d=b[a].getTargets(),d=d.filter(function(a){return!a.isSubDymoOf(c)});b[a].setTargets(d)}n=
null};this.getParent=function(){return n};this.isSubDymoOf=function(a){for(var b=this;b;){if(b==a)return!0;b=b.getParent()}return!1};this.getMapOfDymosInSubtree=function(){var a={};d(this,a);return a};this.getLevel=function(){return n?n.getLevel()+1:0};this.getIndex=function(){if(n)return n.getParts().indexOf(this)};this.addPart=function(a){p.push(a);a.setParent(this)};this.removePart=function(a){p.splice(p.indexOf(a));a.removeParent(this)};this.replacePart=function(a,b){p[a]&&p[a].removeParent(this);
p[a]=b;b.setParent(this)};this.getPart=function(a){return p[a]};this.getParts=function(){return p};this.hasParts=function(){return 0<p.length};this.getNthPart=function(a,b){return e(a,0,b,this)};this.setBasePath=function(a){y=a};this.getBasePath=function(){return n&&!y?n.getBasePath():y};this.setSourcePath=function(a){x=a};this.getSourcePath=function(){if(n&&!x)return n.getSourcePath();if(x)return this.getBasePath()+x};this.getAllSourcePaths=function(){var a=[];g(this,a,function(b,c){var d=b.getSourcePath();
d&&0>a.indexOf(d)&&c.push(d)});return a};this.getAllDymosInHierarchy=function(){var a=[];g(this,a,function(a,b){b.push(a)});return a};this.addSimilar=function(a){r.push(a)};this.getSimilars=function(a){return r};this.addSuccessor=function(a){l.push(a)};this.getSuccessors=function(a){return l};this.getFeatures=function(){return u};this.setFeature=function(a,b){u[a]=b};this.getFeature=function(a){if(a===LEVEL_FEATURE)return this.getLevel();if(a===INDEX_FEATURE)return this.getIndex();if(u.hasOwnProperty(a))return u[a];
if(n)return n.getFeature(a);for(var b=[],c=0;c<p.length;c++)if(p[c]){var d=p[c].getFeatureWithoutLookingFurther(a);isNaN(d)||b.push(d)}if(0<b.length)return b};this.getFeatureWithoutLookingFurther=function(a){if(u[a])return u[a]};this.getMappings=function(){return t};this.getSegment=function(){return[this.getFeature(TIME_FEATURE),this.getFeature(DURATION_FEATURE)]};this.addParameter=function(a){q[a.getName()]=a};this.getParameter=function(a){return q[a]};this.hasParameter=function(a){return a in q};
this.addMapping=function(a){t.push(a)};this.observedParameterChanged=function(a){a.getName()==PLAY&&c&&(0<a.getChange()?c.play(m):c.stop(m))};this.updatePartOrder=function(a){p&&p[0]&&!isNaN(p[0].getFeature(a))?p.sort(function(b,c){return b.getFeature(a)-c.getFeature(a)}):p&&p[0]&&p[0].hasParameter(a)&&p.sort(function(b,c){return b.getParameter(a).getValue()-c.getParameter(a).getValue()})};this.toJsonHierarchy=function(){for(var a=this.toFlatJson(),b=0;b<p.length;b++)a.parts.push(p[b].toJsonHierarchy());
return a};this.toJsonHierarchyGraph=function(){var a={nodes:[],links:[]};f(a,this);return a};this.toJsonSimilarityGraph=function(){var a={nodes:[],links:[]};h(a,this);return a};this.toFlatJson=function(){var c={"@id":a,"@type":DYMO};b&&(c.ct=b);x&&(c.source=x);for(var d in u)c[d]=this.getFeatureJson(d);if(0<t.length)for(c.mappings=[],d=0;d<t.length;d++)c.mappings.push(t[d].toJson());0<p.length&&(c.parts=[]);if(0<r.length)for(c.similars=[],d=0;d<r.length;d++)c.similars.push(r[d].getUri());return c};
this.getFeatureJson=function(a){return{value:u[a],type:FEATURE,adt:a.charAt(0).toUpperCase()+a.slice(1)}}};function Mapping(a,b,c,d,e,g){this.relative=b;this.functionJson=c;this.parameterName=e;this.setTargets(d);this.domainDims=a;this.dymoConstraint=g;this.init()}
Mapping.prototype.init=function(){this.functionJson||(this.functionJson=FunctionTools.IDENTITY_JSON);this.mappingFunction=FunctionTools.createFunction(this.functionJson.args,this.functionJson.body);this.inverseFunction=FunctionTools.invertFunction(this.functionJson.body);for(var a=0;a<this.domainDims.length;a++)this.domainDims[a].addMapping?this.domainDims[a].addMapping(this):this.domainDims[a].addObserver&&this.domainDims[a].addObserver(this)};
Mapping.prototype.setTargets=function(a){if(this.targets)for(var b=0,c=this.targetParameters.length;b<c;b++)this.targetParameters[b].removeUpdater(this);this.targets=a;this.targetParameters=[];b=0;for(c=this.targets.length;b<c;b++)this.targetParameters[b]=this.targets[b].getParameter(this.parameterName),this.targetParameters[b]||(this.targetParameters[b]=new Parameter(this.parameterName),this.targets[b].addParameter(this.targetParameters[b])),this.targetParameters[b].addUpdater(this)};
Mapping.prototype.getTargets=function(){return this.targets};Mapping.prototype.getDymoConstraint=function(){return this.dymoConstraint};Mapping.prototype.disconnect=function(){for(var a=0;a<this.domainDims.length;a++)this.domainDims[a].removeMapping?this.domainDims[a].removeMapping(this):this.domainDims[a].removeObserver&&this.domainDims[a].removeObserver(this);for(a=0;a<this.targetParameters.length;a++)this.targetParameters[a].removeUpdater(this)};
Mapping.prototype.updateParameter=function(){console.log(this.targetParameters,this.calculateParameter(this.targets[0]));for(var a=0;a<this.targetParameters.length;a++)this.relative?this.targetParameters[a].relativeUpdate(this.calculateParameter(this.targets[a]),this):this.targetParameters[a].update(this.calculateParameter(this.targets[a]),this)};Mapping.prototype.observedParameterChanged=function(a){this.updateParameter()};
Mapping.prototype.updatedParameterChanged=function(a){this.domainDims&&this.domainDims[0].backpropagate&&!this.relative&&(this.inverseFunction&&(a=this.inverseFunction(a)),this.domainDims[0].backpropagate(a,this))};Mapping.prototype.requestValue=function(a){for(var b=0;b<this.domainDims.length;b++)this.domainDims[b].requestValue&&this.domainDims[b].requestValue();return this.calculateParameter(a)};
Mapping.prototype.toJson=function(){for(var a=[],b=0;b<this.domainDims.length;b++)this.domainDims[b]instanceof Control?a.push({name:this.domainDims[b].getName(),type:this.domainDims[b].getType()}):this.domainDims[b]instanceof Parameter?a.push({name:this.domainDims[b].getName(),type:"Parameter"}):a.push({name:this.domainDims[b],type:"Feature"});var a={domainDims:a,"function":this.functionJson},b=this.targets.filter(function(a){return a instanceof DynamicMusicObject}).map(function(a){return a.getUri()}),
c=this.targets.filter(function(a){return!(a instanceof DynamicMusicObject)}).map(function(a){return a.getUri()});0<b.length&&(a.dymos=b);0<c.length&&(a.controls=c);a.parameter=this.parameterName;return a};
Mapping.prototype.calculateParameter=function(a){for(var b=[],c=0;c<this.domainDims.length;c++){var d;d="string"===typeof this.domainDims[c]||this.domainDims[c]instanceof String?a.getFeature(this.domainDims[c]):this.relative?this.domainDims[c].getChange():this.domainDims[c].getValue();b[c]=d}return this.mappingFunction.apply(this,b)};function Parameter(a,b,c){this.name=a;this.value=b;this.change=0;this.isInteger=c;this.updaters=[];this.observers=[]}Parameter.prototype.getName=function(){return this.name};Parameter.prototype.getValue=function(){return this.value};Parameter.prototype.getChange=function(){return this.change};Parameter.prototype.addUpdater=function(a){0>this.updaters.indexOf(a)&&(this.updaters.push(a),a.updatedParameterChanged(this.value))};
Parameter.prototype.removeUpdater=function(a){a=this.updaters.indexOf(a);-1<a&&this.updaters.splice(a,1)};Parameter.prototype.addObserver=function(a){this.observers.push(a)};Parameter.prototype.removeObserver=function(a){a=this.observers.indexOf(a);-1<a&&this.observers.splice(a,1)};Parameter.prototype.getObservers=function(){return this.observers};Parameter.prototype.update=function(a,b){this.setValueAndNotify(b,a)};Parameter.prototype.relativeUpdate=function(a,b){this.update(this.value+a,b)};
Parameter.prototype.requestValue=function(){for(var a=0;a<this.updaters.length;a++){var b=this.updaters[a].requestValue();if(b&&b!=this.value){this.setValueAndNotify(this.updaters[a],b);break}}return this.value};Parameter.prototype.notifyObservers=function(){for(var a=0;a<this.observers.length;a++)this.observers[a].observedParameterChanged(this)};
Parameter.prototype.setValueAndNotify=function(a,b){if(!isNaN(b)&&(this.isInteger&&(b=Math.round(b)),isNaN(this.value)||1E-6<Math.abs(b-this.value))){this.change=b-this.value;this.value=b;for(var c=0;c<this.updaters.length;c++)this.updaters[c]!=a&&this.updaters[c].updatedParameterChanged(this.value);this.change&&this.notifyObservers()}};function Rendering(a){var b=[],c;this.play=function(){a&&a.getParameter(PLAY).update(1)};this.stop=function(){a&&a.getParameter(PLAY).update(0)};this.addMapping=function(a){b.push(a);a.updateParameter()};this.getMappings=function(){return b};this.addSubsetNavigator=function(b,e){c||(c=new DymoNavigator(a));c.addSubsetNavigator(b,e)};this.getNavigator=function(){return c}};function FunctionTools(){}FunctionTools.IDENTITY_JSON={args:["a"],body:"return a;"};FunctionTools.inverted={};FunctionTools.created={};FunctionTools.createFunction=function(a,b){FunctionTools.created[b]||(FunctionTools.created[b]=Function.apply(null,a.concat(b)));return FunctionTools.created[b]};
FunctionTools.invertFunction=function(a){var b=FunctionTools.toReturnValueString(a);FunctionTools.inverted[a]||(FunctionTools.inverted[a]=FunctionTools.toJavaScriptFunction(FunctionTools.invertReturnValue(b)));return FunctionTools.inverted[a]};
FunctionTools.invertReturnValue=function(a){var b;try{b=math.parse(a)}catch(e){e instanceof SyntaxError||console.log(e);return}for(var c=a=new math.expression.node.SymbolNode("a");b;)if(b.isSymbolNode)a.name=b.name,b=void 0;else if(b.isParenthesisNode)b=b.content;else if(b.isOperatorNode){var d=FunctionTools.getInvertedOperator(b.op);if("+"==b.op||"*"==b.op)if(b.args[0].isConstantNode)c=new math.expression.node.OperatorNode(d,FunctionTools.getOperatorName(d),[c,b.args[0]]),b=FunctionTools.ifNextNode(b.args[1]);
else if(b.args[1].isConstantNode)c=new math.expression.node.OperatorNode(d,FunctionTools.getOperatorName(d),[c,b.args[1]]),b=FunctionTools.ifNextNode(b.args[0]);else return;else if("-"==b.op||"/"==b.op)if(b.args[0].isConstantNode)c=new math.expression.node.OperatorNode(b.op,FunctionTools.getOperatorName(b.op),[b.args[0],c]),b=FunctionTools.ifNextNode(b.args[1]);else if(b.args[1].isConstantNode)c=new math.expression.node.OperatorNode(d,FunctionTools.getOperatorName(d),[c,b.args[1]]),b=FunctionTools.ifNextNode(b.args[0]);
else return}else return;return c.toString()};FunctionTools.toJavaScriptFunction=function(a){try{return new Function("a","return "+a+";")}catch(b){}};FunctionTools.toReturnValueString=function(a){return a.substring(a.indexOf("return ")+7,a.indexOf(";"))};FunctionTools.ifNextNode=function(a){if(a.isOperatorNode||a.isParenthesisNode||a.isSymbolNode)return a};FunctionTools.getInvertedOperator=function(a){if("+"==a)return"-";if("-"==a)return"+";if("*"==a)return"/";if("/"==a)return"*"};
FunctionTools.getOperatorName=function(a){if("+"==a)return"add";if("-"==a)return"subtract";if("*"==a)return"multiply";if("/"==a)return"divide"};function PolygonTools(){}PolygonTools.isPointInPolygon=function(a,b){for(var c=!1,d=-1,e=a.length,g=e-1;++d<e;g=d)(a[d][1]<=b[1]&&b[1]<a[g][1]||a[g][1]<=b[1]&&b[1]<a[d][1])&&b[0]<(a[g][0]-a[d][0])*(b[1]-a[d][1])/(a[g][1]-a[d][1])+a[d][0]&&(c=!c);return c};PolygonTools.getArea=function(a){var b=0,c,d,e=0;for(d=a.length-1;e<a.length;d=e,e++)c=a[e],d=a[d],b+=c[0]*d[1],b-=c[1]*d[0];return b/2};
PolygonTools.getCentroid=function(a){var b,c,d,e=0,g=0,f=0;for(c=a.length-1;f<a.length;c=f,f++)b=a[f],c=a[c],d=b[0]*c[1]-c[0]*b[1],e+=(b[0]+c[0])*d,g+=(b[1]+c[1])*d;d=6*PolygonTools.getArea(a);return{0:e/d,1:g/d}};function sqDist(a,b){return Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)}
PolygonTools.getDistanceFromSegment=function(a,b,c){var d=sqDist(b,c);if(0==d)return sqDist(a,b);d=((a[0]-b[0])*(c[0]-b[0])+(a[1]-b[1])*(c[1]-b[1]))/d;return 0>d?sqDist(a,b):1<d?sqDist(a,c):Math.sqrt(sqDist(a,{0:b[0]+d*(c[0]-b[0]),1:b[1]+d*(c[1]-b[1])}))};PolygonTools.getMinDistanceFromEdge=function(a,b){for(var c=Number.POSITIVE_INFINITY,d=0;d<a.length;d++)var e=PolygonTools.getDistanceFromSegment(b,a[d],a[(d+1)%a.length]),c=Math.min(e,c);return c};
PolygonTools.howFarIsPointInPolygon=function(a,b,c){return PolygonTools.isPointInPolygon(a,c)?(b=Math.sqrt(Math.pow(c[0]-b[0],2)+Math.pow(c[1]-b[1],2)),a=PolygonTools.getMinDistanceFromEdge(a,c),Math.sqrt((1-b)*a/Math.abs(b+a))):0};PolygonTools.getPolygonFunctionArgs=function(a){return["a","b","return PolygonTools.isPointInPolygon("+getPolygonOrPointString(a)+", {0:a, 1:b});"]};
PolygonTools.getInterpolatedPolygonFunctionArgs=function(a){var b=getPolygonOrPointString(a);a=getPolygonOrPointString(PolygonTools.getCentroid(a));return["a","b","return PolygonTools.howFarIsPointInPolygon("+b+","+a+", {0:a, 1:b});"]};function getPolygonOrPointString(a){return JSON.stringify(a).replace(/"/g,"'")};function GraphNavigator(a){var b=0;this.resetPartsPlayed=function(){b=0};this.getType=function(){return GRAPH_NAVIGATOR};this.getCopy=function(a){return new GraphNavigator(a)};this.getCurrentParts=function(){if(0<a.getParts().length){var c;c=(c=a.getPart(b))?[c]:void 0;a:{if(c&&0<c.length){var d=c[0].getSuccessors();if(0<d.length){d=d[Math.floor(Math.random()*d.length)];b=a.getParts().indexOf(d);break a}}b=void 0}return c}};this.getNextParts=function(){return this.getCurrentParts()}};function DymoNavigator(a,b,c){function d(){k=new Map;m=[];c||(c=new OneShotNavigator(void 0))}function e(a){if(a){var b=f(a);if(b){m[a.getLevel()]=b;if(b.getType()==ONE_SHOT_NAVIGATOR||b.getType()==REPEATED_NAVIGATOR)return b.getCurrentParts();a=b.getCurrentParts();return(a=g(a))?a:g(b.getNextParts())}return[a]}}function g(a){if(a&&0<a.length){for(var b=[],c=0,d=a.length;c<d;c++){var f=e(a[c]);f&&(f.length?b=b.concat(f):b.push(f))}if(0<b.length)return b}}function f(a){if(!k.has(a)){for(var d=0,e=
h.length;d<e;d++)h[d][0](a)&&k.set(a,h[d][1].getCopy(a));k.has(a)||(b&&a.hasParts()?k.set(a,b.getCopy(a)):k.set(a,c.getCopy(a)))}return k.get(a)}var h=[],k,m;d();this.reset=function(a){if(a){var b=a.getAllDymosInHierarchy();b.splice(b.indexOf(a),1);a=0;for(var c=b.length;a<c;a++){var e=k.delete(b[a]);(e=m.indexOf(e))&&m.splice(e,1)}}else d()};this.addSubsetNavigator=function(a,b){h.push([a,b])};this.getSubsetNavigators=function(){return h};this.getPosition=function(b,c){c||(c=a);for(var d=0;d<b;){if(!k.has(c))return;
c=k.get(c).getCurrentParts()[0];d++}if(k.has(c))return k.get(c).getPartsNavigated()};this.setPosition=function(b,c,d){d||(d=a);for(var e=0;e<=c&&d;){var g=f(d);e==c?(g.setPartsNavigated(b),this.reset(d)):d=g.getCurrentParts()?g.getCurrentParts()[0]:void 0;e++}};this.getNextParts=function(){return e(a)}};function OneShotNavigator(a){var b=!1;this.getType=function(){return ONE_SHOT_NAVIGATOR};this.getCopy=function(a){return new OneShotNavigator(a)};this.getCurrentParts=function(){if(!b)return a.getParameter(LOOP)&&1==a.getParameter(LOOP).getValue()||(b=!0),[a]};this.getNextParts=function(){return this.getCurrentParts()}};function RepeatedNavigator(a){this.getType=function(){return REPEATED_NAVIGATOR};this.getCopy=function(a){return new RepeatedNavigator(a)};this.getCurrentParts=function(){return[a]};this.getNextParts=function(){return this.getCurrentParts()}};function SequentialNavigator(a,b){var c=0;this.resetPartsNavigated=function(){c=0};this.setPartsNavigated=function(a){c=a};this.getPartsNavigated=function(){return c};this.getType=function(){return SEQUENTIAL_NAVIGATOR};this.getCopy=function(a){return new SequentialNavigator(a,b)};this.getDymo=function(){return a};this.getCurrentParts=function(){if(0<a.getParts().length){if(a.getType()==CONJUNCTION){var d;d=0>=c?a.getParts():void 0;return d}b?(d=a.getParts().length,d=a.getPart(d-c)):d=a.getPart(c);
d=d?[d]:void 0;return d}};this.getNextParts=function(){c++;return this.getCurrentParts()}};function SimilarityNavigator(a){function b(b){if(b){if(b&&0<b.length)for(var g=0;g<b.length;g++)if(0<b[g].getSimilars().length&&Math.random()<c.leapingProbability.getValue()){var f=b[g].getSimilars(),h=Math.floor(Math.random()*f.length);if(0<c.continueAfterLeaping.getValue()){var k=a.getParts().indexOf(h);k&&(d=k+1)}b[g]=f[h]}return b}}var c=this,d=0;this.leapingProbability=new Parameter(LEAPING_PROBABILITY,.5);this.continueAfterLeaping=new Parameter(CONTINUE_AFTER_LEAPING,0,!0);this.resetPartsPlayed=
function(){d=0};this.getType=function(){return SIMILARITY_NAVIGATOR};this.getCopy=function(a){a=new SimilarityNavigator(a);a.leapingProbability.update(this.leapingProbability.getValue(),this);a.continueAfterLeaping.update(this.continueAfterLeaping.getValue(),this);return a};this.getCurrentParts=function(){if(0<a.getParts().length){if(a.getType()==CONJUNCTION){var c;0>=d?(d++,c=a.getParts()):c=void 0;return b(c)}(c=a.getPart(d))?(c.hasParts()||d++,c=[c]):c=void 0;return b(c)}};this.getNextParts=function(){d++;
return this.getCurrentParts()}};function loadFile(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.onload=function(){b(this.responseText)};c.error=function(a){console.log(a)};c.send()}function flattenArray(a){return a.reduce(function(a,c){return a.concat(Array.isArray(c)?flattenArray(c):c)},[])}function intersectArrays(a,b){if(a&&b){var c;b.length>a.length&&(c=b,b=a,a=c);return a.filter(function(a){if(-1!==b.indexOf(a))return!0})}return[]};function inheritPrototype(a,b){var c=Object.create(b.prototype);c.constructor=a;a.prototype=c};function SoundTouch(a){this.rateTransposer=new RateTransposer(!1);this.tdStretch=new Stretch(!1,a);this._inputBuffer=new FifoSampleBuffer;this._intermediateBuffer=new FifoSampleBuffer;this._outputBuffer=new FifoSampleBuffer;this.tempo=this._rate=0;this.virtualTempo=this.virtualRate=this.virtualPitch=1;this._calculateEffectiveRateAndTempo()}
extend(SoundTouch.prototype,{clear:function(){this.rateTransposer.clear();this.tdStretch.clear()},clone:function(){var a=new SoundTouch;a.rate=this._rate;a.tempo=this.tempo;return a},get rate(){return this._rate},set rate(a){this.virtualRate=a;this._calculateEffectiveRateAndTempo()},set rateChange(a){this.rate=1+.01*a},get tempo(){return this._tempo},set tempo(a){this.virtualTempo=a;this._calculateEffectiveRateAndTempo()},set tempoChange(a){this.tempo=1+.01*a},set pitch(a){this.virtualPitch=a;this._calculateEffectiveRateAndTempo()},
set pitchOctaves(a){this.pitch=Math.exp(.69314718056*a);this._calculateEffectiveRateAndTempo()},set pitchSemitones(a){this.pitchOctaves=a/12},get inputBuffer(){return this._inputBuffer},get outputBuffer(){return this._outputBuffer},_calculateEffectiveRateAndTempo:function(){var a=this._tempo,b=this._rate;this._tempo=this.virtualTempo/this.virtualPitch;this._rate=this.virtualRate*this.virtualPitch;testFloatEqual(this._tempo,a)&&(this.tdStretch.tempo=this._tempo);testFloatEqual(this._rate,b)&&(this.rateTransposer.rate=
this._rate);1<this._rate?this._outputBuffer!=this.rateTransposer.outputBuffer&&(this.tdStretch.inputBuffer=this._inputBuffer,this.tdStretch.outputBuffer=this._intermediateBuffer,this.rateTransposer.inputBuffer=this._intermediateBuffer,this.rateTransposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.tdStretch.outputBuffer&&(this.rateTransposer.inputBuffer=this._inputBuffer,this.rateTransposer.outputBuffer=this._intermediateBuffer,this.tdStretch.inputBuffer=this._intermediateBuffer,this.tdStretch.outputBuffer=
this._outputBuffer)},process:function(){1<this._rate?(this.tdStretch.process(),this.rateTransposer.process()):(this.rateTransposer.process(),this.tdStretch.process())}});function FifoSampleBuffer(){this._vector=new Float32Array;this._frameCount=this._position=0}
FifoSampleBuffer.prototype={get vector(){return this._vector},get position(){return this._position},get startIndex(){return 2*this._position},get frameCount(){return this._frameCount},get endIndex(){return 2*(this._position+this._frameCount)},clear:function(){this.receive();this.rewind()},put:function(a){this._frameCount+=a},putSamples:function(a,b,c){b=2*(b||0);0<=c||(c=(a.length-b)/2);var d=2*c;this.ensureCapacity(c+this._frameCount);var e=this.endIndex;this._vector.set(a.subarray(b,b+d),e);this._frameCount+=
c},putBuffer:function(a,b,c){b=b||0;0<=c||(c=a.frameCount-b);this.putSamples(a.vector,a.position+b,c)},receive:function(a){if(!(0<=a)||a>this._frameCount)a=this._frameCount;this._frameCount-=a;this._position+=a},receiveSamples:function(a,b){var c=this.startIndex;a.set(this._vector.subarray(c,c+2*b));this.receive(b)},extract:function(a,b,c){b=this.startIndex+2*b;a.set(this._vector.subarray(b,b+2*c))},ensureCapacity:function(a){a*=2;this._vector.length<a?(a=new Float32Array(a),a.set(this._vector.subarray(this.startIndex,
this.endIndex)),this._vector=a,this._position=0):this.rewind()},ensureAdditionalCapacity:function(a){this.ensureCapacity(this.frameCount+a)},rewind:function(){0<this._position&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}};function extend(a,b){for(var c in b){var d=b.__lookupGetter__(c),e=b.__lookupSetter__(c);d||e?(d&&a.__defineGetter__(c,d),e&&a.__defineSetter__(c,e)):a[c]=b[c]}return a}function testFloatEqual(a,b){return 1E-10<(a>b?a-b:b-a)}
function FilterSupport(a){this._pipe=a}
FilterSupport.prototype={get pipe(){return this._pipe},get inputBuffer(){return this._pipe.inputBuffer},get outputBuffer(){return this._pipe.outputBuffer},fillOutputBuffer:function(a){for(;this.outputBuffer.frameCount<a;){this.fillInputBuffer(16-this.inputBuffer.frameCount);if(16>this.inputBuffer.frameCount)break;this._pipe.process()}},clear:function(){this._pipe.clear();this.outputBufferPosition=0},get position(){return this._position},set position(a){if(a>this._position)throw new RangeError("New position may not be greater than current position");
var b=this.outputBufferPosition-(this._position-a);if(0>b)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=b;this._position=a},get sourcePosition(){return this._sourcePosition},set sourcePosition(a){this.clear();this._sourcePosition=a},fillInputBuffer:function(a){var b=new Float32Array(2*a);a=this.sourceSound.extract(b,a,this._sourcePosition);this._sourcePosition+=a;this.inputBuffer.putSamples(b,0,a)},extract:function(a,b){this.fillOutputBuffer(this.outputBufferPosition+
b);var c=Math.min(b,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(a,this.outputBufferPosition,c);var d=this.outputBufferPosition+c;this.outputBufferPosition=Math.min(this.historyBufferSize,d);this.outputBuffer.receive(Math.max(d-this.historyBufferSize,0));this._position+=c;return c},handleSampleData:function(a){this.extract(a.data,4096)}};
function SimpleFilter(a,b){FilterSupport.call(this,b);this.sourceSound=a;this.historyBufferSize=22050;this._position=this.outputBufferPosition=this._sourcePosition=0}extend(SimpleFilter.prototype,FilterSupport.prototype);function AbstractFifoSamplePipe(a){a?(this.inputBuffer=new FifoSampleBuffer,this.outputBuffer=new FifoSampleBuffer):this.inputBuffer=this.outputBuffer=null}
AbstractFifoSamplePipe.prototype={get inputBuffer(){return this._inputBuffer},set inputBuffer(a){this._inputBuffer=a},get outputBuffer(){return this._outputBuffer},set outputBuffer(a){this._outputBuffer=a},clear:function(){this._inputBuffer.clear();this._outputBuffer.clear()}};function RateTransposer(a){AbstractFifoSamplePipe.call(this,a);this._reset();this.rate=1}extend(RateTransposer.prototype,AbstractFifoSamplePipe.prototype);
extend(RateTransposer.prototype,{set rate(a){this._rate=a},_reset:function(){this.prevSampleR=this.prevSampleL=this.slopeCount=0},clone:function(){var a=new RateTransposer;a.rate=this._rate;return a},process:function(){var a=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(a/this._rate+1);a=this._transpose(a);this._inputBuffer.receive();this._outputBuffer.put(a)},_transpose:function(a){if(0==a)return 0;for(var b=this._inputBuffer.vector,c=this._inputBuffer.startIndex,d=this._outputBuffer.vector,
e=this._outputBuffer.endIndex,g=0,f=0;1>this.slopeCount;)d[e+2*f]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*b[c],d[e+2*f+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*b[c+1],f++,this.slopeCount+=this._rate;--this.slopeCount;if(1!=a)a:for(;;){for(;1<this.slopeCount;)if(--this.slopeCount,g++,g>=a-1)break a;var h=c+2*g;d[e+2*f]=(1-this.slopeCount)*b[h]+this.slopeCount*b[h+2];d[e+2*f+1]=(1-this.slopeCount)*b[h+1]+this.slopeCount*b[h+3];f++;this.slopeCount+=this._rate}this.prevSampleL=
b[c+2*a-2];this.prevSampleR=b[c+2*a-1];return f}});
var USE_AUTO_SEQUENCE_LEN=0,DEFAULT_SEQUENCE_MS=USE_AUTO_SEQUENCE_LEN,USE_AUTO_SEEKWINDOW_LEN=0,DEFAULT_SEEKWINDOW_MS=USE_AUTO_SEEKWINDOW_LEN,DEFAULT_OVERLAP_MS=8,_SCAN_OFFSETS=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],AUTOSEQ_TEMPO_LOW=.5,AUTOSEQ_TEMPO_TOP=2,
AUTOSEQ_AT_MIN=125,AUTOSEQ_AT_MAX=50,AUTOSEQ_K=(AUTOSEQ_AT_MAX-AUTOSEQ_AT_MIN)/(AUTOSEQ_TEMPO_TOP-AUTOSEQ_TEMPO_LOW),AUTOSEQ_C=AUTOSEQ_AT_MIN-AUTOSEQ_K*AUTOSEQ_TEMPO_LOW,AUTOSEEK_AT_MIN=25,AUTOSEEK_AT_MAX=15,AUTOSEEK_K=(AUTOSEEK_AT_MAX-AUTOSEEK_AT_MIN)/(AUTOSEQ_TEMPO_TOP-AUTOSEQ_TEMPO_LOW),AUTOSEEK_C=AUTOSEEK_AT_MIN-AUTOSEEK_K*AUTOSEQ_TEMPO_LOW;
function Stretch(a,b){AbstractFifoSamplePipe.call(this,a);this.bQuickSeek=!0;this.bMidBufferDirty=!1;this.pMidBuffer=null;this.overlapLength=0;this.bAutoSeekSetting=this.bAutoSeqSetting=!0;this._tempo=1;this.setParameters(b,DEFAULT_SEQUENCE_MS,DEFAULT_SEEKWINDOW_MS,DEFAULT_OVERLAP_MS)}extend(Stretch.prototype,AbstractFifoSamplePipe.prototype);
extend(Stretch.prototype,{clear:function(){AbstractFifoSamplePipe.prototype.clear.call(this);this._clearMidBuffer()},_clearMidBuffer:function(){this.bMidBufferDirty&&(this.bMidBufferDirty=!1,this.pMidBuffer=null)},setParameters:function(a,b,c,d){0<a&&(this.sampleRate=a);0<d&&(this.overlapMs=d);0<b?(this.sequenceMs=b,this.bAutoSeqSetting=!1):this.bAutoSeqSetting=!0;0<c?(this.seekWindowMs=c,this.bAutoSeekSetting=!1):this.bAutoSeekSetting=!0;this.calcSeqParameters();this.calculateOverlapLength(this.overlapMs);
this.tempo=this._tempo},set tempo(a){this._tempo=a;this.calcSeqParameters();this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength);this.skipFract=0;this.sampleReq=Math.max(Math.floor(this.nominalSkip+.5)+this.overlapLength,this.seekWindowLength)+this.seekLength},get inputChunkSize(){return this.sampleReq},get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)},calculateOverlapLength:function(a){a=this.sampleRate*a/1E3;16>a&&(a=16);this.overlapLength=
a-a%8;this.pRefMidBuffer=new Float32Array(2*this.overlapLength);this.pMidBuffer=new Float32Array(2*this.overlapLength)},checkLimits:function(a,b,c){return a<b?b:a>c?c:a},calcSeqParameters:function(){var a;this.bAutoSeqSetting&&(a=AUTOSEQ_C+AUTOSEQ_K*this._tempo,a=this.checkLimits(a,AUTOSEQ_AT_MAX,AUTOSEQ_AT_MIN),this.sequenceMs=Math.floor(a+.5));this.bAutoSeekSetting&&(a=AUTOSEEK_C+AUTOSEEK_K*this._tempo,a=this.checkLimits(a,AUTOSEEK_AT_MAX,AUTOSEEK_AT_MIN),this.seekWindowMs=Math.floor(a+.5));this.seekWindowLength=
Math.floor(this.sampleRate*this.sequenceMs/1E3);this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1E3)},set quickSeek(a){this.bQuickSeek=a},clone:function(){var a=new Stretch;a.tempo=this.tempo;a.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs);return a},seekBestOverlapPosition:function(){return this.bQuickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()},seekBestOverlapPositionStereo:function(){var a,b,c,d;this.precalcCorrReferenceStereo();
b=Number.MIN_VALUE;for(d=a=0;d<this.seekLength;d++)c=this.calcCrossCorrStereo(2*d,this.pRefMidBuffer),c>b&&(b=c,a=d);return a},seekBestOverlapPositionStereoQuick:function(){var a,b,c,d,e,g,f;this.precalcCorrReferenceStereo();c=Number.MIN_VALUE;for(e=g=b=0;4>e;e++){for(a=0;_SCAN_OFFSETS[e][a];){f=g+_SCAN_OFFSETS[e][a];if(f>=this.seekLength)break;d=this.calcCrossCorrStereo(2*f,this.pRefMidBuffer);d>c&&(c=d,b=f);a++}g=b}return b},precalcCorrReferenceStereo:function(){var a,b,c;for(a=0;a<this.overlapLength;a++)c=
a*(this.overlapLength-a),b=2*a,this.pRefMidBuffer[b]=this.pMidBuffer[b]*c,this.pRefMidBuffer[b+1]=this.pMidBuffer[b+1]*c},calcCrossCorrStereo:function(a,b){var c=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var d,e,g;d=0;for(e=2;e<2*this.overlapLength;e+=2)g=e+a,d+=c[g]*b[e]+c[g+1]*b[e+1];return d},overlap:function(a){this.overlapStereo(2*a)},overlapStereo:function(a){var b=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var c=this._outputBuffer.vector,d=this._outputBuffer.endIndex,
e,g,f,h,k,m,n;h=1/this.overlapLength;for(e=0;e<this.overlapLength;e++)f=(this.overlapLength-e)*h,k=e*h,g=2*e,m=g+a,n=g+d,c[n+0]=b[m+0]*k+this.pMidBuffer[g+0]*f,c[n+1]=b[m+1]*k+this.pMidBuffer[g+1]*f},process:function(){var a,b;if(null==this.pMidBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.pMidBuffer=new Float32Array(2*this.overlapLength);this._inputBuffer.receiveSamples(this.pMidBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;)a=this.seekBestOverlapPosition(),
this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(a)),this._outputBuffer.put(this.overlapLength),b=this.seekWindowLength-2*this.overlapLength,0<b&&this._outputBuffer.putBuffer(this._inputBuffer,a+this.overlapLength,b),a=this.inputBuffer.startIndex+2*(a+this.seekWindowLength-this.overlapLength),this.pMidBuffer.set(this._inputBuffer.vector.subarray(a,a+2*this.overlapLength)),this.skipFract+=this.nominalSkip,a=Math.floor(this.skipFract),this.skipFract-=a,this._inputBuffer.receive(a)}});
extend(Stretch.prototype,{get tempo(){return this._tempo}});
