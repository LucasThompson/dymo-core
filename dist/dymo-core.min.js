var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[$jscomp.global.Symbol.iterator])return a[$jscomp.global.Symbol.iterator]();if(!(a instanceof Array||"string"==typeof a||a instanceof String))throw new TypeError(a+" is not iterable");var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.arrayFromArguments=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b};$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if($jscomp.global.Object.defineProperties){var e=$jscomp.global.Object.getOwnPropertyDescriptor(b,d);$jscomp.global.Object.defineProperty(a,d,e)}else a[d]=b[d]};
$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};$jscomp.array.arrayIterator_=function(a,b){a instanceof String&&(a=String(a));var c=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={},e=(d.next=function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}e.next=$jscomp.array.done_;return $jscomp.array.done_()},d[Symbol.iterator]=function(){return e},d);return e};
$jscomp.array.findInternal_=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};
$jscomp.array.from=function(a,b,c){b=void 0===b?function(a){return a}:b;var d=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(a[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=a[Symbol.iterator]();for(var e;!(e=a.next()).done;)d.push(b.call(c,e.value))}else{e=a.length;for(var g=0;g<e;g++)d.push(b.call(c,a[g]))}return d};$jscomp.array.of=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return $jscomp.array.from(b)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return[a,b]})};$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(a){return a})};$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return b})};
$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)};$jscomp.array.copyWithin=function(a,b,c){var d=this.length;a=Number(a);b=Number(b);c=Number(null!=c?c:d);if(a<b)for(c=Math.min(c,d);b<c;)b in this?this[a++]=this[b++]:(delete this[a++],b++);else for(c=Math.min(c,d+b-a),a+=c-b;c>b;)--c in this?this[--a]=this[c]:delete this[a];return this};$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)};
$jscomp.array.fill=function(a,b,c){null!=c&&a.length||(c=this.length||0);c=Number(c);for(b=Number((void 0===b?0:b)||0);b<c;b++)this[b]=a;return this};$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)};$jscomp.array.find=function(a,b){return $jscomp.array.findInternal_(this,a,b).v};$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)};
$jscomp.array.findIndex=function(a,b){return $jscomp.array.findInternal_(this,a,b).i};$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)};$jscomp.Map=function(a){a=void 0===a?[]:a;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,this.set(b[0],b[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var a=$jscomp.global.Map;if(!a||!a.prototype.entries||!Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(g){return!1}};
$jscomp.Map.createHead_=function(){var a={};return a.previous=a.next=a.head=a};$jscomp.Map.getId_=function(a){if(!(a instanceof Object))return String(a);$jscomp.Map.key_ in a||a instanceof Object&&Object.isExtensible&&Object.isExtensible(a)&&$jscomp.Map.defineProperty_(a,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in a?a[$jscomp.Map.key_]:" "+a};
$jscomp.Map.prototype.set=function(a,b){var c=this.maybeGetEntry_(a),d=c.id,e=c.list,c=c.entry;e||(e=this.data_[d]=[]);c?c.value=b:(c={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},e.push(c),this.head_.previous.next=c,this.head_.previous=c,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(a){var b=this.maybeGetEntry_(a);a=b.id;var c=b.list,d=b.index;return(b=b.entry)&&c?(c.splice(d,1),c.length||delete this.data_[a],b.previous.next=b.next,b.next.previous=b.previous,b.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(a){return!!this.maybeGetEntry_(a).entry};
$jscomp.Map.prototype.get=function(a){return(a=this.maybeGetEntry_(a).entry)&&a.value};$jscomp.Map.prototype.maybeGetEntry_=function(a){var b=$jscomp.Map.getId_(a),c=this.data_[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];if(a!==a&&e.key!==e.key||a===e.key)return{id:b,list:c,index:d,entry:e}}return{id:b,list:c,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(a){return[a.key,a.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(a){return a.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(a){return a.value})};$jscomp.Map.prototype.forEach=function(a,b){for(var c=$jscomp.makeIterator(this.entries()),d=c.next();!d.done;d=c.next())d=d.value,a.call(b,d[1],d[0],this)};
$jscomp.Map.prototype.iter_=function(a){var b=this,c=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={};return d.next=function(){if(c){for(;c.head!=b.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:a(c)};c=null}return{done:!0,value:void 0}},d[Symbol.iterator]=function(){return this},d};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(a,b,c){Object.defineProperty(a,b,{value:String(c)})}:function(a,b,c){a[b]=String(c)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(a){a=Number(a)>>>0;if(0===a)return 32;var b=0;0===(a&4294901760)&&(a<<=16,b+=16);0===(a&4278190080)&&(a<<=8,b+=8);0===(a&4026531840)&&(a<<=4,b+=4);0===(a&3221225472)&&(a<<=2,b+=2);0===(a&2147483648)&&b++;return b};$jscomp.math.imul=function(a,b){a=Number(a);b=Number(b);var c=a&65535,d=b&65535;return c*d+((a>>>16&65535)*d+c*(b>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1};
$jscomp.math.log10=function(a){return Math.log(a)/Math.LN10};$jscomp.math.log2=function(a){return Math.log(a)/Math.LN2};$jscomp.math.log1p=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,c=1,d=a,e=0,g=1;e!=d;)b*=a,g*=-1,d=(e=d)+g*b/++c;return d}return Math.log(1+a)};$jscomp.math.expm1=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,c=1,d=a,e=0;e!=d;)b*=a/++c,d=(e=d)+b;return d}return Math.exp(a)-1};$jscomp.math.cosh=function(a){a=Number(a);return(Math.exp(a)+Math.exp(-a))/2};
$jscomp.math.sinh=function(a){a=Number(a);return 0===a?a:(Math.exp(a)-Math.exp(-a))/2};$jscomp.math.tanh=function(a){a=Number(a);if(0===a)return a;var b=Math.exp(2*-Math.abs(a)),b=(1-b)/(1+b);return 0>a?-b:b};$jscomp.math.acosh=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};$jscomp.math.asinh=function(a){a=Number(a);if(0===a)return a;var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return 0>a?-b:b};
$jscomp.math.atanh=function(a){a=Number(a);return($jscomp.math.log1p(a)-$jscomp.math.log1p(-a))/2};
$jscomp.math.hypot=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];a=Number(a);b=Number(b);for(var g=Math.max(Math.abs(a),Math.abs(b)),h=$jscomp.makeIterator(d),e=h.next();!e.done;e=h.next())g=Math.max(g,Math.abs(e.value));if(1E100<g||1E-100>g){a/=g;b/=g;h=a*a+b*b;d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())e=e.value,e=Number(e)/g,h+=e*e;return Math.sqrt(h)*g}g=a*a+b*b;d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())e=e.value,g+=e*e;return Math.sqrt(g)};
$jscomp.math.trunc=function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||0===a)return a;var b=Math.floor(Math.abs(a));return 0>a?-b:b};$jscomp.math.cbrt=function(a){if(0===a)return a;a=Number(a);var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a};$jscomp.number.isInteger=function(a){return $jscomp.number.isFinite(a)?a===Math.floor(a):!1};
$jscomp.number.isNaN=function(a){return"number"===typeof a&&isNaN(a)};$jscomp.number.isSafeInteger=function(a){return $jscomp.number.isInteger(a)&&Math.abs(a)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];c=$jscomp.makeIterator(c);for(d=c.next();!d.done;d=c.next()){var d=d.value,e;for(e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a};$jscomp.object.is=function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b};$jscomp.Set=function(a){a=void 0===a?[]:a;this.map_=new $jscomp.Map;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this.add(b.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var a=$jscomp.global.Set;if(!a||!a.prototype.entries||!Object.seal)return!1;var b=Object.seal({x:4}),a=new a($jscomp.makeIterator([b]));if(a.has(b)||1!=a.size||a.add(b)!=a||1!=a.size||a.add({x:4})!=a||2!=a.size)return!1;var a=a.entries(),c=a.next();if(c.done||c.value[0]!=b||c.value[1]!=b)return!1;c=a.next();return c.done||c.value[0]==b||4!=c.value[0].x||c.value[1]!=c.value[0]?!1:a.next().done};
$jscomp.Set.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(a){return this.map_.has(a)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noRegExp_=function(a,b){if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];for(var c="",b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next()){d=d.value;d=+d;if(0>d||1114111<d||d!==Math.floor(d))throw new RangeError("invalid_code_point "+d);65535>=d?c+=String.fromCharCode(d):(d-=65536,c+=String.fromCharCode(d>>>10&1023|55296),c+=String.fromCharCode(d&1023|56320))}return c};
$jscomp.string.repeat=function(a){var b=this.toString();if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=b),a>>>=1)b+=b;return c};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(a){var b=this.toString(),c=b.length;a=Number(a)||0;if(0<=a&&a<c){a|=0;var d=b.charCodeAt(a);if(55296>d||56319<d||a+1===c)return d;a=b.charCodeAt(a+1);return 56320>a||57343<a?d:1024*(d-55296)+a+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"includes");return-1!==this.toString().indexOf(a,b)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"startsWith");var c=this.toString();a+="";for(var d=c.length,e=a.length,g=Math.max(0,Math.min(b|0,c.length)),h=0;h<e&&g<d;)if(c[g++]!=a[h++])return!1;return h>=e};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(a,b){$jscomp.string.noRegExp_(a,"endsWith");var c=this.toString();a+="";void 0===b&&(b=c.length);for(var d=Math.max(0,Math.min(b|0,c.length)),e=a.length;0<e&&0<d;)if(c[--d]!=a[--e])return!1;return 0>=e};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};
function DymoManager(a,b,c,d,e,g){function h(a,b){f=a;k=b[0];for(var d in b[1]){var g=b[1][d];DYMO_STORE.isSubclassOf(g.getType(),UI_CONTROL)&&(m[d]=new UIControl(g,e));DYMO_STORE.isSubclassOf(g.getType(),SENSOR_CONTROL)&&(n[d]=g)}c||(c="bower_components/dymo-core/audio/impulse_rev.wav");l.init(c)}DYMO_STORE=new DymoStore(d);var l=new Scheduler(a,g);isNaN(b)||(SCHEDULE_AHEAD_TIME=b);var f,k,m={},n={};this.loadDymoAndRenderingFromStore=function(a,b){var c=new DymoLoader(a);h(c.createDymoFromStore(),
c.createRenderingFromStore());l.loadBuffers(k.getDymoUri(),b)};this.loadDymoAndRendering=function(a,b,c,d){var k=new DymoLoader(DYMO_STORE);k.loadDymoFromJson(a,function(a){k.loadRenderingFromJson(b,function(b){h(a,b);l.loadBuffers(a,d);c&&c()})})};this.loadDymoFromJson=function(a,b){(new DymoLoader(DYMO_STORE)).loadDymoFromJson(a,b)};this.parseDymoFromJson=function(a,b){(new DymoLoader(DYMO_STORE)).parseDymoFromJson(a,b)};this.replacePartOfTopDymo=function(a,b){var c=DYMO_STORE.replacePartAt(f[0],
b,a);l.stop(c)};this.updateNavigatorPosition=function(a,b,c){l.updateNavigatorPosition(a,b,c)};this.getNavigatorPosition=function(a,b){return l.getNavigatorPosition(a,b)};this.syncNavigators=function(a,b,c){l.syncNavigators(a,b,c)};this.startPlayingUri=function(a){l.play(a)};this.stopPlayingUri=function(a){l.stop(a)};this.startPlaying=function(){for(var a=0;a<f.length;a++)DYMO_STORE.updatePartOrder(f[a],ONSET),l.play(f[a],k.getNavigator())};this.stopPlaying=function(){for(var a=0;a<f.length;a++)l.stop(f[a])};
this.getTopDymo=function(){return f[0]};this.getRendering=function(){return k};this.getUIControls=function(){return m};this.getUIControl=function(a){return m[a]};this.getSensorControls=function(){return n}};function DymoNode(a,b,c,d){this.POSITION_PARAMS=[PAN,HEIGHT,DISTANCE];this.dymoUri=a;this.parameters={};this.init(b,c,d)}
DymoNode.prototype.init=function(a,b,c){this.dryGain=a.createGain();this.addParameter(AMPLITUDE,this.dryGain.gain);b&&(this.reverbGain=this.createGain(a,this.dryGain,b),this.addParameter(REVERB,this.reverbGain.gain));c&&(this.delayGain=this.createGain(a,this.dryGain,c),this.addParameter(DELAY,this.delayGain.gain));if(DYMO_STORE.findParameterUri(this.dymoUri,PAN)||DYMO_STORE.findParameterUri(this.dymoUri,HEIGHT)||DYMO_STORE.findParameterUri(this.dymoUri,DISTANCE))this.panner=a.createPanner(),this.panner.connect(this.dryGain),
this.addParameter(PAN,{value:0}),this.addParameter(HEIGHT,{value:0}),this.addParameter(DISTANCE,{value:0});DYMO_STORE.findParameterUri(this.dymoUri,FILTER)&&(this.filter=a.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency.value=2E4,this.panner?this.filter.connect(this.panner):this.filter.connect(this.dryGain),this.addParameter(FILTER,this.filter.frequency))};DymoNode.prototype.createGain=function(a,b,c){a=a.createGain();a.connect(c);a.gain.value=0;b.connect(a);return a};
DymoNode.prototype.addParameter=function(a,b){DYMO_STORE.addParameterObserver(this.dymoUri,a,this);this.parameters[a]=b;var c=DYMO_STORE.findParameterValue(this.dymoUri,a);null!=c&&this.setParameter(a,c)};
DymoNode.prototype.setParameter=function(a,b){isNaN(b)||(this.parameters[a]&&(this.parameters[a].value||0==this.parameters[a].value?this.parameters[a].value=b:this.parameters[a].setValue(b)),0<=this.POSITION_PARAMS.indexOf(a)&&this.parameters[PAN]&&this.parameters[HEIGHT]&&this.parameters[DISTANCE]&&(0==this.parameters[DISTANCE].value&&(this.parameters[DISTANCE].value=-.01),this.panner.setPosition(this.parameters[PAN].value,this.parameters[HEIGHT].value,this.parameters[DISTANCE].value)))};
DymoNode.prototype.getDymoUri=function(){return this.dymoUri};DymoNode.prototype.observedValueChanged=function(a,b,c){this.setParameter(b,c)};DymoNode.prototype.getParameterValue=function(a){if(this.parameters[a])return this.parameters[a].value||0==this.parameters[a].value?this.parameters[a].value:this.parameters[a].getValue()};DymoNode.prototype.getInput=function(){return this.filter?this.filter:this.panner?this.panner:this.dryGain};DymoNode.prototype.connect=function(a){this.dryGain.connect(a)};
DymoNode.prototype.removeAndDisconnect=function(){for(var a in this.parameters)DYMO_STORE.removeParameterObserver(this.dymoUri,a,this);this.dryGain.disconnect();this.reverbGain&&this.reverbGain.disconnect();this.delayGain&&this.delayGain.disconnect()};function AudioProcessor(a){function b(a){return{extract:function(b,e,g){for(var h=[],l=0;l<a.numberOfChannels;l++)h.push(a.getChannelData(l));for(l=0;l<e;l++)for(var f=0;f<h.length;f++)b[l*h.length+f%h.length]=h[f][l+g];return Math.min(e,h[0].length-g)}}}this.timeStretch=function(c,d){var e=new SoundTouch(c.sampleRate);e.tempo=d;for(var g=b(c),e=new SimpleFilter(g,e),g=a.createBuffer(c.numberOfChannels,1/d*c.length,c.sampleRate),h=[],l=0;l<c.numberOfChannels;l++)h.push(g.getChannelData(l));for(var f=
new Float32Array(2048),k=e.extract(f,1024),m=0;k;){for(l=0;l<k;l++)for(var n=0;n<h.length;n++)h[n][l+m]=f[l*h.length+n%h.length];m+=k;k=e.extract(f,1024)}return g}};function AudioProcessorSource(a,b,c){var d=this,e=new SoundTouch(b.sampleRate);this.stretchRatio={setValue:function(a){e.tempo=a},getValue:function(){return e.tempo}};this.playbackRate={setValue:function(a){e.rate=a},getValue:function(){return e.rate}};var g=new SimpleFilter({extract:function(a,c,d){for(var n=[],e=0;e<b.numberOfChannels;e++)n.push(b.getChannelData(e));for(e=0;e<c;e++)for(var g=0;g<n.length;g++)a[e*n.length+g%n.length]=n[g][e+d];return Math.min(c,n[0].length-d)}},e),h=a.createScriptProcessor(1024,
2,b.numberOfChannels),l=new Float32Array(2048);h.onaudioprocess=function(a){for(var c=[],m=0;m<b.numberOfChannels;m++)c.push(a.outputBuffer.getChannelData(m));a=g.extract(l,1024);0==a&&d.stop();for(m=0;m<a;m++)for(var n=0;n<c.length;n++)c[n][m]=l[m*c.length+n%c.length]};this.start=function(a){setTimeout(function(){h.connect(c)},a)};this.stop=function(){h.disconnect()}};function Scheduler(a,b){function c(a){l.splice(l.indexOf(a),1)}function d(){for(var a=[],c=0;c<l.length;c++)for(var d=$jscomp.makeIterator(l[c].getAllSources().keys()),k=d.next();!k.done;k=d.next())for(k=k.value;null!=k;)0>a.indexOf(k)&&a.push(k),k=DYMO_STORE.findParents(k)[0];a.sort();f=a;b&&b(f)}function e(b,c){m++;var d=new XMLHttpRequest;d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){a.decodeAudioData(d.response,function(a){c(a,b)})};d.error=function(){};d.send()}var g=this,
h={},l=[],f=[],k,m=0;this.init=function(b){DYMO_STORE.addParameter(null,LISTENER_ORIENTATION,0,g);0<DYMO_STORE.find(null,null,REVERB).length&&(k=a.createConvolver(),k.connect(a.destination),e(b,function(a){k.buffer=a;0<m&&m--}));if(0<DYMO_STORE.find(null,null,DELAY).length){b=a.createDelay();b.delayTime.value=.5;b.connect(a.destination);var c=a.createGain();c.gain.value=.6;b.connect(c);c.connect(b)}};this.loadBuffers=function(a,b){for(var c=[],d=0,k=a.length;d<k;d++)var f=DYMO_STORE.findAllObjectsInHierarchy(a[d]),
c=c.concat(f.map(function(a){return DYMO_STORE.getSourcePath(a)}));d=0;for(k=c.length;d<k;d++)c[d]&&!h[c[d]]&&e(c[d],function(a,c){h[c]=a;0<m&&m--;0==m&&b&&b()});0==m&&b&&b()};this.getBuffer=function(a){return h[DYMO_STORE.getSourcePath(a)]};this.updateNavigatorPosition=function(a,b,c){for(var d=0,k=l.length;d<k;d++)l[d].hasDymo(a)&&l[d].getNavigator().setPosition(c,b,a)};this.getNavigatorPosition=function(a,b){for(var c=0,d=l.length;c<d;c++)if(l[c].hasDymo(a))return l[c].getNavigator().getPosition(b,
a)};this.syncNavigators=function(a,b,c){for(var d,k,m=0,e=l.length;m<e;m++)l[m].hasDymo(a)&&(d=l[m].getNavigator()),l[m].hasDymo(b)&&(k=l[m].getNavigator());k&&(b=k.getPosition(c,b),d.setPosition(b,c,a))};this.play=function(b,m){var e=new SchedulerThread(b,m,a,h,k,void 0,d,c);l.push(e)};this.pause=function(a){if(a)for(var b=0;b<l.length;b++)l[b].pause(a)};this.stop=function(a){if(a)for(var b=0;b<l.length;b++)l[b].stop(a)};this.getSources=function(a){for(var b=[],c=0;c<l.length;c++){var d=l[c].getSources(a);
if(d)for(var k=0;k<d.length;k++)b=b.concat(d)}return b};this.getUrisOfPlayingDymos=function(){return f};this.observedValueChanged=function(b,c,d){c==LISTENER_ORIENTATION&&(b=d/180*Math.PI,a.listener.setOrientation(Math.sin(b),0,-Math.cos(b),0,1,0))}};function DymoSource(a,b,c,d,e,g){function h(b,d){var e=b[0],f=b[1],f=1!=d?f+.3:f+FADE_LENGTH;if(c||isNaN(e+f)){if(0!=e||f<c.duration)c=m(c,k(e,c),k(f,c));return l(c,f,d)}n(DYMO_STORE.getSourcePath(a),e,e+f,function(a){return l(a,f,d)})}function l(a,c,d){1!=d&&(a=(new AudioProcessor(b)).timeStretch(a,d),a=m(a,0,k(c/d+FADE_LENGTH,a)));c=a;d=a.length;for(var n=c.sampleRate*FADE_LENGTH,e=0;e<c.numberOfChannels;e++)for(var f=c.getChannelData(e),p=0;p<n;p++)f[p]*=p/n,f[d-p-1]*=p/n;return a}function f(){u=
!1;var a=b.currentTime;v.parameters[AMPLITUDE].setValueAtTime(v.parameters[AMPLITUDE].value,a);v.parameters[AMPLITUDE].linearRampToValueAtTime(0,a+FADE_LENGTH);q.stop(a+2*FADE_LENGTH)}function k(a,b){if(a||0==a)return Math.round(a*b.sampleRate)}function m(a,c,d){d=Math.min(a.length-c,d);for(var k=b.createBuffer(a.numberOfChannels,d,a.sampleRate),m=0;m<a.numberOfChannels;m++)for(var n=k.getChannelData(m),e=a.getChannelData(m),f=0;f<d;f++)n[f]=e[c+f];return k}function n(a,b,c,d){var k=a.lastIndexOf("/");
k&&(a=a.substring(k+1));p("http://localhost:8060/getAudioChunk?filename="+a+"&fromSecond="+b+"&toSecond="+c,function(a){d(a)})}function p(a,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){b.decodeAudioData(d.response,function(a){c(a)},function(a){console.log("audio from server is faulty")})};d.send()}DymoNode.call(this,a,b,d,e);var v=this,u,t,r,q=b.createBufferSource();q.connect(this.getInput());(function(){var b=[DYMO_STORE.findFeatureValue(a,TIME_FEATURE),
DYMO_STORE.findFeatureValue(a,DURATION_FEATURE)];b[0]||(b[0]=0);!b[1]&&c&&(b[1]=c.duration-b[0]);var d=DYMO_STORE.findParameterValue(a,DURATION_RATIO);d&&0<d&&1>d&&(b[1]*=d);r=b[1];d=DYMO_STORE.findParameterValue(a,TIME_STRETCH_RATIO);q.buffer=h(b,d?d:1)})();this.addParameter(PLAYBACK_RATE,q.playbackRate);this.addParameter(TIME_STRETCH_RATIO,{value:0});this.addParameter(LOOP,{value:0});this.getDuration=function(){return r};this.isLoopingAndPlaying=function(){return q.loop&&u};this.play=function(a){q.onended=
function(){q.disconnect();v.removeAndDisconnect();g&&g(v)};a||(a=0);q.start(a);u=!0};this.pause=function(){u?(f(),t=!0):t&&(t=!1,this.play())};this.stop=function(){u&&f()}}inheritPrototype(DymoSource,DymoNode);function SchedulerThread(a,b,c,d,e,g,h,l){function f(){y=q?q:v();k(y);if(!z){var a=y.keys().next().value;z=DYMO_STORE.findParameterValue(a,ONSET)}a=w?w-c.currentTime:SCHEDULE_AHEAD_TIME;for(var b=c.currentTime+a,d=$jscomp.makeIterator(y.values()),m=d.next();!m.done;m=d.next())m.value.play(b);setTimeout(function(){h()},a);(q=v())&&0<q.size?(w=p(b),a=w[1],w=w[0],DYMO_STORE.findParameterValue(a.getDymoUri(),LOOP)&&(w-=FADE_LENGTH),a=1E3*(w-c.currentTime-SCHEDULE_AHEAD_TIME),x=setTimeout(function(){f()},
a)):(w=p(b),a=1E3*(w-c.currentTime),setTimeout(function(){n()},a+100))}function k(a){for(var b=$jscomp.makeIterator(a.keys()),c=b.next();!c.done;c=b.next())c=c.value,t.get(c)||t.set(c,[]),t.get(c).push(a.get(c))}function m(a){var b=t.get(a.getDymoUri());b.splice(b.indexOf(a),1);0>=b.length&&t.delete(a.getDymoUri());h();n()}function n(){if(0==t.size&&(!q||0==q.size)){window.clearTimeout(x);b.reset();for(var c=DYMO_STORE.findAllObjectsInHierarchy(a),d=0,k=c.length;d<k;d++){var m=r.get(c[d]);m&&m.removeAndDisconnect()}l&&
l()}}function p(a){if(q){var b=q.keys().next().value,b=DYMO_STORE.findParameterValue(b,ONSET),c=b-z;z=b;if(!isNaN(b))return a+c}for(var b=0,d,c=$jscomp.makeIterator(y.values()),k=c.next();!k.done;k=c.next()){var k=k.value,m=k.getDuration();m>b&&(b=m,d=k)}return[a+b,d]}function v(){var a=b.getNextParts();if(a){u(a);for(var k=new Map,n=0;n<a.length;n++){var f=DYMO_STORE.getSourcePath(a[n]);if(f){f=new DymoSource(a[n],c,d[f],e,g,m);a:{for(var p=f,h=DYMO_STORE.findParents(f.getDymoUri())[0];h;){if(r.has(h)){p.connect(r.get(h).getInput());
break a}var y=new DymoNode(h,c,e,g);p.connect(y.getInput());r.set(h,y);h=DYMO_STORE.findParents(h)[0];p=y}p.connect(c.destination)}k.set(a[n],f)}}return k}}function u(a){console.log(a.map(function(a){a=DYMO_STORE.findPartIndex(a);return isNaN(a)?"top":a}))}var t=new Map,r=new Map,q,x,y=[],w,z;b||(b=new DymoNavigator(a,new SequentialNavigator(a)));f();this.hasDymo=function(b){if(DYMO_STORE.findAllObjectsInHierarchy(a).indexOf(b))return!0};this.getNavigator=function(){return b};this.stop=function(a){a=
DYMO_STORE.findAllObjectsInHierarchy(a);for(var b=0,c=a.length;b<c;b++){var d=t.get(a[b]);if(d)for(var k=0;k<d.length;k++)d[k].stop();q&&(q.delete(a[b]),0>=q.size&&(q=void 0))}};this.getAllSources=function(){return t};this.getSources=function(a){return t.get(a)}};function AutoControl(a,b,c,d){DYMO_STORE.addParameter(a,AUTO_CONTROL_FREQUENCY,100,this);DYMO_STORE.addParameter(a,AUTO_CONTROL_TRIGGER,0,this);Control.call(this,a,b,AUTO_CONTROL);var e;this.startUpdate=function(b){b||(b=DYMO_STORE.findParameterValue(a,AUTO_CONTROL_FREQUENCY));e=setInterval(c,b)};this.reset=function(){clearInterval(e);e=null;d&&d()};this.observedValueChanged=function(a,b,c){b==AUTO_CONTROL_FREQUENCY?e&&(this.reset(),this.startUpdate(c)):b==AUTO_CONTROL_TRIGGER&&(e?this.reset():this.startUpdate())}}
inheritPrototype(AutoControl,Control);function BrownianControl(a,b){var c=this;b||(b=.5);AutoControl.call(this,a,BROWNIAN,function(){var b=DYMO_STORE.findParameterValue(a,BROWNIAN_MAX_STEP_SIZE),b=2*b*Math.random()-b,b=c.getValue()+b,b=Math.min(Math.max(b,0),1);c.update(b)});DYMO_STORE.addParameter(a,BROWNIAN_MAX_STEP_SIZE,.1,c);this.update(b);this.startUpdate()}inheritPrototype(BrownianControl,AutoControl);function RampControl(a,b,c){var d=this;b||(b=1E4);var e=0;c&&(e=c);var g=1!=e;AutoControl.call(this,a,RAMP,function(){var c=1/b*DYMO_STORE.findParameterValue(a,AUTO_CONTROL_FREQUENCY);g||(c*=-1);e+=c;0<e&&1>e?d.update(e):1<=e?(d.update(1),d.reset()):0>=e&&(d.update(0),d.reset())},function(){g=!g});this.update(e)}inheritPrototype(RampControl,AutoControl);function RandomControl(a){var b=this;AutoControl.call(this,a,RANDOM,function(){b.update(Math.random())});this.startUpdate()}inheritPrototype(RandomControl,AutoControl);function UIControl(a,b){var c=this;this.value=a.getValue();a.setUpdateFunction(function(a){c.value=a;b&&setTimeout(function(){b.$apply()},10)});this.getName=function(){return a.getName()};this.getType=function(){return a.getType()};this.update=function(){a.getType()==BUTTON&&(isNaN(this.value)&&(this.value=0),this.value=1-this.value);1==this.value?a.update(1):0==this.value?a.update(0):a.update(this.value)}};function DymoGenerator(a,b){function c(b,c){var k=d();a.addDymo(k,b,null,c);b||(p=k);return k}function d(){var a=CONTEXT_URI+"dymo"+x;x++;return a}function e(a){var b=[];if(a&&0<a.length){for(var c=0;c<a.length;c++)a[c].value.constructor!==Array&&(a[c].value=[a[c].value]);for(var c=a[0].value.length,d=0;d<c;d++)if("string"==typeof a[0].value[d])b[d]=a[0].value[d];else if(r==SUMMARY.FIRST)b[d]=a[0].value[d];else if(r==SUMMARY.MEAN)b[d]=a.reduce(function(a,b){return a+b.value[d]},0)/a.length;else if(r==
SUMMARY.MEDIAN){a.sort(function(a,b){return a.value[d]-b.value[d]});var k=Math.floor(a.length/2);b[d]=a[k].value[d];0==a.length%2&&(b[d]+=a[k-1].value[d])}return 1==b.length?b[0]:b}return 0}function g(){0==x?p=c(void 0,q):u&&(p=c(n,q),u=!1)}function h(b,c){for(var d=p,k=a.findLevel(p);k<c;){var m=a.findParts(d);if(0<m.length){m=m.map(function(b){return[a.findFeatureValue(b,TIME_FEATURE),b]});m.sort(function(a,b){return a[0]-b[0]});for(var n=0;n<m.length;n++)if(m[n][0]<=b)d=m[n][1];else if(0==n)d=
m[n][1];else break;k++}else break}return d}function l(a,b){void 0==a.max?(a.min=b,a.max=b):(a.min=Math.min(b,a.min),a.max=Math.max(b,a.max))}function f(a,b){for(var c=0;c<t.length;c++)if(t[c].name==a||t[c].uri==b)return t[c];return k(a,b)}function k(a,c,d,k){!a&&c&&(a=URI_TO_TERM[c]);a&&!c&&(c=CONTEXT_URI+a);a=void 0!=d&&void 0!=k?{name:a,uri:c,min:d,max:k}:{name:a,uri:c,min:1E3,max:0};2>t.length?t.push(a):t.splice(t.length-2,0,a);b(a);return a}var m=this,n,p,v,u,t,r=SUMMARY.MEAN,q,x=0;this.resetDymo=
function(){p=n=void 0;u=!1;t=[];k("level",LEVEL_FEATURE);k("random",null,0,1)};this.setStore=function(b){a=b};this.getStore=function(){return a};this.addRendering=function(){var b=CONTEXT_URI+"rendering0";b++;v=b;a.addRendering(v,p)};this.addMapping=function(b,c,d,k){a.addMapping(b,c,d,k)};this.addNavigator=function(b,c,d){a.addNavigator(v,b,c,d)};this.getCurrentTopDymo=function(){return p};this.getFeatures=function(){return t};this.setSummarizingMode=function(a){r=a};this.setCurrentSourcePath=function(a){q=
a};this.setAudioFileChanged=function(){u=!0;if(p){var b=d();a.addDymo(b,null,p);p=b}};this.addDymo=function(a,b){return c(a,b)};this.addFeature=function(b,c){Benchmarker.startTask("addFeature");g();for(var d=f(b),k=a.findAllObjectsInHierarchy(p),m=0;m<k.length;m++){var n=a.findFeatureValue(k[m],TIME_FEATURE),h=a.findFeatureValue(k[m],DURATION_FEATURE),r=c;isNaN(n)||(r=r.filter(function(a){return n<=a.time&&(isNaN(h)||a.time<n+h)}));if(1>r.length)var l=c.filter(function(a){return a.time.value<=n}),
r=0<l.length?[l[r.length-1]]:[c[0]];Benchmarker.startTask("summarize");r=e(r);this.setDymoFeature(k[m],d.uri,r)}};this.addSegmentation=function(b){g();for(var d=a.findMaxLevel(),k=0;k<b.length;k++){var n=h(b[k].time,d),f=b[k].time,e;if(b[k].duration)e=b[k].duration;else if(b[k+1])e=b[k+1].time-f;else{var p=a.findFeatureValue(n,TIME_FEATURE),r=a.findFeatureValue(n,DURATION_FEATURE);p&&r&&(e=p+r-f)}if(0<e){p=c(n);this.setDymoFeature(p,TIME_FEATURE,f);this.setDymoFeature(p,DURATION_FEATURE,e);var l=
p,f=a.findFeatureValue(n,TIME_FEATURE),p=a.findFeatureValue(l,TIME_FEATURE);if(isNaN(f)||Array.isArray(f)||p<f)m.setDymoFeature(n,TIME_FEATURE,p),f=p;r=a.findFeatureValue(n,DURATION_FEATURE);l=a.findFeatureValue(l,DURATION_FEATURE);(isNaN(r)||Array.isArray(r)||f+r<p+l)&&m.setDymoFeature(n,DURATION_FEATURE,p+l-f)}}};this.setDymoFeature=function(b,c,d){a.setFeature(b,c,d);if(!isNaN(d))l(f(null,c),d);else if(d instanceof Array)for(b=0;b<d.length;b++)l(f(null,c),d[b])};this.resetDymo()};function DymoTemplates(){}DymoTemplates.createSingleSourceDymoFromFeatures=function(a,b,c,d,e){a.addDymo(void 0,b);DymoTemplates.loadMultipleFeatures(a,c,d,0,function(){e()})};
DymoTemplates.createSimilarityDymoFromFeatures=function(a,b,c,d,e,g){a.addDymo(void 0,b);DymoTemplates.loadMultipleFeatures(a,c,d,0,function(){Similarity.addSimilaritiesTo(a.getCurrentTopDymo(),a.getStore(),e);a.addRendering();a.addNavigator(SIMILARITY_NAVIGATOR,"d","return d.getLevel() == 0");a.addNavigator(REPEATED_NAVIGATOR,"d","return d.getLevel() == 1");g()})};
DymoTemplates.createSimilaritySuccessorDymoFromFeatures=function(a,b,c,d,e,g){a.addDymo(void 0,b);DymoTemplates.loadMultipleFeatures(a,c,d,0,function(){Similarity.addSimilaritiesTo(a.getCurrentTopDymo(),a.getStore(),e);Similarity.addSuccessionGraphTo(a.getCurrentTopDymo(),a.getStore(),e);a.addRendering();a.addNavigator(GRAPH_NAVIGATOR,"d","return d.getLevel() == 0");a.addNavigator(REPEATED_NAVIGATOR,"d","return d.getLevel() == 1");g()})};
DymoTemplates.createAnnotatedBarAndBeatDymo=function(a,b,c){for(var d=[b[0],b[0]],e=["1",""],g=1;g<b.length;g++)d[g+1]=b[g],e[g+1]="";DymoTemplates.loadMultipleFeatures(a,d,e,0,c)};function getUris(a,b,c,d){for(var e=[],g=[],h=0,l=c.length;h<l;h++){var f=b.filter(function(a){return 0<a.indexOf(c[h])})[0];f&&(e.push(a+f),g.push(d[h]))}return[e,g]}
DymoTemplates.loadMultipleFeatures=function(a,b,c,d,e){Benchmarker.startTask("loadFeatures");var g=new FeatureLoader;d<b.length&&b[d]?g.loadFeature(b[d],c[d],a,function(){DymoTemplates.loadMultipleFeatures(a,b,c,d+1,e)}):d<b.length-1?DymoTemplates.loadMultipleFeatures(a,b,c,d+1,e):e&&e()};
DymoTemplates.createSebastianDymo=function(a,b,c){var d=a.getFeature("onset"),e=a.getFeature("pitch"),g=a.addDymo();a.setDymoFeature(g,d,0);a.setDymoFeature(g,e,0);c.get("getsourcefilesindir/",{params:{directory:"audio/Chopin_Op028-04_003_20100611-SMD/"}}).success(function(b){b=b.filter(function(a){return 4<a.split("_").length-1});for(var c=0;c<b.length;c++){var f=b[c].split("_"),k=f[f.length-1],k=Number.parseInt(k.substring(1,k.indexOf(".")),10)/1E3,f=Number.parseInt(f[f.length-3].substring(1),10),
m=a.addDymo(g,"audio/Chopin_Op028-04_003_20100611-SMD/"+b[c]);a.setDymoFeature(m,d,k);a.setDymoFeature(m,e,f)}DYMO_STORE.updatePartOrder(g,d.name)})};
DymoTemplates.createSebastianDymo2=function(a,b){var c=a.getFeature("onset"),d=a.getFeature("pitch"),e=a.addDymo();a.setDymoFeature(e,c,0);a.setDymoFeature(e,d,0);$http.get("getsourcefilesindir/",{params:{directory:"audio/scale_out/scale_single/"}}).success(function(b){b=b.filter(function(a){return 4<a.split("_").length-1});for(var h=0;h<b.length;h++){var l=b[h].split("_"),f=Number.parseInt(l[4].substring(1),10)/1E3,l=Number.parseInt(l[2].substring(1),10),k=a.addDymo(e,"audio/scale_out/scale_single/"+
b[h]);a.setDymoFeature(k,c,f);a.setDymoFeature(k,d,l)}DYMO_STORE.updatePartOrder(e,c.name)})};
DymoTemplates.createSebastianDymo3=function(a,b){var c=a.addDymo();a.setDymoFeature(c,ONSET_FEATURE,0);a.setDymoFeature(c,PITCH_FEATURE,0);a.setDymoFeature(c,DURATION_FEATURE,0);a.setDymoFeature(c,"velocity",0);a.setDymoFeature(c,"onsetS",0);a.setDymoFeature(c,"durationS",0);b.get("getsourcefilesindir/",{params:{directory:"audio/Chopin_Op028-11_003_20100611-SMD-cut/"}}).success(function(b){b=b.filter(function(a){return 4<a.split("_").length-1});for(var e=0;e<b.length;e++){var g=b[e].split("_"),h=
Number.parseInt(g[4].substring(1),10),l=Number.parseInt(g[6].substring(2),10)/1E3,f=Number.parseInt(g[7].substring(2),10)/1E3,k=Number.parseInt(g[8].substring(2),10),m=Number.parseInt(g[9].substring(2),10)/1E3,g=Number.parseInt(g[10].substring(2),10)/1E3,n=a.addDymo(c,"audio/Chopin_Op028-11_003_20100611-SMD-cut/"+b[e]);a.setDymoFeature(n,PITCH_FEATURE,h);a.setDymoFeature(n,ONSET_FEATURE,l);a.setDymoFeature(n,DURATION_FEATURE,f);a.setDymoFeature(n,"velocity",k);a.setDymoFeature(n,"onsetS",m);a.setDymoFeature(n,
"durationS",g);n.getParameter(ONSET).update(l)}DYMO_STORE.updatePartOrder(c,ONSET_FEATURE)})};
DymoTemplates.createAchBachDymo=function(a,b){var c=a.getFeature(ONSET_FEATURE),d=a.getFeature(PITCH_FEATURE),e=a.getFeature(DURATION_FEATURE),g=a.getFeature("onsetS"),h=a.getFeature("durationS"),l=a.getFeature("time"),f=a.addDymo();a.setDymoFeature(f,c,0);a.setDymoFeature(f,d,0);a.setDymoFeature(f,e,0);$http.get("audio/achachbach10/01-AchGottundHerr.txt").success(function(b){b=b.split("\n");for(var m=0;m<b.length;m++)b[m]=b[m].split("\t");b.sort(function(a,b){return a[0]-b[0]});for(var n=[],m=0;m<
b.length;m++){var p=b[m][0],v=b[m][1],u=Number.parseInt(b[m][3],10);if(n[u]){var t=n[u][0],r=v-n[u][2];b[t][4]=p-n[u][1];b[t][5]=r}n[u]=[m,p,v]}for(m=b.length-4;m<b.length;m++)b[m][4]=2700,b[m][5]=2700;for(m=0;m<b.length;m++)if(6==b[m].length){var n=b[m],p=Number.parseInt(n[2],10),v=Number.parseInt(n[0],10)/1E3,u=Number.parseInt(n[1],10)/1E3,t=Number.parseInt(n[4],10)/1E3,r=Number.parseInt(n[5],10)/1E3,q;1==n[3]?q=a.addDymo(f,"audio/achachbach10/01-AchGottundHerr-violin.wav"):2==n[3]?q=a.addDymo(f,
"audio/achachbach10/01-AchGottundHerr-clarinet.wav"):3==n[3]?q=a.addDymo(f,"audio/achachbach10/01-AchGottundHerr-saxphone.wav"):4==n[3]&&(q=a.addDymo(f,"audio/achachbach10/01-AchGottundHerr-bassoon.wav"));a.setDymoFeature(q,d,p);a.setDymoFeature(q,l,v);a.setDymoFeature(q,c,v);a.setDymoFeature(q,e,t);a.setDymoFeature(q,g,u);a.setDymoFeature(q,h,r);q.getParameter(ONSET).update(v)}DYMO_STORE.updatePartOrder(f,c.name)});$http.get("getsourcefilesindir/",{params:{directory:"audio/achachbach10/"}}).success(function(a){a=
a.filter(function(a){return 0<=a.indexOf("wav")});for(var b=0;b<a.length;b++);})};function createRandomTriangle(){return[{0:Math.random(),1:Math.random()},{0:Math.random(),1:Math.random()},{0:Math.random(),1:Math.random()}]};function FeatureLoader(){function a(a,k,m,n){u(a,function(f){b(f,function(b){c(b,function(c){0<c.length?(l(a,k,m,c),n&&n()):d(b,function(b){var c=b.name;c||(c=a.split("_"),c=c[c.length-1].split(".")[0]);m.addFeature(c,b.values);n&&n()})})})})}function b(a,b){var c=N3.Store();N3.Parser().parse(a,function(a,d,k){d?c.addTriple(d):b(c)})}function c(a,b){for(var c=[],d=a.find(null,"http://purl.org/NET/c4dm/event.owl#time",null),k=0,m=d.length;k<m;k++){var n=e(a,d[k].object,"http://purl.org/NET/c4dm/timeline.owl#at");
n||(n=e(a,d[k].object,"http://purl.org/NET/c4dm/timeline.owl#beginsAt"));var f=e(a,d[k].object,"http://purl.org/NET/c4dm/timeline.owl#duration"),n={time:h(n),label:g(e(a,d[k].subject,"http://www.w3.org/2000/01/rdf-schema#label"))};f&&(n.duration=h(f));c.push(n)}b(c)}function d(a,b){for(var c=g(e(a,null,"http://purl.org/dc/elements/1.1/title")),d=g(e(a,null,"http://purl.org/ontology/af/value")),d=d.split(" ").map(function(a){return parseFloat(a)}),k=g(e(a,null,"http://purl.org/ontology/af/dimensions")),
k=k.split(" ").map(function(a){return Number.parseInt(a,10)}),m=e(a,null,"http://purl.org/ontology/vamp/computed_by"),n=h(e(a,m,"http://purl.org/ontology/vamp/step_size")),m=h(e(a,m,"http://purl.org/ontology/vamp/sample_rate")),f=[],p=0;p<d.length;){for(var l=[],v=0;v<k[0];v++)l[v]=d[p+v];f.push({time:{value:p*n/m},value:l});p+=k[0]}b({name:c,values:f})}function e(a,b,c){a=a.find(b,c,null);if(0<a.length)return a[0].object}function g(a){if(a)return N3.Util.getLiteralValue(a)}function h(a){a=N3.Util.getLiteralValue(a);
"P"==a.charAt(0)&&(a=a.substring(2,a.length-1));return Number(a)}function l(a,b,c,d){t[a]=d.sort(function(a,b){return a.time.value-b.time.value});d=t[a];b&&t[a][0].label&&(d=d.filter(function(a){return a.label.value==b}));c.addSegmentation(d)}function f(a,b,c,d){u(a,function(a){k(JSON.parse(a),b,c,d)})}function k(a,b,c,d){"file_metadata"==Object.keys(a)[0]?m(a,b,c,d):n(a,b,c,d)}function m(a,b,c,d){a=a[Object.keys(a)[1]][0];var k=a.annotation_metadata.annotator.output_id;"beats"==k||"onsets"==k||"segmentation"==
k?(a=a.data,b&&a[0].value&&(a=a.filter(function(a){return a.value==b})),c.addSegmentation(a)):c.addFeature(k,a.data);d&&d()}function n(a,b,c,d){var k=a["@type"];"afv:BarandBeatTracker"==k||"afv:Onsets"==k?(a=a["afo:values"],b&&a[0]["afo:value"]&&(a=a.filter(function(a){return a["afo:value"]==b})),a=p(a),c.addSegmentation(a)):(a=v(a["afo:values"]),c.addFeature(k,a));d&&d()}function p(a){for(var b=[],c=0;c<a.length;c++)b.push({time:{value:a[c]["tl:at"]},label:{value:a[c]["afo:value"]}});return b}function v(a){for(var b=
[],c=0;c<a.length;c++)b.push({time:{value:a[c]["tl:at"]},value:[a[c]["afo:value"]]});return b}function u(a,b){var c=new XMLHttpRequest;c.addEventListener("load",function(){b(this.responseText)});c.addEventListener("error",function(){b(this.responseText)});c.open("GET",a);c.send()}var t={};this.loadFeature=function(b,c,d,m){if(b.constructor==Object)k(b,c,d,m);else{var n=b.split("."),n=n[n.length-1];"n3"==n?a(b,c,d,m):"json"==n&&f(b,c,d,m)}}};var SUMMARY={MEAN:"mean",MEDIAN:"median",FIRST:"first"};function Similarity(){}Similarity.addSimilaritiesTo=function(a,b,c){for(a=[a];0<a.length;){if(1<a.length){var d=Similarity.toVectors(a,b),d=Similarity.getCosineSimilarities(d);Similarity.addSimilaritiesAbove(b,d,c)}a=Similarity.getAllParts(a,b)}};
Similarity.addSuccessionGraphTo=function(a,b,c){for(a=[a];0<a.length;){if(1<a.length){for(var d=0;d<a.length-1;d++)b.addSuccessor(a[d],a[d+1]);var d=Similarity.toVectors(a,b),d=Similarity.getCosineSimilarities(d),e;for(e in d)for(var g in d[e])d[e][g]>c&&(addSuccessorToPredecessorOf(e,g,a,b),addSuccessorToPredecessorOf(g,e,a,b))}a=Similarity.getAllParts(a,b)}};function addSuccessorToPredecessorOf(a,b,c,d){a=c.indexOf(a);0<a&&d.addSuccessor(c[a-1],b)}
Similarity.addSimilaritiesAbove=function(a,b,c){for(var d in b)for(var e in b[d])b[d][e]>c&&(a.addSimilar(d,e),a.addSimilar(e,d))};Similarity.addHighestSimilarities=function(a,b,c){var d=[],e;for(e in b)for(var g in b[e])d.push([b[e][g],e,g]);d=d.sort(function(a,b){return b[0]-a[0]});b=0;for(c=Math.min(d.length,c);b<c;b++)e=d[b],a.addSimilar(e[1],e[2]),a.addSimilar(e[2],e[1])};Similarity.getAllParts=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++)c=c.concat(b.findParts(a[d]));return c};
Similarity.toVectors=function(a,b,c){for(var d=[],e=0,g=a.length;e<g;e++){for(var h=[],l=b.findAllFeatureValues(a[e]).filter(function(a){return"string"!=typeof a}),f=0,k=l.length;f<k;f++){var m=l[f];c&&1<m.length&&(m=Similarity.reduce(m));1<m.length?h=h.concat(m):(m=Number(m),h.push(m))}d[e]=h}for(var n=[],p=[],e=0;e<d[0].length;e++){b=[];for(f=0;f<a.length;f++)isNaN(d[f][e])||b.push(d[f][e]);n[e]=math.mean(b);p[e]=math.var(b)}d=d.map(function(a){return a.map(function(a,b){return(a-n[b])/p[b]})});
f={};for(e=0;e<d.length;e++)f[a[e]]=d[e];return f};Similarity.reduce=function(a){var b=Array.apply(null,Array(a.length)).map(Number.prototype.valueOf,1);return Similarity.getCosineSimilarity(a,b)};Similarity.getCosineSimilarities=function(a){var b={},c;for(c in a)for(var d in a)c<d&&(b[c]||(b[c]={}),b[c][d]=Similarity.getCosineSimilarity(a[c],a[d]));return b};Similarity.getCosineSimilarity=function(a,b){return a.length==b.length?math.dot(a,b)/(math.norm(a)*math.norm(b)):0};var DYMO_CONTEXT={"@context":{"@base":"http://tiny.cc/dymo-context/",xsd:"http://www.w3.org/2001/XMLSchema#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",sch:"http://schema.org/",mo:"http://purl.org/ontology/mo/",mt:"http://purl.org/ontology/studio/multitrack#",ch:"http://tiny.cc/charm-ontology#",dy:"http://tiny.cc/dymo-ontology#",mb:"http://tiny.cc/mobile-audio-ontology#",name:"sch:name",cdt:{"@id":"ch:cdt","@type":"@vocab"},adt:{"@id":"ch:adt","@type":"@vocab"},
value:"ch:value",parts:"ch:hasPart",Dymo:"dy:Dymo",DymoType:"dy:DymoType",Conjunction:"dy:Conjunction",Disjunction:"dy:Disjunction",Sequence:"dy:Sequence",Feature:"dy:Feature",Parameter:"dy:Parameter",FeatureType:"dy:FeatureType",ParameterType:"dy:ParameterType",level:"dy:LevelFeature",index:"dy:IndexFeature",onset:"dy:OnsetFeature",pitch:"dy:PitchFeature",duration:"dy:DurationFeature",time:"dy:TimeFeature",segmentLabel:"dy:SegmentLabelFeature",CustomFeature:"dy:CustomFeature",AudioParameter:"dy:AudioParameter",
hasStandardValue:"dy:hasStandardValue",isInteger:"dy:isInteger",Play:"dy:Play",Loop:"dy:Loop",Onset:"dy:Onset",DurationRatio:"dy:DurationRatio",Amplitude:"dy:Amplitude",PlaybackRate:"dy:PlaybackRate",TimeStretchRatio:"dy:TimeStretchRatio",Pan:"dy:Pan",Distance:"dy:Distance",Height:"dy:Height",Reverb:"dy:Reverb",Delay:"dy:Delay",Filter:"dy:Filter",StructuralParameter:"dy:StructuralParameter",PartCount:"dy:PartCount",PartDurationRatio:"dy:PartDurationRatio",PartProportion:"dy:PartProportion",CustomParameter:"dy:CustomParameter",
source:{"@id":"dy:hasSource","@type":"xsd:string"},parameters:{"@id":"dy:hasParameter","@type":"@vocab"},features:{"@id":"dy:hasFeature","@type":"@vocab"},paramType:{"@id":"dy:hasParameterType","@type":"@vocab"},featureType:{"@id":"dy:hasFeatureType","@type":"@vocab"},similars:"dy:hasSimilar",successors:"dy:hasSuccessor",Rendering:"mb:Rendering",Mapping:"mb:Mapping",Function:"mb:Function",MobileControl:"mb:MobileControl",SensorControl:"mb:SensorControl",UiControl:"mb:UiControl",AutoControl:"mb:AutoControl",
AccelerometerX:"mb:AccelerometerX",AccelerometerY:"mb:AccelerometerY",AccelerometerZ:"mb:AccelerometerZ",TiltX:"mb:TiltX",TiltY:"mb:TiltY",TiltZ:"mb:TiltZ",GeolocationLatitude:"mb:GeolocationLatitude",GeolocationLongitude:"mb:GeolocationLongitude",GeolocationDistance:"mb:GeolocationDistance",CompassHeading:"mb:CompassHeading",Beacon:"mb:Beacon",Slider:"mb:Slider",Toggle:"mb:Toggle",Button:"mb:Button",CustomControl:"mb:CustomControl",Random:"mb:Random",Brownian:"mb:Brownian",Ramp:"mb:Ramp",MobileParameter:"mb:MobileParameter",
GlobalParameter:"mb:GlobalParameter",ControlParameter:"mb:ControlParameter",ListenerOrientation:"mb:ListenerOrientation",AutoControlFrequency:"mb:AutoControlFrequency",AutoControlTrigger:"mb:AutoControlTrigger",BrownianMaxStepSize:"mb:BrownianMaxStepSize",LeapingProbability:"mb:LeapingProbability",ContinueAfterLeaping:"mb:ContinueAfterLeaping",Navigator:"mb:Navigator",OneShotNavigator:"mb:OneShotNavigator",RepeatedNavigator:"mb:RepeatedNavigator",SequentialNavigator:"mb:SequentialNavigator",SimilarityNavigator:"mb:SimilarityNavigator",
GraphNavigator:"mb:GraphNavigator",DomainDimension:"mb:DomainDimension",MappingTarget:"mb:MappingTarget",MappingRange:"mb:MappingRange",MappingOwners:"mb:MappingOwners",dymo:{"@id":"mb:hasDymo","@type":"@id"},mappings:"mb:hasMapping",domainDims:{"@id":"mb:hasDomainDimension","@type":"@vocab"},"function":"mb:hasFunction",args:"mb:hasArgument",body:"mb:hasBody",targets:{"@id":"mb:toTarget","@type":"@id"},range:{"@id":"mb:hasRange","@type":"@vocab"},relative:{"@id":"mb:isRelative","@type":"xsd:boolean"},
init:{"@id":"mb:hasInitialValue","@type":"xsd:float"},smooth:{"@id":"mb:isSmooth","@type":"xsd:boolean"},average:{"@id":"mb:isAverageOf","@type":"xsd:integer"},uuid:{"@id":"mb:hasUuid","@type":"xsd:string"},major:{"@id":"mb:hasMajor","@type":"xsd:integer"},minor:{"@id":"mb:hasMinor","@type":"xsd:integer"},rampDuration:{"@id":"mb:hasDuration","@type":"xsd:integer"},navigators:"mb:hasNavigator",dymos:"mb:navDymos"}},DYMO_SIMPLE_CONTEXT={"@context":{"@base":"http://tiny.cc/dymo-context/",xsd:"http://www.w3.org/2001/XMLSchema#",
rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",sch:"http://schema.org/",mo:"http://purl.org/ontology/mo/",mt:"http://purl.org/ontology/studio/multitrack#",ch:"http://tiny.cc/charm-ontology#",dy:"http://tiny.cc/dymo-ontology#",mb:"http://tiny.cc/mobile-audio-ontology#",name:"sch:name",cdt:"ch:cdt",adt:"ch:adt",value:"ch:value",parts:"ch:hasPart",Dymo:"dy:Dymo",DymoType:"dy:DymoType",Conjunction:"dy:Conjunction",Disjunction:"dy:Disjunction",Sequence:"dy:Sequence",
Feature:"dy:Feature",Parameter:"dy:Parameter",FeatureType:"dy:FeatureType",ParameterType:"dy:ParameterType",level:"dy:LevelFeature",index:"dy:IndexFeature",onset:"dy:OnsetFeature",pitch:"dy:PitchFeature",duration:"dy:DurationFeature",time:"dy:TimeFeature",segmentLabel:"dy:SegmentLabelFeature",CustomFeature:"dy:CustomFeature",AudioParameter:"dy:AudioParameter",hasStandardValue:"dy:hasStandardValue",isInteger:"dy:isInteger",Play:"dy:Play",Loop:"dy:Loop",Onset:"dy:Onset",DurationRatio:"dy:DurationRatio",
Amplitude:"dy:Amplitude",PlaybackRate:"dy:PlaybackRate",TimeStretchRatio:"dy:TimeStretchRatio",Pan:"dy:Pan",Distance:"dy:Distance",Height:"dy:Height",Reverb:"dy:Reverb",Delay:"dy:Delay",Filter:"dy:Filter",StructuralParameter:"dy:StructuralParameter",PartCount:"dy:PartCount",PartDurationRatio:"dy:PartDurationRatio",PartProportion:"dy:PartProportion",CustomParameter:"dy:CustomParameter",source:"dy:hasSource",parameters:"dy:hasParameter",features:"dy:hasFeature",paramType:"dy:hasParameterType",featureType:"dy:hasFeatureType",
similars:"dy:hasSimilar",successors:"dy:hasSuccessor",Rendering:"mb:Rendering",Mapping:"mb:Mapping",Function:"mb:Function",MobileControl:"mb:MobileControl",SensorControl:"mb:SensorControl",UiControl:"mb:UiControl",AutoControl:"mb:AutoControl",AccelerometerX:"mb:AccelerometerX",AccelerometerY:"mb:AccelerometerY",AccelerometerZ:"mb:AccelerometerZ",TiltX:"mb:TiltX",TiltY:"mb:TiltY",TiltZ:"mb:TiltZ",GeolocationLatitude:"mb:GeolocationLatitude",GeolocationLongitude:"mb:GeolocationLongitude",GeolocationDistance:"mb:GeolocationDistance",
CompassHeading:"mb:CompassHeading",Beacon:"mb:Beacon",Slider:"mb:Slider",Toggle:"mb:Toggle",Button:"mb:Button",CustomControl:"mb:CustomControl",Random:"mb:Random",Brownian:"mb:Brownian",Ramp:"mb:Ramp",MobileParameter:"mb:MobileParameter",GlobalParameter:"mb:GlobalParameter",ControlParameter:"mb:ControlParameter",ListenerOrientation:"mb:ListenerOrientation",AutoControlFrequency:"mb:AutoControlFrequency",AutoControlTrigger:"mb:AutoControlTrigger",BrownianMaxStepSize:"mb:BrownianMaxStepSize",LeapingProbability:"mb:LeapingProbability",
ContinueAfterLeaping:"mb:ContinueAfterLeaping",Navigator:"mb:Navigator",OneShotNavigator:"mb:OneShotNavigator",RepeatedNavigator:"mb:RepeatedNavigator",SequentialNavigator:"mb:SequentialNavigator",SimilarityNavigator:"mb:SimilarityNavigator",GraphNavigator:"mb:GraphNavigator",DomainDimension:"mb:DomainDimension",MappingTarget:"mb:MappingTarget",MappingRange:"mb:MappingRange",MappingOwners:"mb:MappingOwners",dymo:"mb:hasDymo",mappings:"mb:hasMapping",domainDims:"mb:hasDomainDimension","function":"mb:hasFunction",
args:"mb:hasArgument",body:"mb:hasBody",targets:"mb:toTarget",range:"mb:hasRange",relative:"mb:isRelative",init:"mb:hasInitialValue",smooth:"mb:isSmooth",average:"mb:isAverageOf",uuid:"mb:hasUuid",major:"mb:hasMajor",minor:"mb:hasMinor",rampDuration:"mb:hasDuration",navigators:"mb:hasNavigator",dymos:"mb:navDymos"}};var SCHEDULE_AHEAD_TIME=.1,FADE_LENGTH=.02,DYMO_ONTOLOGY_URI="http://tiny.cc/dymo-ontology#",DYMO_STORE;var URI_TO_TERM={"http://tiny.cc/dymo-ontology#LevelFeature":"level","http://tiny.cc/dymo-ontology#IndexFeature":"index","http://tiny.cc/dymo-ontology#OnsetFeature":"onset","http://tiny.cc/dymo-ontology#PitchFeature":"pitch","http://tiny.cc/dymo-ontology#DurationFeature":"duration","http://tiny.cc/dymo-ontology#TimeFeature":"time","http://tiny.cc/dymo-ontology#SegmentLabelFeature":"segmentLabel","http://tiny.cc/dymo-ontology#hasSource":"source","http://tiny.cc/dymo-ontology#hasParameter":"parameters",
"http://tiny.cc/dymo-ontology#hasFeature":"features","http://tiny.cc/dymo-ontology#hasParameterType":"paramType","http://tiny.cc/dymo-ontology#hasFeatureType":"featureType","http://tiny.cc/dymo-ontology#hasSimilar":"similars","http://tiny.cc/dymo-ontology#hasSuccessor":"successors","http://tiny.cc/mobile-audio-ontology#hasDymo":"dymo","http://tiny.cc/mobile-audio-ontology#hasMapping":"mappings","http://tiny.cc/mobile-audio-ontology#hasDomainDimension":"domainDims","http://tiny.cc/mobile-audio-ontology#hasFunction":"function",
"http://tiny.cc/mobile-audio-ontology#hasArgument":"args","http://tiny.cc/mobile-audio-ontology#hasBody":"body","http://tiny.cc/mobile-audio-ontology#toTarget":"targets","http://tiny.cc/mobile-audio-ontology#hasRange":"range","http://tiny.cc/mobile-audio-ontology#isRelative":"relative","http://tiny.cc/mobile-audio-ontology#hasInitialValue":"init","http://tiny.cc/mobile-audio-ontology#isSmooth":"smooth","http://tiny.cc/mobile-audio-ontology#isAverageOf":"average","http://tiny.cc/mobile-audio-ontology#hasUuid":"uuid",
"http://tiny.cc/mobile-audio-ontology#hasMajor":"major","http://tiny.cc/mobile-audio-ontology#hasMinor":"minor","http://tiny.cc/mobile-audio-ontology#hasDuration":"rampDuration","http://tiny.cc/mobile-audio-ontology#hasNavigator":"navigators","http://tiny.cc/mobile-audio-ontology#navDymos":"dymos"};var RDFS_URI="http://www.w3.org/2000/01/rdf-schema#",CONTEXT_URI="http://tiny.cc/dymo-context/",TYPE="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",FIRST="http://www.w3.org/1999/02/22-rdf-syntax-ns#first",REST="http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",NIL="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil",DOMAIN="http://www.w3.org/2000/01/rdf-schema#domain",RANGE="http://www.w3.org/2000/01/rdf-schema#range",LABEL="http://www.w3.org/2000/01/rdf-schema#label",NAME="http://schema.org/name",
CDT="http://tiny.cc/charm-ontology#cdt",ADT="http://tiny.cc/charm-ontology#adt",VALUE="http://tiny.cc/charm-ontology#value",HAS_PART="http://tiny.cc/charm-ontology#hasPart",DYMO="http://tiny.cc/dymo-ontology#Dymo",DYMO_TYPE="http://tiny.cc/dymo-ontology#DymoType",CONJUNCTION="http://tiny.cc/dymo-ontology#Conjunction",DISJUNCTION="http://tiny.cc/dymo-ontology#Disjunction",SEQUENCE="http://tiny.cc/dymo-ontology#Sequence",FEATURE="http://tiny.cc/dymo-ontology#Feature",PARAMETER="http://tiny.cc/dymo-ontology#Parameter",
FEATURE_TYPE="http://tiny.cc/dymo-ontology#FeatureType",PARAMETER_TYPE="http://tiny.cc/dymo-ontology#ParameterType",LEVEL_FEATURE="http://tiny.cc/dymo-ontology#LevelFeature",INDEX_FEATURE="http://tiny.cc/dymo-ontology#IndexFeature",ONSET_FEATURE="http://tiny.cc/dymo-ontology#OnsetFeature",PITCH_FEATURE="http://tiny.cc/dymo-ontology#PitchFeature",DURATION_FEATURE="http://tiny.cc/dymo-ontology#DurationFeature",TIME_FEATURE="http://tiny.cc/dymo-ontology#TimeFeature",SEGMENT_LABEL_FEATURE="http://tiny.cc/dymo-ontology#SegmentLabelFeature",
CUSTOM_FEATURE="http://tiny.cc/dymo-ontology#CustomFeature",AUDIO_PARAMETER="http://tiny.cc/dymo-ontology#AudioParameter",HAS_STANDARD_VALUE="http://tiny.cc/dymo-ontology#hasStandardValue",IS_INTEGER="http://tiny.cc/dymo-ontology#isInteger",PLAY="http://tiny.cc/dymo-ontology#Play",LOOP="http://tiny.cc/dymo-ontology#Loop",ONSET="http://tiny.cc/dymo-ontology#Onset",DURATION_RATIO="http://tiny.cc/dymo-ontology#DurationRatio",AMPLITUDE="http://tiny.cc/dymo-ontology#Amplitude",PLAYBACK_RATE="http://tiny.cc/dymo-ontology#PlaybackRate",
TIME_STRETCH_RATIO="http://tiny.cc/dymo-ontology#TimeStretchRatio",PAN="http://tiny.cc/dymo-ontology#Pan",DISTANCE="http://tiny.cc/dymo-ontology#Distance",HEIGHT="http://tiny.cc/dymo-ontology#Height",REVERB="http://tiny.cc/dymo-ontology#Reverb",DELAY="http://tiny.cc/dymo-ontology#Delay",FILTER="http://tiny.cc/dymo-ontology#Filter",STRUCTURAL_PARAMETER="http://tiny.cc/dymo-ontology#StructuralParameter",PART_COUNT="http://tiny.cc/dymo-ontology#PartCount",PART_DURATION_RATIO="http://tiny.cc/dymo-ontology#PartDurationRatio",
PART_PROPORTION="http://tiny.cc/dymo-ontology#PartProportion",CUSTOM_PARAMETER="http://tiny.cc/dymo-ontology#CustomParameter",HAS_SOURCE="http://tiny.cc/dymo-ontology#hasSource",HAS_PARAMETER="http://tiny.cc/dymo-ontology#hasParameter",HAS_FEATURE="http://tiny.cc/dymo-ontology#hasFeature",HAS_PARAMETER_TYPE="http://tiny.cc/dymo-ontology#hasParameterType",HAS_FEATURE_TYPE="http://tiny.cc/dymo-ontology#hasFeatureType",HAS_SIMILAR="http://tiny.cc/dymo-ontology#hasSimilar",HAS_SUCCESSOR="http://tiny.cc/dymo-ontology#hasSuccessor",
RENDERING="http://tiny.cc/mobile-audio-ontology#Rendering",MAPPING="http://tiny.cc/mobile-audio-ontology#Mapping",FUNCTION="http://tiny.cc/mobile-audio-ontology#Function",MOBILE_CONTROL="http://tiny.cc/mobile-audio-ontology#MobileControl",SENSOR_CONTROL="http://tiny.cc/mobile-audio-ontology#SensorControl",UI_CONTROL="http://tiny.cc/mobile-audio-ontology#UiControl",AUTO_CONTROL="http://tiny.cc/mobile-audio-ontology#AutoControl",ACCELEROMETER_X="http://tiny.cc/mobile-audio-ontology#AccelerometerX",
ACCELEROMETER_Y="http://tiny.cc/mobile-audio-ontology#AccelerometerY",ACCELEROMETER_Z="http://tiny.cc/mobile-audio-ontology#AccelerometerZ",TILT_X="http://tiny.cc/mobile-audio-ontology#TiltX",TILT_Y="http://tiny.cc/mobile-audio-ontology#TiltY",TILT_Z="http://tiny.cc/mobile-audio-ontology#TiltZ",GEOLOCATION_LATITUDE="http://tiny.cc/mobile-audio-ontology#GeolocationLatitude",GEOLOCATION_LONGITUDE="http://tiny.cc/mobile-audio-ontology#GeolocationLongitude",GEOLOCATION_DISTANCE="http://tiny.cc/mobile-audio-ontology#GeolocationDistance",
COMPASS_HEADING="http://tiny.cc/mobile-audio-ontology#CompassHeading",BEACON="http://tiny.cc/mobile-audio-ontology#Beacon",SLIDER="http://tiny.cc/mobile-audio-ontology#Slider",TOGGLE="http://tiny.cc/mobile-audio-ontology#Toggle",BUTTON="http://tiny.cc/mobile-audio-ontology#Button",CUSTOM_CONTROL="http://tiny.cc/mobile-audio-ontology#CustomControl",RANDOM="http://tiny.cc/mobile-audio-ontology#Random",BROWNIAN="http://tiny.cc/mobile-audio-ontology#Brownian",RAMP="http://tiny.cc/mobile-audio-ontology#Ramp",
MOBILE_PARAMETER="http://tiny.cc/mobile-audio-ontology#MobileParameter",GLOBAL_PARAMETER="http://tiny.cc/mobile-audio-ontology#GlobalParameter",CONTROL_PARAMETER="http://tiny.cc/mobile-audio-ontology#ControlParameter",LISTENER_ORIENTATION="http://tiny.cc/mobile-audio-ontology#ListenerOrientation",AUTO_CONTROL_FREQUENCY="http://tiny.cc/mobile-audio-ontology#AutoControlFrequency",AUTO_CONTROL_TRIGGER="http://tiny.cc/mobile-audio-ontology#AutoControlTrigger",BROWNIAN_MAX_STEP_SIZE="http://tiny.cc/mobile-audio-ontology#BrownianMaxStepSize",
LEAPING_PROBABILITY="http://tiny.cc/mobile-audio-ontology#LeapingProbability",CONTINUE_AFTER_LEAPING="http://tiny.cc/mobile-audio-ontology#ContinueAfterLeaping",NAVIGATOR="http://tiny.cc/mobile-audio-ontology#Navigator",ONE_SHOT_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#OneShotNavigator",REPEATED_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#RepeatedNavigator",SEQUENTIAL_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#SequentialNavigator",SIMILARITY_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#SimilarityNavigator",
GRAPH_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#GraphNavigator",DOMAIN_DIMENSION="http://tiny.cc/mobile-audio-ontology#DomainDimension",MAPPING_TARGET="http://tiny.cc/mobile-audio-ontology#MappingTarget",MAPPING_RANGE="http://tiny.cc/mobile-audio-ontology#MappingRange",MAPPING_OWNERS="http://tiny.cc/mobile-audio-ontology#MappingOwners",HAS_DYMO="http://tiny.cc/mobile-audio-ontology#hasDymo",HAS_MAPPING="http://tiny.cc/mobile-audio-ontology#hasMapping",HAS_DOMAIN_DIMENSION="http://tiny.cc/mobile-audio-ontology#hasDomainDimension",
HAS_FUNCTION="http://tiny.cc/mobile-audio-ontology#hasFunction",HAS_ARGUMENT="http://tiny.cc/mobile-audio-ontology#hasArgument",HAS_BODY="http://tiny.cc/mobile-audio-ontology#hasBody",TO_TARGET="http://tiny.cc/mobile-audio-ontology#toTarget",HAS_RANGE="http://tiny.cc/mobile-audio-ontology#hasRange",IS_RELATIVE="http://tiny.cc/mobile-audio-ontology#isRelative",HAS_INITIAL_VALUE="http://tiny.cc/mobile-audio-ontology#hasInitialValue",IS_SMOOTH="http://tiny.cc/mobile-audio-ontology#isSmooth",IS_AVERAGE_OF=
"http://tiny.cc/mobile-audio-ontology#isAverageOf",HAS_UUID="http://tiny.cc/mobile-audio-ontology#hasUuid",HAS_MAJOR="http://tiny.cc/mobile-audio-ontology#hasMajor",HAS_MINOR="http://tiny.cc/mobile-audio-ontology#hasMinor",HAS_DURATION="http://tiny.cc/mobile-audio-ontology#hasDuration",HAS_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#hasNavigator",NAV_DYMOS="http://tiny.cc/mobile-audio-ontology#navDymos";function OntologyLoader2(a,b,c){};function DymoLoader(a){function b(b,d){c(b,"",function(b){a.loadData(b,!0,d)})}function c(a,b,m){loadFile(a,function(f){if(0>f.indexOf("Cannot GET")){var e;a:{try{JSON.parse(f)}catch(g){e=!1;break a}e=!0}e&&(b?(0<=a.indexOf(k)&&(a=a.replace(k,"")),b=b.replace('"'+a+'"',f)):b=f);(f=d(b))?(0>f.indexOf(k)&&(f=k+f),c(f,b,m)):b&&m(JSON.parse(b))}})}function d(a){var b=a.indexOf(".json");if(0<=b){if(b!=a.indexOf("context.json")+7){var c=a.substring(0,b).lastIndexOf('"');return a.substring(c+1,b+5)}return d(a.substring(b+
1))}}function e(b){for(var c=0;c<b.length;c++)for(var d=a.findAllObjects(b[c],HAS_DOMAIN_DIMENSION),k=0;k<d.length;k++){var f=a.findObject(d[k],TYPE),e=a.findObjectValue(d[k],NAME);e||(e=d[k]);if(a.isSubclassOf(f,MOBILE_CONTROL)&&!m[d[k]]){var g=d[k],h=f,f=void 0;h==ACCELEROMETER_X||h==ACCELEROMETER_Y||h==ACCELEROMETER_Z?f=new AccelerometerControl(h):h==TILT_X||h==TILT_Y?f=new TiltControl(h):h==GEOLOCATION_LATITUDE||h==GEOLOCATION_LONGITUDE?f=new GeolocationControl(h):h==GEOLOCATION_DISTANCE?f=new DistanceControl:
h==COMPASS_HEADING?f=new CompassControl:h==BEACON?(f=a.findObjectValue(g,HAS_UUID),e=a.findObjectValue(g,HAS_MAJOR),h=a.findObjectValue(g,HAS_MINOR),f=new BeaconControl(f,e,h)):h==SLIDER||h==TOGGLE||h==BUTTON||h==CUSTOM_CONTROL?(f=new Control(g,e,h),e=a.findObjectValue(g,HAS_INITIAL_VALUE),f.update(e)):h==RANDOM?f=new RandomControl(g):h==BROWNIAN?(e=a.findObjectValue(g,HAS_INITIAL_VALUE),f=new BrownianControl(g,e)):h==RAMP&&(f=Math.round(1E3*a.findObject(g,HAS_DURATION)),e=a.findObjectValue(g,HAS_INITIAL_VALUE),
f=new RampControl(g,f,e));a.findObjectValue(g,IS_SMOOTH)&&f.setSmooth&&f.setSmooth(!0);g=a.findObjectValue(g,IS_AVERAGE_OF);!isNaN(g)&&f.setAverageOf&&f.setAverageOf(g);m[d[k]]=f}}}function g(b,c){var d=a.findAllObjects(b,TO_TARGET);if(0<d.length){var k=[],m=a.findFunction(d[0]);if(m)d=a.findAllSubjects(TYPE,DYMO),Array.prototype.push.apply(k,d);else for(var f=0;f<d.length;f++)k.push(d[f]);return h(b,c,k,m)}return h(b,c,[])}function h(b,c,d,k){for(var f=a.findObject(b,IS_RELATIVE),e=[],g=a.findAllObjects(b,
HAS_DOMAIN_DIMENSION),h=0;h<g.length;h++){var l=a.findObject(g[h],TYPE);l==FEATURE_TYPE||a.isSubtypeOf(l,FEATURE_TYPE)?(l==FEATURE_TYPE&&(l=g[h]),e.push(l)):l==PARAMETER_TYPE||a.isSubclassOf(l,PARAMETER_TYPE)?(l==CUSTOM_PARAMETER&&(l=g[h]),l=c?a.setParameter(c,l):a.setParameter(null,l),e.push(l)):e.push(m[g[h]])}g=$jscomp.makeIterator(a.findArgsAndBody(a.findObject(b,HAS_FUNCTION)));c=g.next().value;g=g.next().value;b=a.findObject(b,HAS_RANGE);return new Mapping(e,f,{args:c,body:g},d,b,k)}function l(a){return a==
SIMILARITY_NAVIGATOR?new SimilarityNavigator(void 0):a==GRAPH_NAVIGATOR?new GraphNavigator(void 0):a==ONE_SHOT_NAVIGATOR?new OneShotNavigator(void 0):a==REPEATED_NAVIGATOR?new RepeatedNavigator(void 0):new SequentialNavigator(void 0)}var f=this,k="",m={};this.loadDymoFromJson=function(a,c){var d=a.lastIndexOf("/")+1;k=a.substring(0,d);b(a,function(){c(f.createDymoFromStore())})};this.parseDymoFromJson=function(b,c){a.loadData(b,!0,function(){c(f.createDymoFromStore())})};this.loadRenderingFromJson=
function(a,c){b(a,function(){c(f.createRenderingFromStore())})};this.createDymoFromStore=function(){for(var b=a.findTopDymos(),c=0;c<b.length;c++){a.addBasePath(b[c],k);for(var d=a.findAllObjectsInHierarchy(b[c]),m=a.find(null,HAS_MAPPING),c=0;c<m.length;c++){var f=m[c].subject;if(0<=d.indexOf(f)){var h=m[c].object;e(h);g(h,f)}}}return b};this.createRenderingFromStore=function(){var b=a.findSubject(TYPE,RENDERING),c=new Rendering(a.findObject(b,HAS_DYMO)),d=a.findAllObjects(b,HAS_MAPPING);e(d);for(var k=
0;k<d.length;k++)c.addMapping(g(d[k]));b=a.findAllObjects(b,HAS_NAVIGATOR);for(k=0;k<b.length;k++)d=a.findObject(b[k],NAV_DYMOS),d=a.findFunction(d),c.addSubsetNavigator(d,l(a.findObject(b[k],TYPE)));return[c,m]}};function DymoStore(a){function b(a,c){for(var d=0;d<a.length;d++){var e=c(a[d]);if(e)return e}for(d=0;d<a.length;d++)if(e=b(h.findParents(a[d]),c))return e}function c(a,b,c){h.triplesToRdf(a,function(a){d(a,b,c)})}function d(a,b,c){a=a.split("_b").join("b");jsonld.fromRDF(a,{format:"application/nquads"},function(a,d){jsonld.frame(d,{"@id":b},function(a,b){jsonld.compact(b,DYMO_CONTEXT,function(a,b){jsonld.compact(b,DYMO_SIMPLE_CONTEXT,function(a,b){g(b);b=JSON.stringify(b,null,2);b=b.replace(/http:\/\/tiny.cc\/dymo-context\//g,
"");b=b.replace("http://tiny.cc/dymo-context-simple","http://tiny.cc/dymo-context");c(b)})})})})}function e(a,b){var d=h.findObject(a,TYPE,null),d=h.recursiveFindAllTriplesExcept(a,d);c(d,a,function(a){b(null,JSON.parse(a))})}function g(a){if(a&&a instanceof Object)for(var b in a)"@id"==b&&a[b].includes("_:b")?delete a[b]:g(a[b])}var h=this;EasyStore.call(this);var l={};(function(){h.loadFileIntoStore("../ontologies/dymo-ontology.n3",!1,function(){h.loadFileIntoStore("../ontologies/mobile-audio-ontology.n3",
!1,function(){a&&a()})})})();this.addBasePath=function(a,b){l[a]=b};this.getBasePath=function(a){return b([a],function(a){return l[a]})};this.getSourcePath=function(a){var b=this.findObjectValue(a,HAS_SOURCE);if(b)return this.getBasePath(a)+b;a=this.findParents(a);if(0<a.length)for(b=0;b<a.length;b++){var c=this.getSourcePath(a[b]);if(c)return c}};this.addSpecificParameterObserver=function(a,b){this.addValueObserver(a,VALUE,b)};this.addParameterObserver=function(a,b,c){a=this.setParameter(a,b);this.addValueObserver(a,
VALUE,c);return a};this.getParameterObservers=function(a,b){if(a&&b){var c=this.findObjectOfType(a,HAS_PARAMETER,b);if(c)return this.getValueObservers(c,VALUE)}};this.removeParameterObserver=function(a,b,c){a&&b&&(a=this.findObjectOfType(a,HAS_PARAMETER,b))&&this.removeValueObserver(a,VALUE,c)};this.addDymo=function(a,b,c,d,e){this.addTriple(a,TYPE,DYMO);b&&h.addObjectToList(b,HAS_PART,a);c&&h.addObjectToList(a,HAS_PART,c);d&&this.addTriple(a,HAS_SOURCE,N3.Util.createLiteral(d));e&&DYMO_STORE.setTriple(a,
CDT,e)};this.setParts=function(a,b){this.deleteList(a,HAS_PART);this.addObjectsToList(a,HAS_PART,b)};this.replacePartAt=function(a,b,c){if(a!=b)return this.replaceObjectInList(a,HAS_PART,b,c)};this.addSimilar=function(a,b){this.addTriple(a,HAS_SIMILAR,b)};this.addSuccessor=function(a,b){this.addTriple(a,HAS_SUCCESSOR,b)};this.setFeature=function(a,b,c){return this.setObjectValue(a,HAS_FEATURE,b,VALUE,c)};this.addParameter=function(a,b,c,d){this.setParameter(a,b,c);d&&this.addParameterObserver(a,b,
d)};this.setParameter=function(a,b,c){this.findParameterUri(a,b)||null!=c&&!isNaN(c)||(c=this.findObjectValue(b,HAS_STANDARD_VALUE,null));return this.setObjectValue(a,HAS_PARAMETER,b,VALUE,c)};this.addControl=function(a,b){a||(a=this.createBlankNode());this.addTriple(a,TYPE,b);return a};this.addRendering=function(a,b){this.addTriple(a,TYPE,RENDERING);this.addTriple(a,HAS_DYMO,b)};this.addMapping=function(a,b,c,d,e,g){var h=this.createBlankNode();this.addTriple(a,HAS_MAPPING,h);for(a=0;a<b.length;a++){var l=
this.createBlankNode();this.addTriple(h,HAS_DOMAIN_DIMENSION,l);b[a].name&&this.addTriple(l,NAME,N3.Util.createLiteral(b[a].name));b[a].type&&this.addTriple(l,TYPE,b[a].type)}b=this.addFunction(c[0],c[1]);this.addTriple(h,HAS_FUNCTION,b);if(d)for(a=0;a<d.length;a++)this.addTriple(h,TO_TARGET,d[a]);e&&(b=this.addFunction(e[0],e[1]),this.addTriple(h,TO_TARGET,b));this.addTriple(h,HAS_RANGE,g);return h};this.addNavigator=function(a,b,c,d){var e=this.createBlankNode();this.addTriple(a,HAS_NAVIGATOR,e);
this.addTriple(e,TYPE,b);a=this.addFunction(c,d);this.addTriple(e,NAV_DYMOS,a);return e};this.addFunction=function(a,b){var c=this.createBlankNode();this.addTriple(c,HAS_ARGUMENT,N3.Util.createLiteral(a));this.addTriple(c,HAS_BODY,N3.Util.createLiteral(b));return c};this.updatePartOrder=function(a,b){var c=this.findParts(a);0<c.length&&(c.sort(function(a,c){return h.findAttributeValue(a,b)-h.findAttributeValue(c,b)}),this.setParts(a,c))};this.findTopDymos=function(){var a=this.findAllSubjects(TYPE,
DYMO),b=this.findAllSubjects(HAS_PART),c=[].concat.apply([],b.map(function(a){return h.findParts(a)}));return a.filter(function(a){return 0>c.indexOf(a)})};this.findParts=function(a){return this.findAllObjects(a,HAS_PART)};this.findPartAt=function(a,b){return this.findObjectInListAt(a,HAS_PART,b)};this.findSimilars=function(a){return this.findAllObjects(a,HAS_SIMILAR)};this.findSuccessors=function(a){return this.findAllObjects(a,HAS_SUCCESSOR)};this.findParents=function(a){var b=this.findContainingLists(a);
return b[0].filter(function(a,c){return b[1][c]==HAS_PART})};this.findAllObjectsInHierarchy=function(a){var b=[a];a=this.findParts(a);for(var c=0;c<a.length;c++)b=b.concat(this.findAllObjectsInHierarchy(a[c]));return b};this.findDymoRelations=function(){var a=this.findAllSubjects(DOMAIN,DYMO),b=this.findAllSubjects(RANGE,DYMO);return[HAS_PART].concat(intersectArrays(a,b))};this.findMappings=function(a){return this.findAllObjects(a,HAS_MAPPING)};this.findNavigators=function(a){return this.findAllObjects(a,
HAS_NAVIGATOR)};this.findFunction=function(a){var b=$jscomp.makeIterator(this.findArgsAndBody(a));a=b.next().value;b=b.next().value;if(a&&b)return Function.apply(null,a.concat(b))};this.findArgsAndBody=function(a){var b=h.findAllObjectValues(a,HAS_ARGUMENT);a=h.findObjectValue(a,HAS_BODY);return[b,a]};this.findAttributeValue=function(a,b){var c=this.findParameterValue(a,b);null==c&&(c=this.findFeatureValue(a,b));return c};this.findFeatureValue=function(a,b){return b===LEVEL_FEATURE?this.findLevel(a):
b===INDEX_FEATURE?this.findPartIndex(a):this.findObjectValueOfType(a,HAS_FEATURE,b,VALUE)};this.findAllFeatureValues=function(a){return this.findAllObjectValuesOfType(a,HAS_FEATURE,VALUE)};this.findAllNumericFeatureValues=function(a){return this.findAllFeatureValues(a).filter(function(a){return!isNaN(a)})};this.findParameterValue=function(a,b){return this.findObjectValueOfType(a,HAS_PARAMETER,b,VALUE)};this.findParameterUri=function(a,b){return a?this.findObjectOfType(a,HAS_PARAMETER,b):this.findSubject(null,
b)};this.findPartIndex=function(a){var b=this.findParents(a)[0];return this.findObjectIndexInList(b,HAS_PART,a)};this.findLevel=function(a){var b=0;for(a=this.findParents(a)[0];a;)b++,a=this.findParents(a)[0];return b};this.findMaxLevel=function(){for(var a=this.findAllSubjects(TYPE,DYMO),b=0,c=0;c<a.length;c++)b=Math.max(b,this.findLevel(a[c]));return b};this.toJsonld=function(a){var b=this.findTopDymos()[0];this.toRdf(function(c){d(c,b,a)})};this.toJsonGraph=function(a,b,c){var d={nodes:[],edges:[]},
g={},l=this.findAllSubjects(TYPE,a),u=this.find(null,b,null);async.map(l,e,function(e,r){d.nodes=r;for(var q=0;q<l.length;q++)g[l[q]]=d.nodes[q];d.edges=[];for(q=0;q<u.length;q++)if(0==h.find(u[q].object,TYPE,a).length){if(0<h.find(u[q].object,FIRST).length){var x=h.findObjectOrList(u[q].subject,b),x=x.map(function(a){return{source:g[u[q].subject],target:g[a],value:1}});d.edges=d.edges.concat(x)}}else d.edges.push({source:g[u[q].subject],target:g[u[q].object],value:1});c(d)})}}
inheritPrototype(DymoStore,EasyStore);function DymoWriter(a,b){function c(a,b){var c=new XMLHttpRequest;c.send(b);c.addEventListener("save",function(){console.log("saved "+a)});c.addEventListener("error",function(){console.log("saving "+a+" failed")});c.open("POST",a);c.send()}this.writeToJsonld=function(b,e){e||(e="dymo.json");a.toJsonld(function(a){c(b+e,a)})}};function EasyStore(){function a(a,b,c){if(f[a]&&f[a][b]){b=f[a][b];var d=h.findObject(a,TYPE),e;for(e in b)b[e].observedValueChanged(a,d,c)}}function b(a,b){var c=l.find(null,a,b);if(0<c.length)return c[0].subject}function c(a){if(a){var b=h.findObject(a,FIRST);if(b){var c=[];c.push(b);for(a=h.findObject(a,REST);a!=NIL;)c.push(h.findObject(a,FIRST)),a=h.findObject(a,REST);return c}return a}}function d(a,b){if(a){for(var c=0,d=a,e=h.findObject(d,REST);e!=NIL&&(null==b||c<b);)d=e,e=h.findObject(d,REST),
c++;if(null==b||c==b)return d}}function e(a){var b=N3.Util.getLiteralValue(a);"http://www.w3.org/2001/XMLSchema#string"!=N3.Util.getLiteralType(a)&&(b=Number(b));return b}function g(a,b,c){b?jsonld.toRDF(a,{format:"application/nquads"},function(a,b){c(b)}):c(a)}var h=this,l=N3.Store(),f={};this.addValueObserver=function(a,b,c){f[a]||(f[a]={});f[a][b]||(f[a][b]=[]);f[a][b].push(c)};this.removeValueObserver=function(a,b,c){f[a]&&f[a][b]&&(c=f[a][b].indexOf(c),-1<c&&(f[a][b].splice(c,1),0==f[a][b].length&&
(delete f[a][b],0===Object.keys(f[a]).length&&delete f[a])))};this.getValueObservers=function(a,b){return f[a]&&f[a][b]?f[a][b]:[]};this.addTriple=function(a,b,c){null!=a&&null!=b&&null!=c&&l.addTriple(a,b,c)};this.removeTriple=function(a,b,c){c||(c=this.findObject(a,b));return l.removeTriple(a,b,c)};this.createBlankNode=function(){return l.createBlankNode()};this.setTriple=function(a,b,c){this.removeTriple(a,b);this.addTriple(a,b,c)};this.setValue=function(b,c,d){b&&c&&null!=d&&!Number.isNaN(d)&&
(Array.isArray(d)?(d=d.map(function(a){return N3.Util.createLiteral(a)}),this.removeTriple(b,c),this.addObjectsToList(b,c,d)):this.setTriple(b,c,N3.Util.createLiteral(d)),a(b,c,d))};this.setObjectValue=function(a,b,c,d,e){var f;a&&b?f=this.findObjectOfType(a,b,c):a||(f=this.findSubject(TYPE,c));f||(f=this.createBlankNode(),a&&b&&this.addTriple(a,b,f),this.addTriple(f,TYPE,c));this.setValue(f,d,e);return f};this.addObjectToList=function(a,b,c){var e=this.findObject(a,b),f=this.createBlankNode();e?
(a=d(e),this.removeTriple(a,REST,NIL),this.addTriple(a,REST,f)):this.addTriple(a,b,f);this.addTriple(f,FIRST,c);this.addTriple(f,REST,NIL)};this.addObjectsToList=function(a,b,c){for(var d=0,e=c.length;d<e;d++)this.addObjectToList(a,b,c[d])};this.replaceObjectInList=function(a,b,c,e){a=this.findObject(a,b);e=d(a,e);a=this.findObject(e,FIRST);this.setTriple(e,FIRST,c);return a};this.removeObjectFromList=function(a,b,c){a=this.findObject(a,b);this.createBlankNode();c=d(a,c-1);a=h.findObject(c,REST);
b=h.findObject(a,REST);this.setTriple(c,REST,b);this.removeTriple(a,FIRST);this.removeTriple(a,REST)};this.deleteList=function(a,b){var c=this.findObject(a,b);if(c){for(;c!=NIL;){this.removeTriple(c,FIRST);var d=h.findObject(c,REST);this.removeTriple(c,REST);c=d}this.removeTriple(a,b)}};this.find=function(a,b,c){return l.find(a,b,c)};this.findObject=function(a,b){if(a&&b){var c=l.find(a,b);if(0<c.length)return c[0].object}};this.findObjectOrList=function(a,b){return c(this.findObject(a,b))};this.findObjectValue=
function(a,b){var c=this.findObjectOrList(a,b);if(c)return Array.isArray(c)?c.map(e):e(c)};this.findObjectOfType=function(a,b,c){var d;a?(a=l.find(a,b).map(function(a){return a.object}),a=a.filter(function(a){return 0<l.find(a,TYPE,c).length}),0<a.length&&(d=a[0])):d=this.findSubject(TYPE,c);return d};this.findObjectValueOfType=function(a,b,c,d){a=this.findObjectOfType(a,b,c);return this.findObjectValue(a,d)};this.findAllObjects=function(a,b){var d=l.find(a,b).map(function(a){return a.object}),d=
d.map(c);return flattenArray(d)};this.findAllObjectValues=function(a,b){return this.findAllObjects(a,b).filter(N3.Util.isLiteral).map(e)};this.findAllObjectValuesOfType=function(a,b,c){var d=[];a=this.findAllObjects(a,b);b=0;for(var e=a.length;b<e;b++){var f=h.findObjectValue(a[b],c);null!=f&&d.push(f)}return d};this.findSubject=function(a,c){var d=b(a,c);d||(d=b(a,N3.Util.createLiteral(c)));return d};this.findAllSubjects=function(a,b){var c=l.find(null,a,b);0==c.length&&(c=l.find(null,a,N3.Util.createLiteral(b)));
return Array.from(new Set(c.map(function(a){return a.subject})))};this.findObjectIndexInList=function(a,b,c){if(a&&b){a:{var d=0;for(a=this.findObject(a,b);a!=NIL;){if(h.findObject(a,FIRST)==c){c=d;break a}a=h.findObject(a,REST);d++}c=-1}return c}};this.findObjectInListAt=function(a,b,c){if(a&&b&&(a=d(this.findObject(a,b),c)))return h.findObject(a,FIRST)};this.findContainingLists=function(a){var b=[],c=[];a=this.findAllSubjects(FIRST,a);for(var d=0;d<a.length;d++){for(var e=a[d],f=this.findSubject(REST,
e);f;)e=f,f=this.findSubject(REST,e);e=this.find(null,null,e)[0];b[d]=e.subject;c[d]=e.predicate}return[b,c]};this.recursiveFindAllTriplesExcept=function(a,b){for(var c=l.find(a,null,null),d=[],e=c.length-1;0<=e;e--)0<l.find(c[e].object,TYPE,b).length?c.splice(e,1):d=d.concat(this.recursiveFindAllTriplesExcept(c[e].object,b));return c.concat(d)};this.recursiveDeleteAllTriples=function(a){};this.findAllSubClasses=function(a){return this.findAllSubjects(RDFS_URI+"subClassOf",a)};this.isSubclassOf=function(a,
b){for(var c=this.findObject(a,RDFS_URI+"subClassOf");c;){if(c==b)return!0;c=this.findObject(c,RDFS_URI+"subClassOf")}return!1};this.isSubtypeOf=function(a,b){for(var c=this.findObject(a,TYPE);c;){if(c==b)return!0;c=this.findObject(c,TYPE)}return!1};this.loadData=function(a,b,c){g(a,b,function(a){N3.Parser().parse(a,function(a,b,d){b?l.addTriple(b):c&&c()})})};this.loadFileIntoStore=function(a,b,c){loadFile(a,function(a){h.loadData(a,b,c)})};this.toRdf=function(a){var b=l.find(null,null,null);this.triplesToRdf(b,
a)};this.triplesToRdf=function(a,b){for(var c=N3.Writer({format:"application/nquads"}),d=0;d<a.length;d++)c.addTriple(a[d]);c.end(function(a,c){b(c)})};this.logData=function(){var a=l.find(null).map(function(a){return a.subject+"\n"+a.predicate+"\n"+a.object}),b;for(b in a)console.log(a[b])}};function FunctionTools(){}FunctionTools.IDENTITY_JSON={args:["a"],body:"return a;"};FunctionTools.inverted={};FunctionTools.created={};FunctionTools.createFunction=function(a,b){FunctionTools.created[b]||(FunctionTools.created[b]=Function.apply(null,a.concat(b)));return FunctionTools.created[b]};
FunctionTools.invertFunction=function(a){var b=FunctionTools.toReturnValueString(a);FunctionTools.inverted[a]||(FunctionTools.inverted[a]=FunctionTools.toJavaScriptFunction(FunctionTools.invertReturnValue(b)));return FunctionTools.inverted[a]};
FunctionTools.invertReturnValue=function(a){var b;try{b=math.parse(a)}catch(e){e instanceof SyntaxError||console.log(e);return}for(var c=a=new math.expression.node.SymbolNode("a");b;)if(b.isSymbolNode)a.name=b.name,b=void 0;else if(b.isParenthesisNode)b=b.content;else if(b.isOperatorNode){var d=FunctionTools.getInvertedOperator(b.op);if("+"==b.op||"*"==b.op)if(b.args[0].isConstantNode)c=new math.expression.node.OperatorNode(d,FunctionTools.getOperatorName(d),[c,b.args[0]]),b=FunctionTools.ifNextNode(b.args[1]);
else if(b.args[1].isConstantNode)c=new math.expression.node.OperatorNode(d,FunctionTools.getOperatorName(d),[c,b.args[1]]),b=FunctionTools.ifNextNode(b.args[0]);else return;else if("-"==b.op||"/"==b.op)if(b.args[0].isConstantNode)c=new math.expression.node.OperatorNode(b.op,FunctionTools.getOperatorName(b.op),[b.args[0],c]),b=FunctionTools.ifNextNode(b.args[1]);else if(b.args[1].isConstantNode)c=new math.expression.node.OperatorNode(d,FunctionTools.getOperatorName(d),[c,b.args[1]]),b=FunctionTools.ifNextNode(b.args[0]);
else return}else return;return c.toString()};FunctionTools.toJavaScriptFunction=function(a){try{return new Function("a","return "+a+";")}catch(b){}};FunctionTools.toReturnValueString=function(a){return a.substring(a.indexOf("return ")+7,a.indexOf(";"))};FunctionTools.ifNextNode=function(a){if(a.isOperatorNode||a.isParenthesisNode||a.isSymbolNode)return a};FunctionTools.getInvertedOperator=function(a){if("+"==a)return"-";if("-"==a)return"+";if("*"==a)return"/";if("/"==a)return"*"};
FunctionTools.getOperatorName=function(a){if("+"==a)return"add";if("-"==a)return"subtract";if("*"==a)return"multiply";if("/"==a)return"divide"};function PolygonTools(){}PolygonTools.isPointInPolygon=function(a,b){for(var c=!1,d=-1,e=a.length,g=e-1;++d<e;g=d)(a[d][1]<=b[1]&&b[1]<a[g][1]||a[g][1]<=b[1]&&b[1]<a[d][1])&&b[0]<(a[g][0]-a[d][0])*(b[1]-a[d][1])/(a[g][1]-a[d][1])+a[d][0]&&(c=!c);return c};PolygonTools.getArea=function(a){var b=0,c,d,e=0;for(d=a.length-1;e<a.length;d=e,e++)c=a[e],d=a[d],b+=c[0]*d[1],b-=c[1]*d[0];return b/2};
PolygonTools.getCentroid=function(a){var b,c,d,e=0,g=0,h=0;for(c=a.length-1;h<a.length;c=h,h++)b=a[h],c=a[c],d=b[0]*c[1]-c[0]*b[1],e+=(b[0]+c[0])*d,g+=(b[1]+c[1])*d;d=6*PolygonTools.getArea(a);return{0:e/d,1:g/d}};function sqDist(a,b){return Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)}
PolygonTools.getDistanceFromSegment=function(a,b,c){var d=sqDist(b,c);if(0==d)return sqDist(a,b);d=((a[0]-b[0])*(c[0]-b[0])+(a[1]-b[1])*(c[1]-b[1]))/d;return 0>d?sqDist(a,b):1<d?sqDist(a,c):Math.sqrt(sqDist(a,{0:b[0]+d*(c[0]-b[0]),1:b[1]+d*(c[1]-b[1])}))};PolygonTools.getMinDistanceFromEdge=function(a,b){for(var c=Number.POSITIVE_INFINITY,d=0;d<a.length;d++)var e=PolygonTools.getDistanceFromSegment(b,a[d],a[(d+1)%a.length]),c=Math.min(e,c);return c};
PolygonTools.howFarIsPointInPolygon=function(a,b,c){return PolygonTools.isPointInPolygon(a,c)?(b=Math.sqrt(Math.pow(c[0]-b[0],2)+Math.pow(c[1]-b[1],2)),a=PolygonTools.getMinDistanceFromEdge(a,c),Math.sqrt((1-b)*a/Math.abs(b+a))):0};PolygonTools.getPolygonFunctionArgs=function(a){return[["a","b"],"return PolygonTools.isPointInPolygon("+getPolygonOrPointString(a)+", {0:a, 1:b});"]};
PolygonTools.getInterpolatedPolygonFunctionArgs=function(a){var b=getPolygonOrPointString(a);a=getPolygonOrPointString(PolygonTools.getCentroid(a));return[["a","b"],"return PolygonTools.howFarIsPointInPolygon("+b+","+a+", {0:a, 1:b});"]};function getPolygonOrPointString(a){return JSON.stringify(a).replace(/"/g,"'")};function Control(a,b,c){this.uri=a;this.name=b;this.type=c;this.mappings=[]}Control.prototype.getName=function(){return this.name};Control.prototype.getUri=function(){return this.uri};Control.prototype.getValue=function(){return this.value};Control.prototype.getType=function(){return this.type};Control.prototype.setUpdateFunction=function(a){this.updateFunction=a};Control.prototype.addMapping=function(a){this.mappings.push(a);a.updateParameter(this.value,this)};
Control.prototype.removeMapping=function(a){a=this.mappings.indexOf(a);-1<a&&this.mappings.splice(a,1)};Control.prototype.backpropagate=function(a,b){isFinite(a)&&(this.setValue(a,b),this.updateFunction&&this.updateFunction(this.value))};Control.prototype.update=function(a){isNaN(a)||this.setValue(a)};Control.prototype.setValue=function(a,b){if(void 0==this.value||1E-6<Math.abs(a-this.value))this.value=a,this.updateMappings(b)};
Control.prototype.updateMappings=function(a){for(var b=0;b<this.mappings.length;b++)this.mappings[b]!=a&&this.mappings[b].updateParameter(this.value,this)};function Mapping(a,b,c,d,e,g){this.relative=b;this.functionJson=c;this.parameterName=e;this.setTargets(d);this.domainDims=a;this.dymoConstraint=g;this.init()}
Mapping.prototype.init=function(){this.functionJson||(this.functionJson=FunctionTools.IDENTITY_JSON);this.mappingFunction=FunctionTools.createFunction(this.functionJson.args,this.functionJson.body);this.inverseFunction=FunctionTools.invertFunction(this.functionJson.body);for(var a=0;a<this.domainDims.length;a++)this.domainDims[a].addMapping?this.domainDims[a].addMapping(this):("string"===typeof this.domainDims[a]||this.domainDims[a]instanceof String)&&DYMO_STORE.addSpecificParameterObserver(this.domainDims[a],
this)};Mapping.prototype.setTargets=function(a){if(this.targetUris)for(var b=0,c=this.targetUris.length;b<c;b++)DYMO_STORE.removeParameterObserver(this.targetUris[b],this.parameterName,this);this.targetUris=a;b=0;for(c=this.targetUris.length;b<c;b++)DYMO_STORE.addParameterObserver(this.targetUris[b],this.parameterName,this)};Mapping.prototype.getTargets=function(){return this.targetUris};Mapping.prototype.getDymoConstraint=function(){return this.dymoConstraint};
Mapping.prototype.disconnect=function(){for(var a=0;a<this.domainDims.length;a++)if(this.domainDims[a].removeMapping)this.domainDims[a].removeMapping(this);else if("string"===typeof this.domainDims[a]||this.domainDims[a]instanceof String){var b=DYMO_STORE.findObject(this.domainDims[a],TYPE);console.log(b);DYMO_STORE.isSubclassOf(b,PARAMETER_TYPE)&&DYMO_STORE.removeValueObserver(this.domainDims[a],VALUE,this)}a=0;for(b=this.targetUris.length;a<b;a++)DYMO_STORE.removeParameterObserver(this.targetUris[a],
this.parameterName,this)};Mapping.prototype.updateParameter=function(){if(0<this.targetUris.length)for(var a=0,b=this.targetUris.length;a<b;a++)DYMO_STORE.setParameter(this.targetUris[a],this.parameterName,this.calculateParameter(this.targetUris[a]));else DYMO_STORE.setParameter(null,this.parameterName,this.calculateParameter(this.targetUris[a]))};
Mapping.prototype.observedValueChanged=function(a,b,c){-1<this.domainDims.indexOf(a)?this.updateParameter():this.domainDims&&this.domainDims[0].backpropagate&&!this.relative&&(this.inverseFunction&&(c=this.inverseFunction(c)),this.domainDims[0].backpropagate(c,this))};Mapping.prototype.observedParameterChanged=function(a){this.updateParameter()};Mapping.prototype.requestValue=function(a){for(var b=0;b<this.domainDims.length;b++)this.domainDims[b].requestValue&&this.domainDims[b].requestValue();return this.calculateParameter(a)};
Mapping.prototype.calculateParameter=function(a){for(var b=[],c=0;c<this.domainDims.length;c++){var d;"string"===typeof this.domainDims[c]||this.domainDims[c]instanceof String?(d=DYMO_STORE.findAttributeValue(a,this.domainDims[c]),null==d&&(d=DYMO_STORE.findObjectValue(this.domainDims[c],VALUE))):d=this.domainDims[c].getValue();b[c]=d}return this.mappingFunction.apply(this,b)};function Rendering(a){var b=[],c;this.play=function(){a&&DYMO_STORE.setParameter(a,PLAY,1)};this.stop=function(){a&&DYMO_STORE.setParameter(a,PLAY,0)};this.addMapping=function(a){b.push(a);a.updateParameter()};this.getMappings=function(){return b};this.addSubsetNavigator=function(b,e){c||(c=new DymoNavigator(a));c.addSubsetNavigator(b,e)};this.getNavigator=function(){return c}};function GraphNavigator(a){var b=0;this.resetPartsPlayed=function(){b=0};this.getType=function(){return GRAPH_NAVIGATOR};this.getCopy=function(a){return new GraphNavigator(a)};this.getCurrentParts=function(){if(0<DYMO_STORE.findParts(a).length){var c;c=(c=DYMO_STORE.findPartAt(a,b))?[c]:void 0;a:{if(c&&0<c.length){var d=DYMO_STORE.findSuccessors(c[0]);if(0<d.length){b=DYMO_STORE.findPartIndex(d[Math.floor(Math.random()*d.length)]);break a}}b=void 0}return c}};this.getNextParts=function(){return this.getCurrentParts()}}
;function DymoNavigator(a,b,c){function d(){f=new Map;k=[];c||(c=new OneShotNavigator(void 0))}function e(a){if(a){var b=h(a);if(b){k[DYMO_STORE.findLevel(a)]=b;if(b.getType()==ONE_SHOT_NAVIGATOR||b.getType()==REPEATED_NAVIGATOR)return b.getCurrentParts();a=b.getCurrentParts();return(a=g(a))?a:g(b.getNextParts())}return[a]}}function g(a){if(a&&0<a.length){for(var b=[],c=0,d=a.length;c<d;c++){var f=e(a[c]);f&&(f.length?b=b.concat(f):b.push(f))}if(0<b.length)return b}}function h(a){if(!f.has(a)){for(var d=
0,e=l.length;d<e;d++)l[d][0](a)&&f.set(a,l[d][1].getCopy(a));f.has(a)||(b&&0<DYMO_STORE.findParts(a).length?f.set(a,b.getCopy(a)):f.set(a,c.getCopy(a)))}return f.get(a)}var l=[],f,k;d();this.reset=function(a){if(a){var b=DYMO_STORE.findAllObjectsInHierarchy(a);b.splice(b.indexOf(a),1);a=0;for(var c=b.length;a<c;a++){var e=f.delete(b[a]);(e=k.indexOf(e))&&k.splice(e,1)}}else d()};this.addSubsetNavigator=function(a,b){l.push([a,b])};this.getSubsetNavigators=function(){return l};this.getPosition=function(b,
c){c||(c=a);for(var d=0;d<b;){if(!f.has(c))return;c=f.get(c).getCurrentParts()[0];d++}if((d=f.get(c))&&d.getPartsNavigated)return f.get(c).getPartsNavigated()};this.setPosition=function(b,c,d){d||(d=a);for(var e=0;e<=c&&d;){var f=h(d);e==c&&f.setPartsNavigated?(f.setPartsNavigated(b),this.reset(d)):d=f.getCurrentParts()?f.getCurrentParts()[0]:void 0;e++}};this.getNextParts=function(){return e(a)}};function OneShotNavigator(a){var b=!1;this.getType=function(){return ONE_SHOT_NAVIGATOR};this.getCopy=function(a){return new OneShotNavigator(a)};this.getCurrentParts=function(){if(!b){var c=DYMO_STORE.findParameterValue(a,LOOP);c&&1==c||(b=!0);return[a]}};this.getNextParts=function(){return this.getCurrentParts()}};function RepeatedNavigator(a){this.getType=function(){return REPEATED_NAVIGATOR};this.getCopy=function(a){return new RepeatedNavigator(a)};this.getCurrentParts=function(){return[a]};this.getNextParts=function(){return this.getCurrentParts()}};function SequentialNavigator(a,b){var c=0;this.resetPartsNavigated=function(){c=0};this.setPartsNavigated=function(a){c=a};this.getPartsNavigated=function(){return c};this.getType=function(){return SEQUENTIAL_NAVIGATOR};this.getCopy=function(a){return new SequentialNavigator(a,b)};this.getDymo=function(){return a};this.getCurrentParts=function(){if(0<DYMO_STORE.findParts(a).length){if(DYMO_STORE.findObject(a,CDT)==CONJUNCTION){var d;d=0>=c?DYMO_STORE.findParts(a):void 0;return d}d=DYMO_STORE.findParts(a);
d=(d=b?d[d.length-c]:d[c])?[d]:void 0;return d}};this.getNextParts=function(){c++;return this.getCurrentParts()}};function SimilarityNavigator(a){function b(b){if(b){if(b&&0<b.length)for(var e=0;e<b.length;e++){var g=DYMO_STORE.findSimilars(b[e]);if(0<g.length&&Math.random()<DYMO_STORE.findParameterValue(null,LEAPING_PROBABILITY)){var h=Math.floor(Math.random()*g.length);if(0<DYMO_STORE.findParameterValue(null,CONTINUE_AFTER_LEAPING)){var l=DYMO_STORE.findParts(a).indexOf(h);l&&(c=l+1)}b[e]=g[h]}}return b}}var c=0;this.resetPartsPlayed=function(){c=0};this.getType=function(){return SIMILARITY_NAVIGATOR};this.getCopy=
function(a){return new SimilarityNavigator(a)};this.getCurrentParts=function(){if(0<DYMO_STORE.findParts(a).length){if(DYMO_STORE.findObject(a,CDT)==CONJUNCTION){var d;0>=c?(c++,d=DYMO_STORE.findParts(a)):d=void 0;return b(d)}(d=DYMO_STORE.findPartAt(a,c))?(0==DYMO_STORE.findParts(d).length&&c++,d=[d]):d=void 0;return b(d)}};this.getNextParts=function(){c++;return this.getCurrentParts()}};function loadFile(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.onload=function(){b(this.responseText)};c.error=function(a){console.log(a)};c.send()}function flattenArray(a){return a.reduce(function(a,c){return a.concat(Array.isArray(c)?flattenArray(c):c)},[])}function intersectArrays(a,b){if(a&&b){var c;b.length>a.length&&(c=b,b=a,a=c);return a.filter(function(a){if(-1!==b.indexOf(a))return!0})}return[]};function inheritPrototype(a,b){var c=Object.create(b.prototype);c.constructor=a;a.prototype=c};function SoundTouch(a){this.rateTransposer=new RateTransposer(!1);this.tdStretch=new Stretch(!1,a);this._inputBuffer=new FifoSampleBuffer;this._intermediateBuffer=new FifoSampleBuffer;this._outputBuffer=new FifoSampleBuffer;this.tempo=this._rate=0;this.virtualTempo=this.virtualRate=this.virtualPitch=1;this._calculateEffectiveRateAndTempo()}
extend(SoundTouch.prototype,{clear:function(){this.rateTransposer.clear();this.tdStretch.clear()},clone:function(){var a=new SoundTouch;a.rate=this._rate;a.tempo=this.tempo;return a},get rate(){return this._rate},set rate(a){this.virtualRate=a;this._calculateEffectiveRateAndTempo()},set rateChange(a){this.rate=1+.01*a},get tempo(){return this._tempo},set tempo(a){this.virtualTempo=a;this._calculateEffectiveRateAndTempo()},set tempoChange(a){this.tempo=1+.01*a},set pitch(a){this.virtualPitch=a;this._calculateEffectiveRateAndTempo()},
set pitchOctaves(a){this.pitch=Math.exp(.69314718056*a);this._calculateEffectiveRateAndTempo()},set pitchSemitones(a){this.pitchOctaves=a/12},get inputBuffer(){return this._inputBuffer},get outputBuffer(){return this._outputBuffer},_calculateEffectiveRateAndTempo:function(){var a=this._tempo,b=this._rate;this._tempo=this.virtualTempo/this.virtualPitch;this._rate=this.virtualRate*this.virtualPitch;testFloatEqual(this._tempo,a)&&(this.tdStretch.tempo=this._tempo);testFloatEqual(this._rate,b)&&(this.rateTransposer.rate=
this._rate);1<this._rate?this._outputBuffer!=this.rateTransposer.outputBuffer&&(this.tdStretch.inputBuffer=this._inputBuffer,this.tdStretch.outputBuffer=this._intermediateBuffer,this.rateTransposer.inputBuffer=this._intermediateBuffer,this.rateTransposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.tdStretch.outputBuffer&&(this.rateTransposer.inputBuffer=this._inputBuffer,this.rateTransposer.outputBuffer=this._intermediateBuffer,this.tdStretch.inputBuffer=this._intermediateBuffer,this.tdStretch.outputBuffer=
this._outputBuffer)},process:function(){1<this._rate?(this.tdStretch.process(),this.rateTransposer.process()):(this.rateTransposer.process(),this.tdStretch.process())}});function FifoSampleBuffer(){this._vector=new Float32Array;this._frameCount=this._position=0}
FifoSampleBuffer.prototype={get vector(){return this._vector},get position(){return this._position},get startIndex(){return 2*this._position},get frameCount(){return this._frameCount},get endIndex(){return 2*(this._position+this._frameCount)},clear:function(){this.receive();this.rewind()},put:function(a){this._frameCount+=a},putSamples:function(a,b,c){b=2*(b||0);0<=c||(c=(a.length-b)/2);var d=2*c;this.ensureCapacity(c+this._frameCount);var e=this.endIndex;this._vector.set(a.subarray(b,b+d),e);this._frameCount+=
c},putBuffer:function(a,b,c){b=b||0;0<=c||(c=a.frameCount-b);this.putSamples(a.vector,a.position+b,c)},receive:function(a){if(!(0<=a)||a>this._frameCount)a=this._frameCount;this._frameCount-=a;this._position+=a},receiveSamples:function(a,b){var c=this.startIndex;a.set(this._vector.subarray(c,c+2*b));this.receive(b)},extract:function(a,b,c){b=this.startIndex+2*b;a.set(this._vector.subarray(b,b+2*c))},ensureCapacity:function(a){a*=2;this._vector.length<a?(a=new Float32Array(a),a.set(this._vector.subarray(this.startIndex,
this.endIndex)),this._vector=a,this._position=0):this.rewind()},ensureAdditionalCapacity:function(a){this.ensureCapacity(this.frameCount+a)},rewind:function(){0<this._position&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}};function extend(a,b){for(var c in b){var d=b.__lookupGetter__(c),e=b.__lookupSetter__(c);d||e?(d&&a.__defineGetter__(c,d),e&&a.__defineSetter__(c,e)):a[c]=b[c]}return a}function testFloatEqual(a,b){return 1E-10<(a>b?a-b:b-a)}
function FilterSupport(a){this._pipe=a}
FilterSupport.prototype={get pipe(){return this._pipe},get inputBuffer(){return this._pipe.inputBuffer},get outputBuffer(){return this._pipe.outputBuffer},fillOutputBuffer:function(a){for(;this.outputBuffer.frameCount<a;){this.fillInputBuffer(16-this.inputBuffer.frameCount);if(16>this.inputBuffer.frameCount)break;this._pipe.process()}},clear:function(){this._pipe.clear();this.outputBufferPosition=0},get position(){return this._position},set position(a){if(a>this._position)throw new RangeError("New position may not be greater than current position");
var b=this.outputBufferPosition-(this._position-a);if(0>b)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=b;this._position=a},get sourcePosition(){return this._sourcePosition},set sourcePosition(a){this.clear();this._sourcePosition=a},fillInputBuffer:function(a){var b=new Float32Array(2*a);a=this.sourceSound.extract(b,a,this._sourcePosition);this._sourcePosition+=a;this.inputBuffer.putSamples(b,0,a)},extract:function(a,b){this.fillOutputBuffer(this.outputBufferPosition+
b);var c=Math.min(b,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(a,this.outputBufferPosition,c);var d=this.outputBufferPosition+c;this.outputBufferPosition=Math.min(this.historyBufferSize,d);this.outputBuffer.receive(Math.max(d-this.historyBufferSize,0));this._position+=c;return c},handleSampleData:function(a){this.extract(a.data,4096)}};
function SimpleFilter(a,b){FilterSupport.call(this,b);this.sourceSound=a;this.historyBufferSize=22050;this._position=this.outputBufferPosition=this._sourcePosition=0}extend(SimpleFilter.prototype,FilterSupport.prototype);function AbstractFifoSamplePipe(a){a?(this.inputBuffer=new FifoSampleBuffer,this.outputBuffer=new FifoSampleBuffer):this.inputBuffer=this.outputBuffer=null}
AbstractFifoSamplePipe.prototype={get inputBuffer(){return this._inputBuffer},set inputBuffer(a){this._inputBuffer=a},get outputBuffer(){return this._outputBuffer},set outputBuffer(a){this._outputBuffer=a},clear:function(){this._inputBuffer.clear();this._outputBuffer.clear()}};function RateTransposer(a){AbstractFifoSamplePipe.call(this,a);this._reset();this.rate=1}extend(RateTransposer.prototype,AbstractFifoSamplePipe.prototype);
extend(RateTransposer.prototype,{set rate(a){this._rate=a},_reset:function(){this.prevSampleR=this.prevSampleL=this.slopeCount=0},clone:function(){var a=new RateTransposer;a.rate=this._rate;return a},process:function(){var a=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(a/this._rate+1);a=this._transpose(a);this._inputBuffer.receive();this._outputBuffer.put(a)},_transpose:function(a){if(0==a)return 0;for(var b=this._inputBuffer.vector,c=this._inputBuffer.startIndex,d=this._outputBuffer.vector,
e=this._outputBuffer.endIndex,g=0,h=0;1>this.slopeCount;)d[e+2*h]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*b[c],d[e+2*h+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*b[c+1],h++,this.slopeCount+=this._rate;--this.slopeCount;if(1!=a)a:for(;;){for(;1<this.slopeCount;)if(--this.slopeCount,g++,g>=a-1)break a;var l=c+2*g;d[e+2*h]=(1-this.slopeCount)*b[l]+this.slopeCount*b[l+2];d[e+2*h+1]=(1-this.slopeCount)*b[l+1]+this.slopeCount*b[l+3];h++;this.slopeCount+=this._rate}this.prevSampleL=
b[c+2*a-2];this.prevSampleR=b[c+2*a-1];return h}});
var USE_AUTO_SEQUENCE_LEN=0,DEFAULT_SEQUENCE_MS=USE_AUTO_SEQUENCE_LEN,USE_AUTO_SEEKWINDOW_LEN=0,DEFAULT_SEEKWINDOW_MS=USE_AUTO_SEEKWINDOW_LEN,DEFAULT_OVERLAP_MS=8,_SCAN_OFFSETS=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],AUTOSEQ_TEMPO_LOW=.5,AUTOSEQ_TEMPO_TOP=2,
AUTOSEQ_AT_MIN=125,AUTOSEQ_AT_MAX=50,AUTOSEQ_K=(AUTOSEQ_AT_MAX-AUTOSEQ_AT_MIN)/(AUTOSEQ_TEMPO_TOP-AUTOSEQ_TEMPO_LOW),AUTOSEQ_C=AUTOSEQ_AT_MIN-AUTOSEQ_K*AUTOSEQ_TEMPO_LOW,AUTOSEEK_AT_MIN=25,AUTOSEEK_AT_MAX=15,AUTOSEEK_K=(AUTOSEEK_AT_MAX-AUTOSEEK_AT_MIN)/(AUTOSEQ_TEMPO_TOP-AUTOSEQ_TEMPO_LOW),AUTOSEEK_C=AUTOSEEK_AT_MIN-AUTOSEEK_K*AUTOSEQ_TEMPO_LOW;
function Stretch(a,b){AbstractFifoSamplePipe.call(this,a);this.bQuickSeek=!0;this.bMidBufferDirty=!1;this.pMidBuffer=null;this.overlapLength=0;this.bAutoSeekSetting=this.bAutoSeqSetting=!0;this._tempo=1;this.setParameters(b,DEFAULT_SEQUENCE_MS,DEFAULT_SEEKWINDOW_MS,DEFAULT_OVERLAP_MS)}extend(Stretch.prototype,AbstractFifoSamplePipe.prototype);
extend(Stretch.prototype,{clear:function(){AbstractFifoSamplePipe.prototype.clear.call(this);this._clearMidBuffer()},_clearMidBuffer:function(){this.bMidBufferDirty&&(this.bMidBufferDirty=!1,this.pMidBuffer=null)},setParameters:function(a,b,c,d){0<a&&(this.sampleRate=a);0<d&&(this.overlapMs=d);0<b?(this.sequenceMs=b,this.bAutoSeqSetting=!1):this.bAutoSeqSetting=!0;0<c?(this.seekWindowMs=c,this.bAutoSeekSetting=!1):this.bAutoSeekSetting=!0;this.calcSeqParameters();this.calculateOverlapLength(this.overlapMs);
this.tempo=this._tempo},set tempo(a){this._tempo=a;this.calcSeqParameters();this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength);this.skipFract=0;this.sampleReq=Math.max(Math.floor(this.nominalSkip+.5)+this.overlapLength,this.seekWindowLength)+this.seekLength},get inputChunkSize(){return this.sampleReq},get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)},calculateOverlapLength:function(a){a=this.sampleRate*a/1E3;16>a&&(a=16);this.overlapLength=
a-a%8;this.pRefMidBuffer=new Float32Array(2*this.overlapLength);this.pMidBuffer=new Float32Array(2*this.overlapLength)},checkLimits:function(a,b,c){return a<b?b:a>c?c:a},calcSeqParameters:function(){var a;this.bAutoSeqSetting&&(a=AUTOSEQ_C+AUTOSEQ_K*this._tempo,a=this.checkLimits(a,AUTOSEQ_AT_MAX,AUTOSEQ_AT_MIN),this.sequenceMs=Math.floor(a+.5));this.bAutoSeekSetting&&(a=AUTOSEEK_C+AUTOSEEK_K*this._tempo,a=this.checkLimits(a,AUTOSEEK_AT_MAX,AUTOSEEK_AT_MIN),this.seekWindowMs=Math.floor(a+.5));this.seekWindowLength=
Math.floor(this.sampleRate*this.sequenceMs/1E3);this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1E3)},set quickSeek(a){this.bQuickSeek=a},clone:function(){var a=new Stretch;a.tempo=this.tempo;a.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs);return a},seekBestOverlapPosition:function(){return this.bQuickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()},seekBestOverlapPositionStereo:function(){var a,b,c,d;this.precalcCorrReferenceStereo();
b=Number.MIN_VALUE;for(d=a=0;d<this.seekLength;d++)c=this.calcCrossCorrStereo(2*d,this.pRefMidBuffer),c>b&&(b=c,a=d);return a},seekBestOverlapPositionStereoQuick:function(){var a,b,c,d,e,g,h;this.precalcCorrReferenceStereo();c=Number.MIN_VALUE;for(e=g=b=0;4>e;e++){for(a=0;_SCAN_OFFSETS[e][a];){h=g+_SCAN_OFFSETS[e][a];if(h>=this.seekLength)break;d=this.calcCrossCorrStereo(2*h,this.pRefMidBuffer);d>c&&(c=d,b=h);a++}g=b}return b},precalcCorrReferenceStereo:function(){var a,b,c;for(a=0;a<this.overlapLength;a++)c=
a*(this.overlapLength-a),b=2*a,this.pRefMidBuffer[b]=this.pMidBuffer[b]*c,this.pRefMidBuffer[b+1]=this.pMidBuffer[b+1]*c},calcCrossCorrStereo:function(a,b){var c=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var d,e,g;d=0;for(e=2;e<2*this.overlapLength;e+=2)g=e+a,d+=c[g]*b[e]+c[g+1]*b[e+1];return d},overlap:function(a){this.overlapStereo(2*a)},overlapStereo:function(a){var b=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var c=this._outputBuffer.vector,d=this._outputBuffer.endIndex,
e,g,h,l,f,k,m;l=1/this.overlapLength;for(e=0;e<this.overlapLength;e++)h=(this.overlapLength-e)*l,f=e*l,g=2*e,k=g+a,m=g+d,c[m+0]=b[k+0]*f+this.pMidBuffer[g+0]*h,c[m+1]=b[k+1]*f+this.pMidBuffer[g+1]*h},process:function(){var a,b;if(null==this.pMidBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.pMidBuffer=new Float32Array(2*this.overlapLength);this._inputBuffer.receiveSamples(this.pMidBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;)a=this.seekBestOverlapPosition(),
this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(a)),this._outputBuffer.put(this.overlapLength),b=this.seekWindowLength-2*this.overlapLength,0<b&&this._outputBuffer.putBuffer(this._inputBuffer,a+this.overlapLength,b),a=this.inputBuffer.startIndex+2*(a+this.seekWindowLength-this.overlapLength),this.pMidBuffer.set(this._inputBuffer.vector.subarray(a,a+2*this.overlapLength)),this.skipFract+=this.nominalSkip,a=Math.floor(this.skipFract),this.skipFract-=a,this._inputBuffer.receive(a)}});
extend(Stretch.prototype,{get tempo(){return this._tempo}});
