var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){$jscomp.initSymbolIterator();c=null!=c?c:function(a){return a};var b=[],g=a[Symbol.iterator];if("function"==typeof g)for(a=g.call(a);!(g=a.next()).done;)b.push(c.call(d,g.value));else for(var g=a.length,k=0;k<g;k++)b.push(c.call(d,a[k]));return b}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function c(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(n){return!1}}())return a;var d="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var e=0,g=function(a){this.id_=(e+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};g.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=c;return this};g.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};g.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};g.prototype.delete=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return g},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),h=d.next();if(h.done||h.value[0]!=b||"s"!=h.value[1])return!1;h=d.next();return h.done||4!=h.value[0].x||"t"!=h.value[1]||!d.next().done?!1:!0}catch(m){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,c=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,b){var c=d(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};c.prototype.delete=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};c.prototype.has=function(a){return!!d(this,a).entry};c.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};c.prototype.entries=function(){return e(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return e(this,function(a){return a.key})};c.prototype.values=function(){return e(this,function(a){return a.value})};c.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(a,c){var d;d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++k,b.set(c,d)):d="p_"+c;var h=a.data_[d];if(h&&$jscomp.owns(a.data_,d))for(a=0;a<h.length;a++){var f=
h[a];if(c!==c&&f.key!==f.key||c===f.key)return{id:d,list:h,index:a,entry:f}}return{id:d,list:h,index:-1,entry:void 0}},e=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=a.next=a.head=a},k=0;return c},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es6","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),d=new a($jscomp.makeIterator([b]));if(!d.has(b)||1!=d.size||d.add(b)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var e=d.entries(),g=e.next();if(g.done||g.value[0]!=b||g.value[1]!=b)return!1;g=e.next();return g.done||g.value[0]==b||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:e.next().done}catch(k){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=function(){return this.map_.entries()};
b.prototype.values=function(){return this.map_.values()};b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return b},"es6-impl","es3");$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var c=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){c(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(l){this.reject_(l);return}"function"==
typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var e=new b;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(f){c.reject(f)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(u){e(u)}}:b}var f,e,h=new d(function(a,b){f=a;e=b});this.callWhenSettled_(c(a,f),
c(b,e));return h};d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?e.asyncExecute(c):this.onSettledCallbacks_.push(function(){e.asyncExecute(c)})};d.resolve=function(a){return a instanceof d?a:new d(function(b,c){b(a)})};d.reject=function(a){return new d(function(b,c){c(a)})};
d.race=function(a){return new d(function(b,c){for(var f=$jscomp.makeIterator(a),e=f.next();!e.done;e=f.next())d.resolve(e.value).callWhenSettled_(b,c)})};d.all=function(a){var b=$jscomp.makeIterator(a),c=b.next();return c.done?d.resolve([]):new d(function(a,e){function h(b){return function(c){f[b]=c;p--;0==p&&a(f)}}var f=[],p=0;do f.push(void 0),p++,d.resolve(c.value).callWhenSettled_(h(f.length-1),e),c=b.next();while(!c.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(d.$jscomp$new$AsyncExecutor=function(){return new b});
return d},"es6-impl","es3");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6-impl","es3");
$jscomp.polyfill("Number.isNaN",function(a){return a?a:function(a){return"number"===typeof a&&isNaN(a)}},"es6-impl","es3");
function DymoManager(a,b,c,d,e,g,k){function l(a,b,c,e){n=b;h=c[0];q=a.getMappings();for(var k in c[1])a=c[1][k],DYMO_STORE.isSubclassOf(a.getType(),UI_CONTROL)&&(m[k]=new UIControl(a,g)),DYMO_STORE.isSubclassOf(a.getType(),SENSOR_CONTROL)&&(p[k]=a);d||(d="bower_components/dymo-core/audio/impulse_rev.wav");f.init(d,b,e)}DYMO_STORE=new DymoStore(e);var f=new Scheduler(a,k);c&&(OPTIMIZED_MODE=!0);isNaN(b)||(SCHEDULE_AHEAD_TIME=b);var n,h,m={},p={},q={};this.loadDymoAndRenderingFromStore=function(a,
b,c){DYMO_STORE=a;a=new DymoLoader(DYMO_STORE);var d=a.createDymoFromStore(),h=a.createRenderingFromStore();b&&b();l(a,d,h,c)};this.loadDymoAndRendering=function(a,b,c,d){var h=new DymoLoader(DYMO_STORE);h.loadDymoFromJson(a,function(a){h.loadRenderingFromJson(b,function(b){l(h,a,b,d);c&&c()})})};this.loadDymoFromJson=function(a,b){(new DymoLoader(DYMO_STORE)).loadDymoFromJson(a,b)};this.parseDymoFromJson=function(a,b){(new DymoLoader(DYMO_STORE)).parseDymoFromJson(a,b)};this.replacePartOfTopDymo=
function(a,b){a=DYMO_STORE.replacePartAt(n[0],b,a);f.stop(a)};this.updateNavigatorPosition=function(a,b,c){f.updateNavigatorPosition(a,b,c)};this.getNavigatorPosition=function(a,b){return f.getNavigatorPosition(a,b)};this.syncNavigators=function(a,b,c){f.syncNavigators(a,b,c)};this.startPlayingUri=function(a){f.play(a)};this.stopPlayingUri=function(a){f.stop(a)};this.startPlaying=function(){for(var a=0;a<n.length;a++)DYMO_STORE.updatePartOrder(n[a],ONSET),f.play(n[a],h.getNavigator())};this.stopPlaying=
function(){for(var a=0;a<n.length;a++)f.stop(n[a])};this.getStore=function(){return DYMO_STORE};this.getTopDymo=function(){return n[0]};this.getRendering=function(){return h};this.getMappings=function(){return q};this.getUIControls=function(){return m};this.getUIControl=function(a){return m[a]};this.getSensorControls=function(){return p}};function DymoNode(a,b,c,d){this.POSITION_PARAMS=[PAN,HEIGHT,DISTANCE];this.dymoUri=a;this.parameters={};this.init(b,c,d)}
DymoNode.prototype.init=function(a,b,c){this.dryGain=a.createGain();this.addParameter(AMPLITUDE,this.dryGain.gain);b&&(this.reverbGain=this.createGain(a,this.dryGain,b),this.addParameter(REVERB,this.reverbGain.gain));c&&(this.delayGain=this.createGain(a,this.dryGain,c),this.addParameter(DELAY,this.delayGain.gain));if(DYMO_STORE.findParameterUri(this.dymoUri,PAN)||DYMO_STORE.findParameterUri(this.dymoUri,HEIGHT)||DYMO_STORE.findParameterUri(this.dymoUri,DISTANCE))this.panner=a.createPanner(),this.panner.connect(this.dryGain),
this.addParameter(PAN,{value:0}),this.addParameter(HEIGHT,{value:0}),this.addParameter(DISTANCE,{value:0});DYMO_STORE.findParameterUri(this.dymoUri,FILTER)&&(this.filter=a.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency.value=2E4,this.panner?this.filter.connect(this.panner):this.filter.connect(this.dryGain),this.addParameter(FILTER,this.filter.frequency))};DymoNode.prototype.createGain=function(a,b,c){a=a.createGain();a.connect(c);a.gain.value=0;b.connect(a);return a};
DymoNode.prototype.addParameter=function(a,b){DYMO_STORE.addParameterObserver(this.dymoUri,a,this);this.parameters[a]=b;b=DYMO_STORE.findParameterValue(this.dymoUri,a);null!=b&&this.setParameter(a,b)};
DymoNode.prototype.setParameter=function(a,b){isNaN(b)||(this.parameters[a]&&(this.parameters[a].value||0==this.parameters[a].value?this.parameters[a].value=b:this.parameters[a].setValue(b)),0<=this.POSITION_PARAMS.indexOf(a)&&this.parameters[PAN]&&this.parameters[HEIGHT]&&this.parameters[DISTANCE]&&(0==this.parameters[DISTANCE].value&&(this.parameters[DISTANCE].value=-.01),this.panner.setPosition(this.parameters[PAN].value,this.parameters[HEIGHT].value,this.parameters[DISTANCE].value)))};
DymoNode.prototype.getDymoUri=function(){return this.dymoUri};DymoNode.prototype.observedValueChanged=function(a,b,c){this.setParameter(b,c)};DymoNode.prototype.getParameterValue=function(a){if(this.parameters[a])return this.parameters[a].value||0==this.parameters[a].value?this.parameters[a].value:this.parameters[a].getValue()};DymoNode.prototype.getInput=function(){return this.filter?this.filter:this.panner?this.panner:this.dryGain};DymoNode.prototype.connect=function(a){this.dryGain.connect(a)};
DymoNode.prototype.removeAndDisconnect=function(){for(var a in this.parameters)DYMO_STORE.removeParameterObserver(this.dymoUri,a,this);this.dryGain.disconnect();this.reverbGain&&this.reverbGain.disconnect();this.delayGain&&this.delayGain.disconnect()};function AudioProcessor(a){function b(a){return{extract:function(b,c,g){for(var d=[],e=0;e<a.numberOfChannels;e++)d.push(a.getChannelData(e));for(e=0;e<c;e++)for(var f=0;f<d.length;f++)b[e*d.length+f%d.length]=d[f][e+g];return Math.min(c,d[0].length-g)}}}this.timeStretch=function(c,d){var e=new SoundTouch(c.sampleRate);e.tempo=d;var g=b(c),e=new SimpleFilter(g,e);d=a.createBuffer(c.numberOfChannels,1/d*c.length,c.sampleRate);for(var g=[],k=0;k<c.numberOfChannels;k++)g.push(d.getChannelData(k));c=
new Float32Array(2048);for(var l=e.extract(c,1024),f=0;l;){for(k=0;k<l;k++)for(var n=0;n<g.length;n++)g[n][k+f]=c[k*g.length+n%g.length];f+=l;l=e.extract(c,1024)}return d}};function AudioProcessorSource(a,b,c){var d=this,e=new SoundTouch(b.sampleRate);this.stretchRatio={setValue:function(a){e.tempo=a},getValue:function(){return e.tempo}};this.playbackRate={setValue:function(a){e.rate=a},getValue:function(){return e.rate}};var g=new SimpleFilter({extract:function(a,c,d){for(var h=[],f=0;f<b.numberOfChannels;f++)h.push(b.getChannelData(f));for(f=0;f<c;f++)for(var e=0;e<h.length;e++)a[f*h.length+e%h.length]=h[e][f+d];return Math.min(c,h[0].length-d)}},e),k=a.createScriptProcessor(1024,
2,b.numberOfChannels),l=new Float32Array(2048);k.onaudioprocess=function(a){for(var c=[],h=0;h<b.numberOfChannels;h++)c.push(a.outputBuffer.getChannelData(h));a=g.extract(l,1024);0==a&&d.stop();for(h=0;h<a;h++)for(var f=0;f<c.length;f++)c[f][h]=l[h*c.length+f%c.length]};this.start=function(a){setTimeout(function(){k.connect(c)},a)};this.stop=function(){k.disconnect()}};function Scheduler(a,b){function c(a,b){for(var c=[],d=0,h=a.length;d<h;d++)var f=DYMO_STORE.findAllObjectsInHierarchy(a[d]),c=c.concat(f.map(function(a){return DYMO_STORE.getSourcePath(a)}));d=0;for(h=c.length;d<h;d++)c[d]&&!l[c[d]]&&g(c[d],function(a,c){l[c]=a;0<m&&m--;0==m&&b&&b()});0==m&&b&&b()}function d(a){f.splice(f.indexOf(a),1)}function e(a){OPTIMIZED_MODE||(a=Array.from(a.getAllSources().keys()),a=flattenArray(a.map(function(a){return DYMO_STORE.findAllParents(a)})),a=removeDuplicates(a),
a.sort(),n=a,b&&b(n))}function g(b,c){m++;var d=new XMLHttpRequest;d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){a.decodeAudioData(d.response,function(a){c(a,b)})};d.error=function(){};d.send()}var k=this,l={},f=[],n=[],h,m=0;this.init=function(b,d,f){DYMO_STORE.addParameter(null,LISTENER_ORIENTATION,0,k);c(d,f);b&&0<DYMO_STORE.find(null,null,REVERB).length&&(h=a.createConvolver(),h.connect(a.destination),g(b,function(a){h.buffer=a;0<m&&m--;0==m&&f&&f()}));0<DYMO_STORE.find(null,
null,DELAY).length&&(b=a.createDelay(),b.delayTime.value=.5,b.connect(a.destination),d=a.createGain(),d.gain.value=.6,b.connect(d),d.connect(b));DYMO_STORE.addTypeObserver(PLAY,VALUE,k)};this.getBuffer=function(a){return l[DYMO_STORE.getSourcePath(a)]};this.updateNavigatorPosition=function(a,b,c){for(var d=0,h=f.length;d<h;d++)f[d].hasDymo(a)&&f[d].getNavigator().setPosition(c,b,a)};this.getNavigatorPosition=function(a,b){for(var c=0,d=f.length;c<d;c++)if(f[c].hasDymo(a))return f[c].getNavigator().getPosition(b,
a)};this.syncNavigators=function(a,b,c){for(var d,h,e=0,m=f.length;e<m;e++)f[e].hasDymo(a)&&(d=f[e].getNavigator()),f[e].hasDymo(b)&&(h=f[e].getNavigator());h&&(b=h.getPosition(c,b),d.setPosition(b,c,a))};this.play=function(b,c){b=new SchedulerThread(b,c,a,l,h,void 0,e,d);f.push(b)};this.pause=function(a){if(a)for(var b=0;b<f.length;b++)f[b].pause(a)};this.stop=function(a){if(a)for(var b=0;b<f.length;b++)f[b].stop(a)};this.getSources=function(a){for(var b=[],c=0;c<f.length;c++){var d=f[c].getSources(a);
if(d)for(var h=0;h<d.length;h++)b=b.concat(d)}return b};this.getUrisOfPlayingDymos=function(){return n};this.observedValueChanged=function(b,c,d){c==LISTENER_ORIENTATION?(d=d/180*Math.PI,a.listener.setOrientation(Math.sin(d),0,-Math.cos(d),0,1,0)):c==PLAY&&(b=DYMO_STORE.findSubject(HAS_PARAMETER,b),0<d?this.play(b):this.stop(b))}};function DymoSource(a,b,c,d,e,g){function k(b,d){var f=b[0],e=b[1],e=1!=d?e+.3:e+FADE_LENGTH;if(c||isNaN(f+e)){if(0!=f||e<c.duration)c=h(c,n(f,c),n(e,c));return l(c,e,d)}m(DYMO_STORE.getSourcePath(a),f,f+e,function(a){return l(a,e,d)})}function l(a,c,d){1!=d&&(a=(new AudioProcessor(b)).timeStretch(a,d),a=h(a,0,n(c/d+FADE_LENGTH,a)));c=a;d=a.length;for(var f=c.sampleRate*FADE_LENGTH,e=0;e<c.numberOfChannels;e++)for(var m=c.getChannelData(e),g=0;g<f;g++)m[g]*=g/f,m[d-g-1]*=g/f;return a}function f(){u=
!1;var a=b.currentTime;q.parameters[AMPLITUDE].setValueAtTime(q.parameters[AMPLITUDE].value,a);q.parameters[AMPLITUDE].linearRampToValueAtTime(0,a+FADE_LENGTH);r.stop(a+2*FADE_LENGTH)}function n(a,b){if(a||0==a)return Math.round(a*b.sampleRate)}function h(a,c,d){d=Math.min(a.length-c,d);for(var h=b.createBuffer(a.numberOfChannels,d,a.sampleRate),f=0;f<a.numberOfChannels;f++)for(var e=h.getChannelData(f),m=a.getChannelData(f),g=0;g<d;g++)e[g]=m[c+g];return h}function m(a,b,c,d){var h=a.lastIndexOf("/");
h&&(a=a.substring(h+1));p("http://localhost:8060/getAudioChunk?filename="+a+"&fromSecond="+b+"&toSecond="+c,function(a){d(a)})}function p(a,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){b.decodeAudioData(d.response,function(a){c(a)},function(a){console.log("audio from server is faulty")})};d.send()}DymoNode.call(this,a,b,d,e);var q=this,u,w,v,r=b.createBufferSource();r.connect(this.getInput());(function(){var b=[DYMO_STORE.findFeatureValue(a,TIME_FEATURE),
DYMO_STORE.findFeatureValue(a,DURATION_FEATURE)];b[0]||(b[0]=0);!b[1]&&c&&(b[1]=c.duration-b[0]);var d=DYMO_STORE.findParameterValue(a,DURATION_RATIO);d&&0<d&&1>d&&(b[1]*=d);v=b[1];d=DYMO_STORE.findParameterValue(a,TIME_STRETCH_RATIO);r.buffer=k(b,d?d:1)})();this.addParameter(PLAYBACK_RATE,r.playbackRate);this.addParameter(TIME_STRETCH_RATIO,{value:0});this.addParameter(LOOP,{value:0});this.getDuration=function(){return v};this.isLoopingAndPlaying=function(){return r.loop&&u};this.play=function(b){r.onended=
function(){r.disconnect();q.removeAndDisconnect();g&&g(q)};b||(b=0);r.start(b);DYMO_STORE.findParameterValue(a,LOOP)&&(r.loop=!0);u=!0};this.pause=function(){u?(f(),w=!0):w&&(w=!1,this.play())};this.stop=function(){u&&f()}}inheritPrototype(DymoSource,DymoNode);function SchedulerThread(a,b,c,d,e,g,k,l){function f(){var a=y;y=x?x:q();n(y);if(!z){var b=y.keys().next().value;z=DYMO_STORE.findParameterValue(b,ONSET)}for(var b=t?t-c.currentTime:SCHEDULE_AHEAD_TIME,d=c.currentTime+b,h=$jscomp.makeIterator(y.values()),e=h.next();!e.done;e=h.next())e=e.value,e.play(d);a=$jscomp.makeIterator(a.values());for(e=a.next();!e.done;e=a.next())e=e.value,DYMO_STORE.findParameterValue(e.getDymoUri(),LOOP)&&e.stop(d);setTimeout(function(){k(w)},b);(x=q())&&0<x.size?(t=p(d),
a=t[1],t=t[0],DYMO_STORE.findParameterValue(a.getDymoUri(),LOOP)&&(t-=FADE_LENGTH),a=1E3*(t-c.currentTime-SCHEDULE_AHEAD_TIME),A=setTimeout(function(){f()},a)):(t=p(d),a=1E3*(t-c.currentTime),setTimeout(function(){m()},a+100))}function n(a){for(var b=$jscomp.makeIterator(a.keys()),c=b.next();!c.done;c=b.next())c=c.value,v.get(c)||v.set(c,[]),v.get(c).push(a.get(c))}function h(a){var b=v.get(a.getDymoUri());b.splice(b.indexOf(a),1);0>=b.length&&v.delete(a.getDymoUri());k(w);m()}function m(){if(0==
v.size&&(!x||0==x.size)){window.clearTimeout(A);b.reset();for(var c=DYMO_STORE.findAllObjectsInHierarchy(a),d=0,h=c.length;d<h;d++){var f=r.get(c[d]);f&&f.removeAndDisconnect()}l&&l()}}function p(a){if(x){var b=x.keys().next().value,b=DYMO_STORE.findParameterValue(b,ONSET),c=b-z;z=b;if(!isNaN(b))return a+c}for(var b=0,d,c=$jscomp.makeIterator(y.values()),h=c.next();!h.done;h=c.next()){var h=h.value,f=h.getDuration();f>b&&(b=f,d=h)}return[a+b,d]}function q(){var a=b.getNextParts();if(a){u(a);for(var f=
new Map,m=0;m<a.length;m++){var p=DYMO_STORE.getSourcePath(a[m]);if(p){p=new DymoSource(a[m],c,d[p],e,g,h);a:{for(var n=p,k=DYMO_STORE.findParents(p.getDymoUri())[0];k;){if(r.has(k)){n.connect(r.get(k).getInput());break a}var q=new DymoNode(k,c,e,g);n.connect(q.getInput());r.set(k,q);k=DYMO_STORE.findParents(k)[0];n=q}n.connect(c.destination)}f.set(a[m],p)}}return f}}function u(a){console.log(a.map(function(a){a=DYMO_STORE.findPartIndex(a);return isNaN(a)?"top":a}))}var w=this,v=new Map,r=new Map,
x,A,y=new Map,t,z;b||(b=new DymoNavigator(a,new SequentialNavigator(a)));f();this.hasDymo=function(b){if(DYMO_STORE.findAllObjectsInHierarchy(a).indexOf(b))return!0};this.getNavigator=function(){return b};this.stop=function(a){a=DYMO_STORE.findAllObjectsInHierarchy(a);for(var b=0,c=a.length;b<c;b++){var d=v.get(a[b]);if(d)for(var h=0;h<d.length;h++)d[h].stop();x&&(x.delete(a[b]),0>=x.size&&(x=void 0))}};this.getAllSources=function(){return v};this.getSources=function(a){return v.get(a)}};var AutoControl=function(a,b,c){Control.call(this,a,b,AUTO_CONTROL);c||(c=100);DYMO_STORE.addParameter(a,AUTO_CONTROL_FREQUENCY,c,this);DYMO_STORE.addParameter(a,AUTO_CONTROL_TRIGGER,0,this);this.intervalID=null};$jscomp.inherits(AutoControl,Control);AutoControl.prototype.startUpdate=function(a){var b=this;a||(a=DYMO_STORE.findParameterValue(this.uri,AUTO_CONTROL_FREQUENCY));this.update();this.intervalID=setInterval(function(){return b.update()},a)};AutoControl.prototype.update=function(){};
AutoControl.prototype.reset=function(){clearInterval(this.intervalID);this.intervalID=null};AutoControl.prototype.observedValueChanged=function(a,b,c){b==AUTO_CONTROL_FREQUENCY?this.intervalID&&(this.reset(),this.startUpdate(c)):b==AUTO_CONTROL_TRIGGER&&(!this.intervalID&&0<c?this.startUpdate():this.intervalID&&0==c&&this.reset())};var DataControl=function(a,b,c,d){d||(d=6E4);AutoControl.call(this,a,DATA_CONTROL,d);this.url=b;this.jsonMap=c;DYMO_STORE.setParameter(a,AUTO_CONTROL_TRIGGER,1)};$jscomp.inherits(DataControl,AutoControl);DataControl.prototype.update=function(){var a=this;fetch(this.url).then(function(a){return a.json()}).then(function(b){return a.jsonMap(b)}).then(function(b){console.log("data received:",b);a.updateValue(b)}).catch(function(a){return console.log(a)})};function UIControl(a,b){var c=this;this.value=a.getValue();a.setUpdateFunction(function(d){a.getType()==TOGGLE?c.value=1==d?!0:!1:c.value=d;b&&setTimeout(function(){b.$apply()},10)});this.getName=function(){return a.getName()};this.getType=function(){return a.getType()};this.update=function(){a.getType()==BUTTON&&(isNaN(this.value)&&(this.value=0),this.value=1-this.value);1==this.value?a.updateValue(1):0==this.value?a.updateValue(0):a.updateValue(this.value)}};function Cosiatec(){}
Cosiatec.buildHierarchy=function(a,b){var c=Similarity.getAllParts([a],b),d=Cosiatec.getQuantizedPoints(c,b),e=Cosiatec.getSortedCloneWithoutDupes(d);console.log(d.length);console.log(JSON.stringify(d));var g=Cosiatec.getOverlappingCosiatecPatterns(e);console.log(JSON.stringify(g.map(function(a){return a.map(function(a){return a.length})})));for(var g=g.slice(0,1),e=[],k=0;k<g.length;k++)for(var l=g[k][1].map(function(a){return g[k][0].map(function(b){return Cosiatec.round(math.add(b,a))})}),f=d.map(function(a){return JSON.stringify(a)}),
n=l.map(function(a){return a.map(function(a){return c[f.indexOf(JSON.stringify(a))]})}),h=b.findAllObjects(n[0][0],HAS_FEATURE).map(function(a){return b.findObject(a,TYPE)}),m=0;m<l.length;m++){var p=b.addDymo(CONTEXT_URI+"pattern"+k+m,a);e.push(p);n[m].forEach(function(a){return b.addPart(p,a)});var q=n[m].map(function(a){return h.map(function(c){return b.findFeatureValue(a,c)})}),h=h.filter(function(a,b){return q[0][b].constructor!==Array}),q=q.map(function(a){return a.filter(function(a){return a.constructor!==
Array})}),q=math.mean(q,0);q.forEach(function(a,c){return b.setFeature(p,h[c],a)})}b.setParts(a,e);return g};Cosiatec.getQuantizedPoints=function(a,b){a=Similarity.toVectors(a,b);a=Cosiatec.summarizePoints(a);return a.map(function(a){return Cosiatec.round(a)})};Cosiatec.round=function(a){return a.map(function(a){return Math.round(10*a)/10})};
Cosiatec.normalizePoints=function(a){for(var b=0;b<a[0].length-2;b++){var c=a.reduce(function(a,c){return Math.max(a,c[b])},-Infinity),d=a.reduce(function(a,c){return Math.min(a,c[b])},Infinity);a.forEach(function(a){return a[b]=(a[b]-d)/(c-d)*10})}};Cosiatec.summarizePoints=function(a){return a.map(function(a,c){return[Cosiatec.indexOfMax(a.slice(0,a.length-2)),Math.round(a[a.length-2]),c]})};
Cosiatec.getSortedCloneWithoutDupes=function(a){a=removeDuplicates(math.clone(a));a.sort(Cosiatec.compareArrays);return a};
Cosiatec.getOverlappingCosiatecPatterns=function(a){var b=[],c=Cosiatec.getSiaPatterns(a),c=Object.keys(c).map(function(a){return c[a]}),d=Cosiatec.getSiatecOccurrences(a,c),e=Cosiatec.getFlompactness(c,a);for(console.log(a.length,c.length);0<a.length&&0<c.length;){var g=Cosiatec.indexOfMax(e),k=new Set(flattenArrayOnce(d[1][g]).map(function(a){return JSON.stringify(a)})),l=a.length;a=a.map(function(a){return JSON.stringify(a)}).filter(function(a){return!k.has(a)}).map(function(a){return JSON.parse(a)});
l>a.length&&(console.log(a.length,c.length),b.push([c[g],d[0][g]]));c.splice(g,1);d[0].splice(g,1);d[1].splice(g,1);e.splice(g,1)}return b};
Cosiatec.getCosiatecPatterns=function(a){for(var b=[];0<a.length;){var c=Cosiatec.getSiaPatterns(a),c=Object.keys(c).map(function(a){return c[a]});console.log(a.length,c.length);if(0<c.length){var d=Cosiatec.getSiatecOccurrences(a,c),e=Cosiatec.getFlompactness(c,a).reduce(function(a,b,c,d){return b>d[a]?c:a},0);b.push([c[e],d[0][e]]);var g=new Set(flattenArrayOnce(d[1][e]).map(function(a){return JSON.stringify(a)}));a=a.map(function(a){return JSON.stringify(a)}).filter(function(a){return!g.has(a)}).map(function(a){return JSON.parse(a)})}else break}return b};
Cosiatec.getSiaPatterns=function(a){a=Cosiatec.getVectorTable(a);a=Cosiatec.mergeSortedArrays(a);return Cosiatec.getPatterns(a)};
Cosiatec.getSiatecOccurrences=function(a,b){var c=new Map;a.forEach(function(a,b){return c.set(JSON.stringify(a),b)});var d=Cosiatec.getFullVectorTable(a);a=b.map(function(a){return a.map(function(a){return d[c.get(JSON.stringify(a))]})});a=a.map(function(a){return Cosiatec.getIntersection(a)});return[a,a.map(function(a,c){return a.map(function(a){return b[c].map(function(b){return math.add(b,a)})})})]};
Cosiatec.getCoverage=function(a,b){return a.map(function(a){return(new Set(flattenArrayOnce(a).map(function(a){return JSON.stringify(a)}))).size/b})};Cosiatec.getFlompactness=function(a,b){return a.map(function(a){return a.length/(1+Cosiatec.getPointsInBoundingBox(a,b).length-a.length)})};Cosiatec.getCompactness=function(a,b){return a.map(function(a){return a.length/Cosiatec.getPointsInBoundingBox(a,b).length})};
Cosiatec.getPointsInBoundingBox=function(a,b){var c=math.max(a,0),d=math.min(a,0);return b.filter(function(a){return a.every(function(a,b){return d[b]<=a&&a<=c[b]})})};Cosiatec.getIntersection=function(a){return 1<a.length?a.slice(1).reduce(function(a,c){return Cosiatec.intersectSortedArrays(a,c)},a[0]):a[0]};
Cosiatec.uniteSortedArrays=function(a,b){for(var c=[],d=0,e=0,g=a.length,k=b.length;d<g&&e<k;){var l=Cosiatec.compareArrays(a[d],b[e]);0>=l&&c.push(a[d++]);0<=l&&c.push(b[e++])}for(;d<g;)c.push(a[d++]);for(;e<k;)c.push(b[e++]);return c};
Cosiatec.mergeSortedArrays=function(a){var b=[],c=new BinaryHeap(function(a,b){return Cosiatec.compareArrays(a[0],b[0])});for(a.forEach(function(a,b){return 0<a.length?c.push([a[0],b,0]):null});0<c.size();){var d=c.pop();b.push(d[0]);var e=a[d[1]],g=d[2]+1;g<e.length&&c.push([e[g],d[1],g])}return b};Cosiatec.intersectSortedArrays=function(a,b){for(var c=[],d=0,e=0,g=a.length,k=b.length;d<g&&e<k;){var l=Cosiatec.compareArrays(a[d],b[e]);0==l&&c.push(a[d]);0>=l&&d++;0<=l&&e++}return c};
Cosiatec.compareArrays=function(a,b){for(var c=0,d=Math.min(a.length,b.length);c<d;){if(a[c]<b[c])return-1;if(a[c]>b[c])return 1;c++}return 0};Cosiatec.indexOfMax=function(a){return a.reduce(function(a,c,d,e){return c>e[a]?d:a},0)};Cosiatec.getVectorTable=function(a){return a.map(function(b,c){return a.filter(function(a,b){return b>c}).map(function(a){return[math.subtract(a,b),b]})})};
Cosiatec.getFullVectorTable=function(a){return a.map(function(b,c){return a.map(function(a){return math.subtract(a,b)})})};Cosiatec.getPatterns=function(a){return a.reduce(function(a,c){var b=JSON.stringify(c[0]);a[b]=a[b]||[];a[b].push(c[1]);return a},{})};function DymoGenerator(a,b){function c(){var a=CONTEXT_URI+"dymo"+r;r++;return a}function d(a){var b=[];if(a&&0<a.length){for(var c=0;c<a.length;c++)a[c].value&&a[c].value.constructor!==Array&&(a[c].value=[a[c].value]);for(var c=a[0].value.length,d=0;d<c;d++)if("string"==typeof a[0].value[d])b[d]=a[0].value[d];else if(w==SUMMARY.FIRST)b[d]=a[0].value[d];else if(w==SUMMARY.MEAN)b[d]=a.reduce(function(a,b){return a+b.value[d]},0)/a.length;else if(w==SUMMARY.MEDIAN){a.sort(function(a,b){return a.value[d]-
b.value[d]});var h=Math.floor(a.length/2);b[d]=a[h].value[d];0==a.length%2&&(b[d]+=a[h-1].value[d])}return 1==b.length?b[0]:b}return 0}function e(){0==r?m=this.addDymo(null,v):q&&(m=this.addDymo(h,v),q=!1)}function g(b,c,d){d||(d=m);var h=d;for(d=a.findLevel(d);d<c;){var f=a.findParts(h);if(0<f.length){f=f.map(function(b){return[a.findFeatureValue(b,TIME_FEATURE),b]});f.sort(function(a,b){return a[0]-b[0]});for(var e=0;e<f.length;e++)if(f[e][0]<=b)h=f[e][1];else if(0==e)h=f[e][1];else break;d++}else break}return h}
function k(a,b){void 0==a.max?(a.min=b,a.max=b):(a.min=Math.min(b,a.min),a.max=Math.max(b,a.max))}function l(a,b){for(var c=0;c<u.length;c++)if(u[c].name==a||u[c].uri==b)return u[c];return f(a,b)}function f(c,d,h,f){!c&&d&&(c=URI_TO_TERM[d]);c&&!d&&(d=CONTEXT_URI+c);c=void 0!=h&&void 0!=f?{name:c,uri:d,min:h,max:f}:{name:c,uri:d,min:1E3,max:0};2>u.length?u.push(c):u.splice(u.length-2,0,c);a.findObject(d,TYPE)||a.addTriple(d,TYPE,FEATURE_TYPE);b(c);return c}var n=this,h,m,p,q,u,w=SUMMARY.MEAN,v,r=
0,x=0;this.resetDymo=function(){m=h=void 0;q=!1;u=[];f("level",LEVEL_FEATURE,0,2);f("random",null,0,1)};this.setStore=function(b){a=b};this.getStore=function(){return a};this.addRendering=function(){var b=CONTEXT_URI+"rendering"+x;x++;p=b;a.addRendering(p,m)};this.addMapping=function(b,c,d,h){a.addMapping(b,c,d,h)};this.addNavigator=function(b,c,d){a.addNavigator(p,b,c,d)};this.getCurrentTopDymo=function(){return m};this.getFeatures=function(){return u};this.setSummarizingMode=function(a){w=a};this.setCurrentSourcePath=
function(a){v=a};this.setAudioFileChanged=function(){q=!0;if(m){var b=c();a.addDymo(b,null,m);m=b}};this.addDymo=function(b,d,h,f){f||(f=c());a.addDymo(f,b,null,d,h);b||(m=f);return f};this.addFeature=function(b,c,h){h||(h=m);Benchmarker.startTask("addFeature");e();b=l(b);h=a.findAllObjectsInHierarchy(h);for(var f=0;f<h.length;f++){var g=a.findFeatureValue(h[f],TIME_FEATURE),p=a.findFeatureValue(h[f],DURATION_FEATURE),n=c;isNaN(g)||(n=n.filter(function(a){return g<=a.time&&(isNaN(p)||a.time<g+p)}));
if(1>n.length)var k=c.filter(function(a){return a.time.value<=g}),n=0<k.length?[k[n.length-1]]:[c[0]];Benchmarker.startTask("summarize");n=d(n);this.setDymoFeature(h[f],b.uri,n)}};this.addSegmentation=function(b,c){e();for(var d=a.findMaxLevel(),h=0;h<b.length;h++){var f=g(b[h].time,d,c),m=b[h].time,p;if(b[h].duration)p=b[h].duration;else if(b[h+1])p=b[h+1].time-m;else{var k=a.findFeatureValue(f,TIME_FEATURE),q=a.findFeatureValue(f,DURATION_FEATURE);k&&q&&(p=k+q-m)}if(0<p){k=this.addDymo(f);this.setDymoFeature(k,
TIME_FEATURE,m);this.setDymoFeature(k,DURATION_FEATURE,p);var l=k,m=a.findFeatureValue(f,TIME_FEATURE),k=a.findFeatureValue(l,TIME_FEATURE);if(isNaN(m)||Array.isArray(m)||k<m)n.setDymoFeature(f,TIME_FEATURE,k),m=k;q=a.findFeatureValue(f,DURATION_FEATURE);l=a.findFeatureValue(l,DURATION_FEATURE);(isNaN(q)||Array.isArray(q)||m+q<k+l)&&n.setDymoFeature(f,DURATION_FEATURE,k+l-m)}}};this.setDymoFeature=function(b,c,d){a.setFeature(b,c,d);if(!isNaN(d))k(l(null,c),d);else if(d instanceof Array)for(b=0;b<
d.length;b++)k(l(null,c),d[b])};this.resetDymo()};function DymoTemplates(){}DymoTemplates.createSingleSourceDymoFromFeatures=function(a,b,c,d,e){b=a.addDymo(void 0,b);DymoTemplates.loadMultipleFeatures(a,b,c,d,e)};DymoTemplates.createMultiSourceDymo=function(a,b,c,d,e,g){var k=a.addDymo(b,null,c);b=d.map(function(b,c){return new Promise(function(d){var h=a.addDymo(k,b);DymoTemplates.loadMultipleFeatures(a,h,e[c],null,d)})});Promise.all(b).then(function(a){return g(k)})};
DymoTemplates.createSimilarityDymoFromFeatures=function(a,b,c,d,e,g){b=a.addDymo(void 0,b);DymoTemplates.loadMultipleFeatures(a,b,c,d,function(){Similarity.addSimilaritiesTo(a.getCurrentTopDymo(),a.getStore(),e);a.addRendering();a.addNavigator(SIMILARITY_NAVIGATOR,{d:LEVEL_FEATURE},"return d == 0");g()})};
DymoTemplates.createStructuredDymoFromFeatures=function(a,b,c,d,e,g){b=a.addDymo(void 0,b);DymoTemplates.loadMultipleFeatures(a,b,c,d,function(){Cosiatec.buildHierarchy(a.getCurrentTopDymo(),a.getStore());a.addRendering();g()})};
DymoTemplates.createSimilaritySuccessorDymoFromFeatures=function(a,b,c,d,e,g){b=a.addDymo(void 0,b);DymoTemplates.loadMultipleFeatures(a,b,c,d,function(){Similarity.addSimilaritiesTo(a.getCurrentTopDymo(),a.getStore(),e);Similarity.addSuccessionGraphTo(a.getCurrentTopDymo(),a.getStore(),e);a.addRendering();a.addNavigator(GRAPH_NAVIGATOR,{d:LEVEL_FEATURE},"return d == 0");g()})};
DymoTemplates.createAnnotatedBarAndBeatDymo=function(a,b,c){for(var d=[b[0],b[0]],e=["1",""],g=1;g<b.length;g++)d[g+1]=b[g],e[g+1]="";DymoTemplates.loadMultipleFeatures(a,null,d,e,c)};function getUris(a,b,c,d){for(var e=[],g=[],k=0,l=c.length;k<l;k++){var f=b.filter(function(a){return 0<a.indexOf(c[k])})[0];f&&(e.push(a+f),g.push(d[k]))}return[e,g]}
DymoTemplates.loadMultipleFeatures=function(a,b,c,d,e){Benchmarker.startTask("loadFeatures");var g=new FeatureLoader(a,b);a=c.map(function(a,b){return new Promise(function(c){return g.loadFeature(a,d?d[b]:null,c)})});Promise.all(a).then(function(a){return e()})};
DymoTemplates.createSebastianDymo=function(a,b,c){var d=a.getFeature("onset"),e=a.getFeature("pitch"),g=a.addDymo();a.setDymoFeature(g,d,0);a.setDymoFeature(g,e,0);c.get("getsourcefilesindir/",{params:{directory:"audio/Chopin_Op028-04_003_20100611-SMD/"}}).success(function(b){b=b.filter(function(a){return 4<a.split("_").length-1});for(var c=0;c<b.length;c++){var f=b[c].split("_"),n=f[f.length-1],n=Number.parseInt(n.substring(1,n.indexOf(".")),10)/1E3,f=Number.parseInt(f[f.length-3].substring(1),10),
h=a.addDymo(g,"audio/Chopin_Op028-04_003_20100611-SMD/"+b[c]);a.setDymoFeature(h,d,n);a.setDymoFeature(h,e,f)}DYMO_STORE.updatePartOrder(g,d.name)})};
DymoTemplates.createSebastianDymo2=function(a,b){var c=a.getFeature("onset"),d=a.getFeature("pitch"),e=a.addDymo();a.setDymoFeature(e,c,0);a.setDymoFeature(e,d,0);$http.get("getsourcefilesindir/",{params:{directory:"audio/scale_out/scale_single/"}}).success(function(b){b=b.filter(function(a){return 4<a.split("_").length-1});for(var g=0;g<b.length;g++){var l=b[g].split("_"),f=Number.parseInt(l[4].substring(1),10)/1E3,l=Number.parseInt(l[2].substring(1),10),n=a.addDymo(e,"audio/scale_out/scale_single/"+
b[g]);a.setDymoFeature(n,c,f);a.setDymoFeature(n,d,l)}DYMO_STORE.updatePartOrder(e,c.name)})};
DymoTemplates.createSebastianDymo3=function(a,b){var c=a.addDymo();a.setDymoFeature(c,ONSET_FEATURE,0);a.setDymoFeature(c,PITCH_FEATURE,0);a.setDymoFeature(c,DURATION_FEATURE,0);a.setDymoFeature(c,"velocity",0);a.setDymoFeature(c,"onsetS",0);a.setDymoFeature(c,"durationS",0);b.get("getsourcefilesindir/",{params:{directory:"audio/Chopin_Op028-11_003_20100611-SMD-cut/"}}).success(function(b){b=b.filter(function(a){return 4<a.split("_").length-1});for(var d=0;d<b.length;d++){var g=b[d].split("_"),k=
Number.parseInt(g[4].substring(1),10),l=Number.parseInt(g[6].substring(2),10)/1E3,f=Number.parseInt(g[7].substring(2),10)/1E3,n=Number.parseInt(g[8].substring(2),10),h=Number.parseInt(g[9].substring(2),10)/1E3,g=Number.parseInt(g[10].substring(2),10)/1E3,m=a.addDymo(c,"audio/Chopin_Op028-11_003_20100611-SMD-cut/"+b[d]);a.setDymoFeature(m,PITCH_FEATURE,k);a.setDymoFeature(m,ONSET_FEATURE,l);a.setDymoFeature(m,DURATION_FEATURE,f);a.setDymoFeature(m,"velocity",n);a.setDymoFeature(m,"onsetS",h);a.setDymoFeature(m,
"durationS",g);m.getParameter(ONSET).update(l)}DYMO_STORE.updatePartOrder(c,ONSET_FEATURE)})};
DymoTemplates.createAchBachDymo=function(a,b){var c=a.getFeature(ONSET_FEATURE),d=a.getFeature(PITCH_FEATURE),e=a.getFeature(DURATION_FEATURE),g=a.getFeature("onsetS"),k=a.getFeature("durationS"),l=a.getFeature("time"),f=a.addDymo();a.setDymoFeature(f,c,0);a.setDymoFeature(f,d,0);a.setDymoFeature(f,e,0);$http.get("audio/achachbach10/01-AchGottundHerr.txt").success(function(b){b=b.split("\n");for(var h=0;h<b.length;h++)b[h]=b[h].split("\t");b.sort(function(a,b){return a[0]-b[0]});for(var m=[],h=0;h<
b.length;h++){var p=b[h][0],n=b[h][1],u=Number.parseInt(b[h][3],10);if(m[u]){var w=m[u][0],v=n-m[u][2];b[w][4]=p-m[u][1];b[w][5]=v}m[u]=[h,p,n]}for(h=b.length-4;h<b.length;h++)b[h][4]=2700,b[h][5]=2700;for(h=0;h<b.length;h++)if(6==b[h].length){var m=b[h],p=Number.parseInt(m[2],10),n=Number.parseInt(m[0],10)/1E3,u=Number.parseInt(m[1],10)/1E3,w=Number.parseInt(m[4],10)/1E3,v=Number.parseInt(m[5],10)/1E3,r;1==m[3]?r=a.addDymo(f,"audio/achachbach10/01-AchGottundHerr-violin.wav"):2==m[3]?r=a.addDymo(f,
"audio/achachbach10/01-AchGottundHerr-clarinet.wav"):3==m[3]?r=a.addDymo(f,"audio/achachbach10/01-AchGottundHerr-saxphone.wav"):4==m[3]&&(r=a.addDymo(f,"audio/achachbach10/01-AchGottundHerr-bassoon.wav"));a.setDymoFeature(r,d,p);a.setDymoFeature(r,l,n);a.setDymoFeature(r,c,n);a.setDymoFeature(r,e,w);a.setDymoFeature(r,g,u);a.setDymoFeature(r,k,v);r.getParameter(ONSET).update(n)}DYMO_STORE.updatePartOrder(f,c.name)});$http.get("getsourcefilesindir/",{params:{directory:"audio/achachbach10/"}}).success(function(a){a=
a.filter(function(a){return 0<=a.indexOf("wav")});for(var b=0;b<a.length;b++);})};function createRandomTriangle(){return[{0:Math.random(),1:Math.random()},{0:Math.random(),1:Math.random()},{0:Math.random(),1:Math.random()}]};function FeatureLoader(a,b){function c(c,h,f){v(c,function(m){d(m,function(d){e(d,function(e){0<e.length?(n(c,h,e),f&&f()):g(d,function(d){var h=d.name;h||(h=c.split("_"),h=h[h.length-1].split(".")[0]);a.addFeature(h,d.values,b);f&&f()})})})})}function d(a,b){var c=N3.Store();N3.Parser().parse(a,function(a,d,h){d?c.addTriple(d):b(c)})}function e(a,b){for(var c=[],d=a.find(null,"http://purl.org/NET/c4dm/event.owl#time",null),h=0,e=d.length;h<e;h++){var m=k(a,d[h].object,"http://purl.org/NET/c4dm/timeline.owl#at");
m||(m=k(a,d[h].object,"http://purl.org/NET/c4dm/timeline.owl#beginsAt"));var g=k(a,d[h].object,"http://purl.org/NET/c4dm/timeline.owl#duration"),m={time:f(m),label:l(k(a,d[h].subject,"http://www.w3.org/2000/01/rdf-schema#label"))};g&&(m.duration=f(g));c.push(m)}b(c)}function g(a,b){var c=l(k(a,null,"http://purl.org/dc/elements/1.1/title")),d=l(k(a,null,"http://purl.org/ontology/af/value")),d=d.split(" ").map(function(a){return parseFloat(a)}),h=l(k(a,null,"http://purl.org/ontology/af/dimensions")),
h=h.split(" ").map(function(a){return Number.parseInt(a,10)}),e=k(a,null,"http://purl.org/ontology/vamp/computed_by"),m=f(k(a,e,"http://purl.org/ontology/vamp/step_size"));a=f(k(a,e,"http://purl.org/ontology/vamp/sample_rate"));for(var e=[],g=0;g<d.length;){for(var p=[],n=0;n<h[0];n++)p[n]=d[g+n];e.push({time:{value:g*m/a},value:p});g+=h[0]}b({name:c,values:e})}function k(a,b,c){a=a.find(b,c,null);if(0<a.length)return a[0].object}function l(a){if(a)return N3.Util.getLiteralValue(a)}function f(a){a=
N3.Util.getLiteralValue(a);"P"==a.charAt(0)&&(a=a.substring(2,a.length-1));return Number(a)}function n(c,d,h){r[c]=h.sort(function(a,b){return a.time.value-b.time.value});h=r[c];d&&r[c][0].label&&(h=h.filter(function(a){return a.label.value==d}));a.addSegmentation(h,b)}function h(a,b,c){v(a,function(a){m(JSON.parse(a),b,c)})}function m(a,b,c){"file_metadata"==Object.keys(a)[0]?p(a,b,c):q(a,b,c)}function p(c,d,h){c=c[Object.keys(c)[1]][0];var f=c.annotation_metadata.annotator.output_id;"beats"==f||
"onsets"==f||"segmentation"==f?(c=c.data,d&&c[0].value&&(c=c.filter(function(a){return a.value==d})),a.addSegmentation(c,b)):a.addFeature(f,c.data,b);h&&h()}function q(c,d,h){var f=c["@type"];"afv:BarandBeatTracker"==f||"afv:Onsets"==f?(c=c["afo:values"],d&&c[0]["afo:value"]&&(c=c.filter(function(a){return a["afo:value"]==d})),c=u(c),a.addSegmentation(c,b)):(c=w(c["afo:values"]),a.addFeature(f,c,b));h&&h()}function u(a){for(var b=[],c=0;c<a.length;c++)b.push({time:{value:a[c]["tl:at"]},label:{value:a[c]["afo:value"]}});
return b}function w(a){for(var b=[],c=0;c<a.length;c++)b.push({time:{value:a[c]["tl:at"]},value:[a[c]["afo:value"]]});return b}function v(a,b){var c=new XMLHttpRequest;c.addEventListener("load",function(){b(this.responseText)});c.addEventListener("error",function(){b(this.responseText)});c.open("GET",a);c.send()}var r={};this.loadFeature=function(a,b,d){if(a.constructor==Object)m(a,b,d);else{var f=a.split("."),f=f[f.length-1];"n3"==f?c(a,b,d):"json"==f&&h(a,b,d)}}};var SUMMARY={MEAN:"mean",MEDIAN:"median",FIRST:"first"};function BinaryHeap(a){this.content=[];this.compareFunction=a}
BinaryHeap.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.sinkDown(0));return a},remove:function(a){for(var b=this.content.length,c=0;c<b;c++)if(this.content[c]==a){a=this.content.pop();if(c==b-1)break;this.content[c]=a;this.bubbleUp(c);this.sinkDown(c);break}},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a];0<a;){var c=
Math.floor((a+1)/2)-1,d=this.content[c];if(0<=this.compareFunction(b,d))break;this.content[c]=b;this.content[a]=d;a=c}},sinkDown:function(a){for(var b=this.content.length,c=this.content[a];;){var d=2*(a+1),e=d-1,g=null;if(e<b){var k=this.content[e];0>this.compareFunction(k,c)&&(g=e)}d<b&&0>this.compareFunction(this.content[d],null==g?c:k)&&(g=d);if(null==g)break;this.content[a]=this.content[g];this.content[g]=c;a=g}}};function Similarity(){}Similarity.addSimilaritiesTo=function(a,b,c){for(a=[a];0<a.length;){if(1<a.length){var d=Similarity.toNormVectors(a,b),d=Similarity.getCosineSimilarities(d);Similarity.addSimilaritiesAbove(b,d,c)}a=Similarity.getAllParts(a,b)}};
Similarity.addSuccessionGraphTo=function(a,b,c){for(a=[a];0<a.length;){if(1<a.length){for(var d=0;d<a.length-1;d++)b.addSuccessor(a[d],a[d+1]);var d=Similarity.toNormVectors(a,b),d=Similarity.getCosineSimilarities(d),e;for(e in d)for(var g in d[e])d[e][g]>c&&(addSuccessorToPredecessorOf(e,g,a,b),addSuccessorToPredecessorOf(g,e,a,b))}a=Similarity.getAllParts(a,b)}};function addSuccessorToPredecessorOf(a,b,c,d){a=c.indexOf(a);0<a&&d.addSuccessor(c[a-1],b)}
Similarity.addSimilaritiesAbove=function(a,b,c){for(var d in b)for(var e in b[d])b[d][e]>c&&(a.addSimilar(d,e),a.addSimilar(e,d))};Similarity.addHighestSimilarities=function(a,b,c){var d=[],e;for(e in b)for(var g in b[e])d.push([b[e][g],e,g]);d=d.sort(function(a,b){return b[0]-a[0]});b=0;for(c=Math.min(d.length,c);b<c;b++)e=d[b],a.addSimilar(e[1],e[2]),a.addSimilar(e[2],e[1])};Similarity.getAllParts=function(a,b){for(var c=[],d=0,e=a.length;d<e;d++)c=c.concat(b.findParts(a[d]));return c};
Similarity.toNormVectors=function(a,b,c){b=Similarity.toVectors(a,b,c);var d=[],e=[];for(c=0;c<b[0].length;c++){for(var g=[],k=0;k<a.length;k++)isNaN(b[k][c])||g.push(b[k][c]);d[c]=math.mean(g);e[c]=math.var(g)}b=b.map(function(a){return a.map(function(a,b){return(a-d[b])/e[b]})});g={};for(c=0;c<b.length;c++)g[a[c]]=b[c];return g};
Similarity.toVectors=function(a,b,c){for(var d=[],e=0,g=a.length;e<g;e++){for(var k=[],l=b.findAllFeatureValues(a[e]).filter(function(a){return"string"!=typeof a}),f=0,n=l.length;f<n;f++){var h=l[f];c&&1<h.length&&(h=Similarity.reduce(h));1<h.length?k=k.concat(h):(h=Number(h),k.push(h))}d[e]=k}return d};Similarity.reduce=function(a){var b=Array.apply(null,Array(a.length)).map(Number.prototype.valueOf,1);return Similarity.getCosineSimilarity(a,b)};
Similarity.getCosineSimilarities=function(a){var b={},c;for(c in a)for(var d in a)c<d&&(b[c]||(b[c]={}),b[c][d]=Similarity.getCosineSimilarity(a[c],a[d]));return b};Similarity.getCosineSimilarity=function(a,b){return a.length==b.length?math.dot(a,b)/(math.norm(a)*math.norm(b)):0};var DYMO_CONTEXT={"@context":{"@base":"http://tiny.cc/dymo-context/",xsd:"http://www.w3.org/2001/XMLSchema#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",sch:"http://schema.org/",mo:"http://purl.org/ontology/mo/",mt:"http://purl.org/ontology/studio/multitrack#",ch:"http://tiny.cc/charm-ontology#",dy:"http://tiny.cc/dymo-ontology#",mb:"http://tiny.cc/mobile-audio-ontology#",name:"sch:name",cdt:{"@id":"ch:cdt","@type":"@vocab"},adt:{"@id":"ch:adt","@type":"@vocab"},
value:"ch:value",parts:"ch:hasPart",Dymo:"dy:Dymo",DymoType:"dy:DymoType",Conjunction:"dy:Conjunction",Disjunction:"dy:Disjunction",Sequence:"dy:Sequence",Feature:"dy:Feature",Parameter:"dy:Parameter",FeatureType:"dy:FeatureType",ParameterType:"dy:ParameterType",level:"dy:LevelFeature",index:"dy:IndexFeature",onset:"dy:OnsetFeature",pitch:"dy:PitchFeature",duration:"dy:DurationFeature",time:"dy:TimeFeature",segmentLabel:"dy:SegmentLabelFeature",CustomFeature:"dy:CustomFeature",AudioParameter:"dy:AudioParameter",
hasStandardValue:"dy:hasStandardValue",isInteger:"dy:isInteger",Play:"dy:Play",Loop:"dy:Loop",Onset:"dy:Onset",DurationRatio:"dy:DurationRatio",Amplitude:"dy:Amplitude",PlaybackRate:"dy:PlaybackRate",TimeStretchRatio:"dy:TimeStretchRatio",Pan:"dy:Pan",Distance:"dy:Distance",Height:"dy:Height",Reverb:"dy:Reverb",Delay:"dy:Delay",Filter:"dy:Filter",StructuralParameter:"dy:StructuralParameter",PartCount:"dy:PartCount",PartDurationRatio:"dy:PartDurationRatio",PartProportion:"dy:PartProportion",CustomParameter:"dy:CustomParameter",
source:{"@id":"dy:hasSource","@type":"xsd:string"},parameters:{"@id":"dy:hasParameter","@type":"@vocab"},features:{"@id":"dy:hasFeature","@type":"@vocab"},paramType:{"@id":"dy:hasParameterType","@type":"@vocab"},featureType:{"@id":"dy:hasFeatureType","@type":"@vocab"},similars:"dy:hasSimilar",successors:"dy:hasSuccessor",Rendering:"mb:Rendering",Mapping:"mb:Mapping",Function:"mb:Function",Argument:"mb:Argument",MobileControl:"mb:MobileControl",SensorControl:"mb:SensorControl",UiControl:"mb:UiControl",
DataControl:"mb:DataControl",AutoControl:"mb:AutoControl",AccelerometerX:"mb:AccelerometerX",AccelerometerY:"mb:AccelerometerY",AccelerometerZ:"mb:AccelerometerZ",TiltX:"mb:TiltX",TiltY:"mb:TiltY",TiltZ:"mb:TiltZ",GeolocationLatitude:"mb:GeolocationLatitude",GeolocationLongitude:"mb:GeolocationLongitude",GeolocationDistance:"mb:GeolocationDistance",CompassHeading:"mb:CompassHeading",Beacon:"mb:Beacon",Slider:"mb:Slider",Toggle:"mb:Toggle",Button:"mb:Button",CustomControl:"mb:CustomControl",Random:"mb:Random",
Brownian:"mb:Brownian",Ramp:"mb:Ramp",MobileParameter:"mb:MobileParameter",GlobalParameter:"mb:GlobalParameter",ControlParameter:"mb:ControlParameter",ListenerOrientation:"mb:ListenerOrientation",AutoControlFrequency:"mb:AutoControlFrequency",AutoControlTrigger:"mb:AutoControlTrigger",BrownianMaxStepSize:"mb:BrownianMaxStepSize",LeapingProbability:"mb:LeapingProbability",ContinueAfterLeaping:"mb:ContinueAfterLeaping",Navigator:"mb:Navigator",OneShotNavigator:"mb:OneShotNavigator",SequentialNavigator:"mb:SequentialNavigator",
SimilarityNavigator:"mb:SimilarityNavigator",GraphNavigator:"mb:GraphNavigator",ArgumentValue:"mb:ArgumentValue",MappingTarget:"mb:MappingTarget",MappingRange:"mb:MappingRange",MappingOwners:"mb:MappingOwners",dymo:{"@id":"mb:hasDymo","@type":"@id"},mappings:"mb:hasMapping","function":"mb:hasFunction",args:"mb:hasArgument","var":"mb:hasVariable",val:{"@id":"mb:hasValue","@type":"@vocab"},body:"mb:hasBody",targets:{"@id":"mb:toTarget","@type":"@id"},range:{"@id":"mb:hasRange","@type":"@vocab"},unidirectional:{"@id":"mb:isUnidirectional",
"@type":"xsd:boolean"},init:{"@id":"mb:hasInitialValue","@type":"xsd:float"},url:{"@id":"mb:hasUrl","@type":"xsd:string"},map:{"@id":"mb:hasJsonMap","@type":"xsd:string"},smooth:{"@id":"mb:isSmooth","@type":"xsd:boolean"},average:{"@id":"mb:isAverageOf","@type":"xsd:integer"},uuid:{"@id":"mb:hasUuid","@type":"xsd:string"},major:{"@id":"mb:hasMajor","@type":"xsd:integer"},minor:{"@id":"mb:hasMinor","@type":"xsd:integer"},rampDuration:{"@id":"mb:hasDuration","@type":"xsd:integer"},navigators:"mb:hasNavigator",
dymos:"mb:navDymos"}},DYMO_SIMPLE_CONTEXT={"@context":{"@base":"http://tiny.cc/dymo-context/",xsd:"http://www.w3.org/2001/XMLSchema#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",sch:"http://schema.org/",mo:"http://purl.org/ontology/mo/",mt:"http://purl.org/ontology/studio/multitrack#",ch:"http://tiny.cc/charm-ontology#",dy:"http://tiny.cc/dymo-ontology#",mb:"http://tiny.cc/mobile-audio-ontology#",name:"sch:name",cdt:"ch:cdt",adt:"ch:adt",value:"ch:value",parts:"ch:hasPart",
Dymo:"dy:Dymo",DymoType:"dy:DymoType",Conjunction:"dy:Conjunction",Disjunction:"dy:Disjunction",Sequence:"dy:Sequence",Feature:"dy:Feature",Parameter:"dy:Parameter",FeatureType:"dy:FeatureType",ParameterType:"dy:ParameterType",level:"dy:LevelFeature",index:"dy:IndexFeature",onset:"dy:OnsetFeature",pitch:"dy:PitchFeature",duration:"dy:DurationFeature",time:"dy:TimeFeature",segmentLabel:"dy:SegmentLabelFeature",CustomFeature:"dy:CustomFeature",AudioParameter:"dy:AudioParameter",hasStandardValue:"dy:hasStandardValue",
isInteger:"dy:isInteger",Play:"dy:Play",Loop:"dy:Loop",Onset:"dy:Onset",DurationRatio:"dy:DurationRatio",Amplitude:"dy:Amplitude",PlaybackRate:"dy:PlaybackRate",TimeStretchRatio:"dy:TimeStretchRatio",Pan:"dy:Pan",Distance:"dy:Distance",Height:"dy:Height",Reverb:"dy:Reverb",Delay:"dy:Delay",Filter:"dy:Filter",StructuralParameter:"dy:StructuralParameter",PartCount:"dy:PartCount",PartDurationRatio:"dy:PartDurationRatio",PartProportion:"dy:PartProportion",CustomParameter:"dy:CustomParameter",source:"dy:hasSource",
parameters:"dy:hasParameter",features:"dy:hasFeature",paramType:"dy:hasParameterType",featureType:"dy:hasFeatureType",similars:"dy:hasSimilar",successors:"dy:hasSuccessor",Rendering:"mb:Rendering",Mapping:"mb:Mapping",Function:"mb:Function",Argument:"mb:Argument",MobileControl:"mb:MobileControl",SensorControl:"mb:SensorControl",UiControl:"mb:UiControl",DataControl:"mb:DataControl",AutoControl:"mb:AutoControl",AccelerometerX:"mb:AccelerometerX",AccelerometerY:"mb:AccelerometerY",AccelerometerZ:"mb:AccelerometerZ",
TiltX:"mb:TiltX",TiltY:"mb:TiltY",TiltZ:"mb:TiltZ",GeolocationLatitude:"mb:GeolocationLatitude",GeolocationLongitude:"mb:GeolocationLongitude",GeolocationDistance:"mb:GeolocationDistance",CompassHeading:"mb:CompassHeading",Beacon:"mb:Beacon",Slider:"mb:Slider",Toggle:"mb:Toggle",Button:"mb:Button",CustomControl:"mb:CustomControl",Random:"mb:Random",Brownian:"mb:Brownian",Ramp:"mb:Ramp",MobileParameter:"mb:MobileParameter",GlobalParameter:"mb:GlobalParameter",ControlParameter:"mb:ControlParameter",
ListenerOrientation:"mb:ListenerOrientation",AutoControlFrequency:"mb:AutoControlFrequency",AutoControlTrigger:"mb:AutoControlTrigger",BrownianMaxStepSize:"mb:BrownianMaxStepSize",LeapingProbability:"mb:LeapingProbability",ContinueAfterLeaping:"mb:ContinueAfterLeaping",Navigator:"mb:Navigator",OneShotNavigator:"mb:OneShotNavigator",SequentialNavigator:"mb:SequentialNavigator",SimilarityNavigator:"mb:SimilarityNavigator",GraphNavigator:"mb:GraphNavigator",ArgumentValue:"mb:ArgumentValue",MappingTarget:"mb:MappingTarget",
MappingRange:"mb:MappingRange",MappingOwners:"mb:MappingOwners",dymo:"mb:hasDymo",mappings:"mb:hasMapping","function":"mb:hasFunction",args:"mb:hasArgument","var":"mb:hasVariable",val:"mb:hasValue",body:"mb:hasBody",targets:"mb:toTarget",range:"mb:hasRange",unidirectional:"mb:isUnidirectional",init:"mb:hasInitialValue",url:"mb:hasUrl",map:"mb:hasJsonMap",smooth:"mb:isSmooth",average:"mb:isAverageOf",uuid:"mb:hasUuid",major:"mb:hasMajor",minor:"mb:hasMinor",rampDuration:"mb:hasDuration",navigators:"mb:hasNavigator",
dymos:"mb:navDymos"}};var OPTIMIZED_MODE=!1,SCHEDULE_AHEAD_TIME=.1,FADE_LENGTH=.02,DYMO_ONTOLOGY_URI="http://tiny.cc/dymo-ontology#",DYMO_STORE,DONE="done",MORE="more";var URI_TO_TERM={"http://tiny.cc/dymo-ontology#LevelFeature":"level","http://tiny.cc/dymo-ontology#IndexFeature":"index","http://tiny.cc/dymo-ontology#OnsetFeature":"onset","http://tiny.cc/dymo-ontology#PitchFeature":"pitch","http://tiny.cc/dymo-ontology#DurationFeature":"duration","http://tiny.cc/dymo-ontology#TimeFeature":"time","http://tiny.cc/dymo-ontology#SegmentLabelFeature":"segmentLabel","http://tiny.cc/dymo-ontology#hasSource":"source","http://tiny.cc/dymo-ontology#hasParameter":"parameters",
"http://tiny.cc/dymo-ontology#hasFeature":"features","http://tiny.cc/dymo-ontology#hasParameterType":"paramType","http://tiny.cc/dymo-ontology#hasFeatureType":"featureType","http://tiny.cc/dymo-ontology#hasSimilar":"similars","http://tiny.cc/dymo-ontology#hasSuccessor":"successors","http://tiny.cc/mobile-audio-ontology#hasDymo":"dymo","http://tiny.cc/mobile-audio-ontology#hasMapping":"mappings","http://tiny.cc/mobile-audio-ontology#hasFunction":"function","http://tiny.cc/mobile-audio-ontology#hasArgument":"args",
"http://tiny.cc/mobile-audio-ontology#hasVariable":"var","http://tiny.cc/mobile-audio-ontology#hasValue":"val","http://tiny.cc/mobile-audio-ontology#hasBody":"body","http://tiny.cc/mobile-audio-ontology#toTarget":"targets","http://tiny.cc/mobile-audio-ontology#hasRange":"range","http://tiny.cc/mobile-audio-ontology#isUnidirectional":"unidirectional","http://tiny.cc/mobile-audio-ontology#hasInitialValue":"init","http://tiny.cc/mobile-audio-ontology#hasUrl":"url","http://tiny.cc/mobile-audio-ontology#hasJsonMap":"map",
"http://tiny.cc/mobile-audio-ontology#isSmooth":"smooth","http://tiny.cc/mobile-audio-ontology#isAverageOf":"average","http://tiny.cc/mobile-audio-ontology#hasUuid":"uuid","http://tiny.cc/mobile-audio-ontology#hasMajor":"major","http://tiny.cc/mobile-audio-ontology#hasMinor":"minor","http://tiny.cc/mobile-audio-ontology#hasDuration":"rampDuration","http://tiny.cc/mobile-audio-ontology#hasNavigator":"navigators","http://tiny.cc/mobile-audio-ontology#navDymos":"dymos"};var RDFS_URI="http://www.w3.org/2000/01/rdf-schema#",CONTEXT_URI="http://tiny.cc/dymo-context/",TYPE="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",FIRST="http://www.w3.org/1999/02/22-rdf-syntax-ns#first",REST="http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",NIL="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil",DOMAIN="http://www.w3.org/2000/01/rdf-schema#domain",RANGE="http://www.w3.org/2000/01/rdf-schema#range",LABEL="http://www.w3.org/2000/01/rdf-schema#label",NAME="http://schema.org/name",
CDT="http://tiny.cc/charm-ontology#cdt",ADT="http://tiny.cc/charm-ontology#adt",VALUE="http://tiny.cc/charm-ontology#value",HAS_PART="http://tiny.cc/charm-ontology#hasPart",DYMO="http://tiny.cc/dymo-ontology#Dymo",DYMO_TYPE="http://tiny.cc/dymo-ontology#DymoType",CONJUNCTION="http://tiny.cc/dymo-ontology#Conjunction",DISJUNCTION="http://tiny.cc/dymo-ontology#Disjunction",SEQUENCE="http://tiny.cc/dymo-ontology#Sequence",FEATURE="http://tiny.cc/dymo-ontology#Feature",PARAMETER="http://tiny.cc/dymo-ontology#Parameter",
FEATURE_TYPE="http://tiny.cc/dymo-ontology#FeatureType",PARAMETER_TYPE="http://tiny.cc/dymo-ontology#ParameterType",LEVEL_FEATURE="http://tiny.cc/dymo-ontology#LevelFeature",INDEX_FEATURE="http://tiny.cc/dymo-ontology#IndexFeature",ONSET_FEATURE="http://tiny.cc/dymo-ontology#OnsetFeature",PITCH_FEATURE="http://tiny.cc/dymo-ontology#PitchFeature",DURATION_FEATURE="http://tiny.cc/dymo-ontology#DurationFeature",TIME_FEATURE="http://tiny.cc/dymo-ontology#TimeFeature",SEGMENT_LABEL_FEATURE="http://tiny.cc/dymo-ontology#SegmentLabelFeature",
CUSTOM_FEATURE="http://tiny.cc/dymo-ontology#CustomFeature",AUDIO_PARAMETER="http://tiny.cc/dymo-ontology#AudioParameter",HAS_STANDARD_VALUE="http://tiny.cc/dymo-ontology#hasStandardValue",IS_INTEGER="http://tiny.cc/dymo-ontology#isInteger",PLAY="http://tiny.cc/dymo-ontology#Play",LOOP="http://tiny.cc/dymo-ontology#Loop",ONSET="http://tiny.cc/dymo-ontology#Onset",DURATION_RATIO="http://tiny.cc/dymo-ontology#DurationRatio",AMPLITUDE="http://tiny.cc/dymo-ontology#Amplitude",PLAYBACK_RATE="http://tiny.cc/dymo-ontology#PlaybackRate",
TIME_STRETCH_RATIO="http://tiny.cc/dymo-ontology#TimeStretchRatio",PAN="http://tiny.cc/dymo-ontology#Pan",DISTANCE="http://tiny.cc/dymo-ontology#Distance",HEIGHT="http://tiny.cc/dymo-ontology#Height",REVERB="http://tiny.cc/dymo-ontology#Reverb",DELAY="http://tiny.cc/dymo-ontology#Delay",FILTER="http://tiny.cc/dymo-ontology#Filter",STRUCTURAL_PARAMETER="http://tiny.cc/dymo-ontology#StructuralParameter",PART_COUNT="http://tiny.cc/dymo-ontology#PartCount",PART_DURATION_RATIO="http://tiny.cc/dymo-ontology#PartDurationRatio",
PART_PROPORTION="http://tiny.cc/dymo-ontology#PartProportion",CUSTOM_PARAMETER="http://tiny.cc/dymo-ontology#CustomParameter",HAS_SOURCE="http://tiny.cc/dymo-ontology#hasSource",HAS_PARAMETER="http://tiny.cc/dymo-ontology#hasParameter",HAS_FEATURE="http://tiny.cc/dymo-ontology#hasFeature",HAS_PARAMETER_TYPE="http://tiny.cc/dymo-ontology#hasParameterType",HAS_FEATURE_TYPE="http://tiny.cc/dymo-ontology#hasFeatureType",HAS_SIMILAR="http://tiny.cc/dymo-ontology#hasSimilar",HAS_SUCCESSOR="http://tiny.cc/dymo-ontology#hasSuccessor",
RENDERING="http://tiny.cc/mobile-audio-ontology#Rendering",MAPPING="http://tiny.cc/mobile-audio-ontology#Mapping",FUNCTION="http://tiny.cc/mobile-audio-ontology#Function",ARGUMENT="http://tiny.cc/mobile-audio-ontology#Argument",MOBILE_CONTROL="http://tiny.cc/mobile-audio-ontology#MobileControl",SENSOR_CONTROL="http://tiny.cc/mobile-audio-ontology#SensorControl",UI_CONTROL="http://tiny.cc/mobile-audio-ontology#UiControl",DATA_CONTROL="http://tiny.cc/mobile-audio-ontology#DataControl",AUTO_CONTROL=
"http://tiny.cc/mobile-audio-ontology#AutoControl",ACCELEROMETER_X="http://tiny.cc/mobile-audio-ontology#AccelerometerX",ACCELEROMETER_Y="http://tiny.cc/mobile-audio-ontology#AccelerometerY",ACCELEROMETER_Z="http://tiny.cc/mobile-audio-ontology#AccelerometerZ",TILT_X="http://tiny.cc/mobile-audio-ontology#TiltX",TILT_Y="http://tiny.cc/mobile-audio-ontology#TiltY",TILT_Z="http://tiny.cc/mobile-audio-ontology#TiltZ",GEOLOCATION_LATITUDE="http://tiny.cc/mobile-audio-ontology#GeolocationLatitude",GEOLOCATION_LONGITUDE=
"http://tiny.cc/mobile-audio-ontology#GeolocationLongitude",GEOLOCATION_DISTANCE="http://tiny.cc/mobile-audio-ontology#GeolocationDistance",COMPASS_HEADING="http://tiny.cc/mobile-audio-ontology#CompassHeading",BEACON="http://tiny.cc/mobile-audio-ontology#Beacon",SLIDER="http://tiny.cc/mobile-audio-ontology#Slider",TOGGLE="http://tiny.cc/mobile-audio-ontology#Toggle",BUTTON="http://tiny.cc/mobile-audio-ontology#Button",CUSTOM_CONTROL="http://tiny.cc/mobile-audio-ontology#CustomControl",RANDOM="http://tiny.cc/mobile-audio-ontology#Random",
BROWNIAN="http://tiny.cc/mobile-audio-ontology#Brownian",RAMP="http://tiny.cc/mobile-audio-ontology#Ramp",MOBILE_PARAMETER="http://tiny.cc/mobile-audio-ontology#MobileParameter",GLOBAL_PARAMETER="http://tiny.cc/mobile-audio-ontology#GlobalParameter",CONTROL_PARAMETER="http://tiny.cc/mobile-audio-ontology#ControlParameter",LISTENER_ORIENTATION="http://tiny.cc/mobile-audio-ontology#ListenerOrientation",AUTO_CONTROL_FREQUENCY="http://tiny.cc/mobile-audio-ontology#AutoControlFrequency",AUTO_CONTROL_TRIGGER=
"http://tiny.cc/mobile-audio-ontology#AutoControlTrigger",BROWNIAN_MAX_STEP_SIZE="http://tiny.cc/mobile-audio-ontology#BrownianMaxStepSize",LEAPING_PROBABILITY="http://tiny.cc/mobile-audio-ontology#LeapingProbability",CONTINUE_AFTER_LEAPING="http://tiny.cc/mobile-audio-ontology#ContinueAfterLeaping",NAVIGATOR="http://tiny.cc/mobile-audio-ontology#Navigator",ONE_SHOT_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#OneShotNavigator",SEQUENTIAL_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#SequentialNavigator",
SIMILARITY_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#SimilarityNavigator",GRAPH_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#GraphNavigator",ARGUMENT_VALUE="http://tiny.cc/mobile-audio-ontology#ArgumentValue",MAPPING_TARGET="http://tiny.cc/mobile-audio-ontology#MappingTarget",MAPPING_RANGE="http://tiny.cc/mobile-audio-ontology#MappingRange",MAPPING_OWNERS="http://tiny.cc/mobile-audio-ontology#MappingOwners",HAS_DYMO="http://tiny.cc/mobile-audio-ontology#hasDymo",HAS_MAPPING="http://tiny.cc/mobile-audio-ontology#hasMapping",
HAS_FUNCTION="http://tiny.cc/mobile-audio-ontology#hasFunction",HAS_ARGUMENT="http://tiny.cc/mobile-audio-ontology#hasArgument",HAS_VARIABLE="http://tiny.cc/mobile-audio-ontology#hasVariable",HAS_VALUE="http://tiny.cc/mobile-audio-ontology#hasValue",HAS_BODY="http://tiny.cc/mobile-audio-ontology#hasBody",TO_TARGET="http://tiny.cc/mobile-audio-ontology#toTarget",HAS_RANGE="http://tiny.cc/mobile-audio-ontology#hasRange",IS_UNIDIRECTIONAL="http://tiny.cc/mobile-audio-ontology#isUnidirectional",HAS_INITIAL_VALUE=
"http://tiny.cc/mobile-audio-ontology#hasInitialValue",HAS_URL="http://tiny.cc/mobile-audio-ontology#hasUrl",HAS_JSON_MAP="http://tiny.cc/mobile-audio-ontology#hasJsonMap",IS_SMOOTH="http://tiny.cc/mobile-audio-ontology#isSmooth",IS_AVERAGE_OF="http://tiny.cc/mobile-audio-ontology#isAverageOf",HAS_UUID="http://tiny.cc/mobile-audio-ontology#hasUuid",HAS_MAJOR="http://tiny.cc/mobile-audio-ontology#hasMajor",HAS_MINOR="http://tiny.cc/mobile-audio-ontology#hasMinor",HAS_DURATION="http://tiny.cc/mobile-audio-ontology#hasDuration",
HAS_NAVIGATOR="http://tiny.cc/mobile-audio-ontology#hasNavigator",NAV_DYMOS="http://tiny.cc/mobile-audio-ontology#navDymos";function OntologyLoader2(a,b,c){};function DymoLoader(a){function b(b,d){c(b,"",function(b){a.loadData(b,!0,d)})}function c(a,b,h){loadFile(a,function(f){if(0>f.indexOf("Cannot GET")){var e;a:{try{JSON.parse(f)}catch(r){e=!1;break a}e=!0}e&&(b?(0<=a.indexOf(n)&&(a=a.replace(n,"")),b=b.replace('"'+a+'"',f)):b=f);(f=d(b))?(0>f.indexOf(n)&&(f=n+f),c(f,b,h)):b&&h(JSON.parse(b))}})}function d(a){var b=a.indexOf(".json");if(0<=b){if(b!=a.indexOf("context.json")+7){var c=a.substring(0,b).lastIndexOf('"');return a.substring(c+1,b+5)}return d(a.substring(b+
1))}}function e(b){b=b?a.findAllObjects(b,HAS_MAPPING):a.findAllSubjects(TYPE,MAPPING);for(var c=a.recursiveFindAllSubClasses(MOBILE_CONTROL),d=0;d<c.length;d++)for(var f=a.findAllSubjects(TYPE,c[d]),e=0;e<f.length;e++){var p=a.findObjectValue(f[e],NAME);p||(p=f[e]);if(!h[f[e]]){var n=f[e],k=f[e],l=p,t=c[d],p=void 0;t==ACCELEROMETER_X||t==ACCELEROMETER_Y||t==ACCELEROMETER_Z?p=new AccelerometerControl(t):t==TILT_X||t==TILT_Y?p=new TiltControl(t):t==GEOLOCATION_LATITUDE||t==GEOLOCATION_LONGITUDE?p=
new GeolocationControl(t):t==GEOLOCATION_DISTANCE?p=new DistanceControl:t==COMPASS_HEADING?p=new CompassControl:t==BEACON?(p=a.findObjectValue(k,HAS_UUID),l=a.findObjectValue(k,HAS_MAJOR),t=a.findObjectValue(k,HAS_MINOR),p=new BeaconControl(p,l,t)):t==SLIDER||t==TOGGLE||t==BUTTON||t==CUSTOM_CONTROL?(p=new Control(k,l,t),l=a.findObjectValue(k,HAS_INITIAL_VALUE),p.updateValue(l)):t==RANDOM?p=new RandomControl(k):t==BROWNIAN?(l=a.findObjectValue(k,HAS_INITIAL_VALUE),p=new BrownianControl(k,l)):t==RAMP?
(p=Math.round(1E3*a.findObject(k,HAS_DURATION)),l=a.findObjectValue(k,HAS_INITIAL_VALUE),p=new RampControl(k,p,l)):t==DATA_CONTROL&&(p=a.findObjectValue(k,HAS_URL),l=a.findObjectValue(k,HAS_JSON_MAP),l=new Function("json",l),p=new DataControl(k,p,l));a.findObjectValue(k,IS_SMOOTH)&&p.setSmooth&&p.setSmooth(!0);k=a.findObjectValue(k,IS_AVERAGE_OF);!isNaN(k)&&p.setAverageOf&&p.setAverageOf(k);h[n]=p}}for(c=0;c<b.length;c++)m[b[c]]||(e=DYMO_STORE.findSubject(HAS_MAPPING,b[c]),DYMO_STORE.findObject(e,
TYPE)!=DYMO&&(e=null),d=b[c],f=b[c],n=e,e=a.findObjectValue(f,IS_UNIDIRECTIONAL),k=a.findObject(f,HAS_FUNCTION),n=g(k,e,n),k=a.findAllObjects(f,TO_TARGET),k=0<k.length?(p=g(k[0],!0))?p:k:void 0,f=a.findObject(f,HAS_RANGE),f=new Mapping(n,k,f,e),m[d]=f)}function g(b,c,d){var h=$jscomp.makeIterator(a.findFunction(b));b=h.next().value;var f=h.next().value,h=h.next().value;if(b&&f&&h)return d=$jscomp.makeIterator(k(f,d)),f=d.next().value,d=d.next().value,new DymoFunction(b,f,d,h,c)}function k(b,c){for(var d=
[],f=[],e=0;e<b.length;e++){var m=a.findObject(b[e],TYPE);m==FEATURE_TYPE||a.isSubtypeOf(m,FEATURE_TYPE)?(m==FEATURE_TYPE&&(m=b[e]),d.push(m),f.push(FEATURE_TYPE)):m==PARAMETER_TYPE||a.isSubclassOf(m,PARAMETER_TYPE)||a.isSubclassOf(a.findObject(m,TYPE),PARAMETER_TYPE)?(m==CUSTOM_PARAMETER&&(m=b[e]),m=c?a.setParameter(c,m):b[e],d.push(m),f.push(PARAMETER_TYPE)):(d.push(h[b[e]]),f.push(MOBILE_CONTROL))}return[d,f]}function l(a){return a==SIMILARITY_NAVIGATOR?new SimilarityNavigator(void 0):a==GRAPH_NAVIGATOR?
new GraphNavigator(void 0):new SequentialNavigator(void 0)}var f=this,n="",h={},m={};this.getMappings=function(){return m};this.loadDymoFromJson=function(a,c){var d=a.lastIndexOf("/")+1;n=a.substring(0,d);b(a,function(){c(f.createDymoFromStore())})};this.parseDymoFromJson=function(b,c){a.loadData(b,!0,function(){c(f.createDymoFromStore())})};this.loadRenderingFromJson=function(a,c){b(a,function(){c(f.createRenderingFromStore())})};this.parseDymoFromTurtle=function(b,c){a.loadData(b,!1,function(){c(f.createDymoFromStore())})};
this.createDymoFromStore=function(){for(var b=a.findTopDymos(),c=0;c<b.length;c++)a.addBasePath(b[c],n),e();return b};this.createRenderingFromStore=function(){var b=a.findSubject(TYPE,RENDERING),c=new Rendering(a.findObject(b,HAS_DYMO));e(b);for(var b=a.findAllObjects(b,HAS_NAVIGATOR),d=0;d<b.length;d++){var f=g(a.findObject(b[d],NAV_DYMOS),!0);c.addSubsetNavigator(f,l(a.findObject(b[d],TYPE)))}return[c,h]}};function DymoStore(a){function b(a,c){for(var d=0;d<a.length;d++){var f=c(a[d]);if(f)return f}for(d=0;d<a.length;d++)if(f=b(k.findParents(a[d]),c))return f}function c(a,b,c){k.triplesToRdf(a,function(a){d(a,b,c)})}function d(a,b,c){a=a.split("_b").join("b");jsonld.fromRDF(a,{format:"application/nquads"},function(a,d){jsonld.frame(d,{"@id":b},function(a,b){jsonld.compact(b,DYMO_CONTEXT,function(a,b){jsonld.compact(b,DYMO_SIMPLE_CONTEXT,function(a,b){g(b);b["@context"]="http://tiny.cc/dymo-context";
b=JSON.stringify(b);b=b.replace(/http:\/\/tiny.cc\/dymo-context\//g,"");c(b)})})})})}function e(a,b){var d=k.findObject(a,TYPE,null),f=k.recursiveFindAllTriples(a,d);c(f,a,function(c){c=JSON.parse(c);if(d==DYMO){var h=k.findLevel(a).toString();c.features||(c.features=[]);c.features.push({"@type":"level",value:{"@type":"xsd:integer","@value":h}})}b(null,c)})}function g(a){if(a&&a instanceof Object)for(var b in a)"@id"==b&&a[b].includes("_:b")?delete a[b]:g(a[b])}var k=this;EasyStore.call(this);var l=
{};(function(){k.loadFileIntoStore("http://tiny.cc/dymo-ontology",!1,function(){k.loadFileIntoStore("http://tiny.cc/mobile-audio-ontology",!1,function(){a&&a()})})})();this.addBasePath=function(a,b){l[a]=b};this.getBasePath=function(a){return b([a],function(a){return l[a]})};this.getSourcePath=function(a){var b=this.findObjectValue(a,HAS_SOURCE);if(b)return(a=this.getBasePath(a))?a+b:b;b=this.findParents(a);if(0<b.length)for(a=0;a<b.length;a++){var c=this.getSourcePath(b[a]);if(c)return c}};this.addSpecificParameterObserver=
function(a,b){this.addValueObserver(a,VALUE,b)};this.addParameterObserver=function(a,b,c){if(a&&b)return a=this.setParameter(a,b),this.addValueObserver(a,VALUE,c),a};this.getParameterObservers=function(a,b){if(a&&b&&(a=this.findObjectOfType(a,HAS_PARAMETER,b)))return this.getValueObservers(a,VALUE)};this.removeParameterObserver=function(a,b,c){a&&b&&(a=this.findObjectOfType(a,HAS_PARAMETER,b))&&this.removeValueObserver(a,VALUE,c)};this.addDymo=function(a,b,c,d,e){this.addTriple(a,TYPE,DYMO);b&&this.addPart(b,
a);c&&this.addPart(a,c);d&&this.addTriple(a,HAS_SOURCE,N3.Util.createLiteral(d));e&&this.addTriple(a,CDT,e);return a};this.addPart=function(a,b){k.addObjectToList(a,HAS_PART,b)};this.setParts=function(a,b){this.deleteList(a,HAS_PART);this.addObjectsToList(a,HAS_PART,b)};this.replacePartAt=function(a,b,c){if(a!=b)return this.replaceObjectInList(a,HAS_PART,b,c)};this.addSimilar=function(a,b){this.addTriple(a,HAS_SIMILAR,b)};this.addSuccessor=function(a,b){this.addTriple(a,HAS_SUCCESSOR,b)};this.setFeature=
function(a,b,c){return this.setObjectValue(a,HAS_FEATURE,b,VALUE,c)};this.addParameter=function(a,b,c,d){this.setParameter(a,b,c);d&&this.addParameterObserver(a,b,d)};this.addCustomParameter=function(a,b){this.addTriple(a,HAS_PARAMETER,b);this.addTriple(b,TYPE,CUSTOM_PARAMETER);return b};this.setParameter=function(a,b,c){this.findParameterUri(a,b)||null!=c&&!isNaN(c)||(c=this.findObjectValue(b,HAS_STANDARD_VALUE,null));this.findObject(b,IS_INTEGER)&&(c=Math.round(c));return this.setObjectValue(a,
HAS_PARAMETER,b,VALUE,c)};this.addControl=function(a,b,c){c||(c=this.createBlankNode());a&&this.addTriple(c,NAME,N3.Util.createLiteral(a));this.addTriple(c,TYPE,b);return c};this.addDataControl=function(a,b){var c=this.addControl(null,DATA_CONTROL);this.addTriple(c,HAS_URL,N3.Util.createLiteral(a));this.addTriple(c,HAS_JSON_MAP,N3.Util.createLiteral(b));return c};this.addRendering=function(a,b){this.addTriple(a,TYPE,RENDERING);this.addTriple(a,HAS_DYMO,b)};this.addMapping=function(a,b,c,d,e){var h=
this.createBlankNode();this.addTriple(h,TYPE,MAPPING);a&&this.addTriple(a,HAS_MAPPING,h);this.addTriple(h,HAS_FUNCTION,b);if(c)for(a=0;a<c.length;a++)this.addTriple(h,TO_TARGET,c[a]);else d&&this.addTriple(h,TO_TARGET,d);this.addTriple(h,HAS_RANGE,e);this.findObject(e,TYPE)||this.addTriple(e,TYPE,CUSTOM_PARAMETER);return h};this.addNavigator=function(a,b,c,d){var h=this.createBlankNode();this.addTriple(a,HAS_NAVIGATOR,h);this.addTriple(h,TYPE,b);a=this.addFunction(c,d);this.addTriple(h,NAV_DYMOS,
a);return h};this.addFunction=function(a,b){for(var c=this.createBlankNode(),d=Object.keys(a),e=0;e<d.length;e++){var f=this.createBlankNode();this.addTriple(c,HAS_ARGUMENT,f);this.addTriple(f,HAS_VARIABLE,N3.Util.createLiteral(d[e]));this.addTriple(f,HAS_VALUE,a[d[e]])}this.addTriple(c,HAS_BODY,N3.Util.createLiteral(b));return c};this.updatePartOrder=function(a,b){var c=this.findParts(a);0<c.length&&(c.sort(function(a,c){return k.findAttributeValue(a,b)-k.findAttributeValue(c,b)}),this.setParts(a,
c))};this.findTopDymos=function(){var a=this.findAllSubjects(TYPE,DYMO),b=this.findAllSubjects(HAS_PART),c=[].concat.apply([],b.map(function(a){return k.findParts(a)}));return a.filter(function(a){return 0>c.indexOf(a)})};this.findParts=function(a){return this.findAllObjects(a,HAS_PART)};this.findPartAt=function(a,b){return this.findObjectInListAt(a,HAS_PART,b)};this.findSimilars=function(a){return this.findAllObjects(a,HAS_SIMILAR)};this.findSuccessors=function(a){return this.findAllObjects(a,HAS_SUCCESSOR)};
this.findAllParents=function(a){for(var b=[];null!=a;)b.push(a),a=DYMO_STORE.findParents(a)[0];return b};this.findParents=function(a){var b=this.findContainingLists(a);return b[0].filter(function(a,c){return b[1][c]==HAS_PART})};this.findAllObjectsInHierarchy=function(a){if(a){var b=[a];a=this.findParts(a);for(var c=0;c<a.length;c++)b=b.concat(this.findAllObjectsInHierarchy(a[c]));return b}};this.findDymoRelations=function(){var a=this.findAllSubjects(DOMAIN,DYMO),b=this.findAllSubjects(RANGE,DYMO);
return[HAS_PART].concat(intersectArrays(a,b))};this.findMappings=function(a){return this.findAllObjects(a,HAS_MAPPING)};this.findNavigators=function(a){return this.findAllObjects(a,HAS_NAVIGATOR)};this.findFunction=function(a){if(a){var b=k.findAllObjects(a,HAS_ARGUMENT),c=b.map(function(a){return k.findObjectValue(a,HAS_VARIABLE)}),b=b.map(function(a){return k.findObject(a,HAS_VALUE)});a=k.findObjectValue(a,HAS_BODY);return[c,b,a]}};this.findAttributeValue=function(a,b){var c=this.findParameterValue(a,
b);null==c&&(c=this.findFeatureValue(a,b));return c};this.findFeatureValue=function(a,b){return b===LEVEL_FEATURE?this.findLevel(a):b===INDEX_FEATURE?this.findPartIndex(a):this.findObjectValueOfType(a,HAS_FEATURE,b,VALUE)};this.findAllFeatureValues=function(a){return this.findAllObjectValuesOfType(a,HAS_FEATURE,VALUE)};this.findAllNumericFeatureValues=function(a){return this.findAllFeatureValues(a).filter(function(a){return!isNaN(a)})};this.findParameterValue=function(a,b){return this.findObjectValueOfType(a,
HAS_PARAMETER,b,VALUE)};this.findParameterUri=function(a,b){return a?this.findObjectOfType(a,HAS_PARAMETER,b):this.findSubject(null,b)};this.findPartIndex=function(a){var b=this.findParents(a)[0];return this.findObjectIndexInList(b,HAS_PART,a)};this.findLevel=function(a){var b=0;for(a=this.findParents(a)[0];a;)b++,a=this.findParents(a)[0];return b};this.findMaxLevel=function(){for(var a=this.findAllSubjects(TYPE,DYMO),b=0,c=0;c<a.length;c++)b=Math.max(b,this.findLevel(a[c]));return b};this.toJsonld=
function(a){var b=this.findTopDymos()[0];this.toRdf(function(c){d(c,b,a)})};this.toJsonGraph=function(a,b,c){var d={nodes:[],edges:[]},h={},f=this.findAllSubjects(TYPE,a),g=this.find(null,b,null);async.map(f,e,function(e,m){d.nodes=m;for(var p=0;p<f.length;p++)h[f[p]]=d.nodes[p];d.edges=[];for(p=0;p<g.length;p++)0==k.find(g[p].object,TYPE,a).length?0<k.find(g[p].object,FIRST).length&&(e=k.findObjectOrList(g[p].subject,b),e=e.map(function(a){return{source:h[g[p].subject],target:h[a],value:1}}),d.edges=
d.edges.concat(e)):d.edges.push({source:h[g[p].subject],target:h[g[p].object],value:1});c(d)})}}inheritPrototype(DymoStore,EasyStore);function DymoWriter(a){this.writeToJsonld=function(b,c){c||(c="dymo.json");a.toJsonld(function(a){fetch(b+c,{method:"post",body:a})})}};function EasyReasoner(){function a(a,c,d){var b=new XMLHttpRequest;b.open("POST",a);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onload=function(){d(b.responseText)};b.error=function(a){console.log(a)};b.send(c)}this.queryAll=function(b,c){for(var d="",e=0;e<b.length;e++)d+=encodeURIComponent("data="+b[e])+"&";d+=encodeURIComponent("query={ ?a ?b ?c. } => { ?a ?b ?c. }.");a("http://eye.restdesc.org/",d,function(a){c(a)})}};function EasyStore(){function a(a,b,c){var d=[];f[a]&&f[a][b]&&(d=d.concat(f[a][b]));b=k.findObject(a,TYPE);n[b]&&(d=d.concat(n[b]));for(var h=0;h<d.length;h++)d[h].observedValueChanged&&d[h].observedValueChanged(a,b,c)}function b(a,b){a=l.find(null,a,b);if(0<a.length)return a[0].subject}function c(a){if(a){var b=k.findObject(a,FIRST);if(b){var c=[];c.push(b);for(a=k.findObject(a,REST);a!=NIL;)c.push(k.findObject(a,FIRST)),a=k.findObject(a,REST);return c}return a}}function d(a,b){if(a){for(var c=
0,d=k.findObject(a,REST);d!=NIL&&(null==b||c<b);)a=d,d=k.findObject(a,REST),c++;if(null==b||c==b)return a}}function e(a){var b=N3.Util.getLiteralValue(a);a=N3.Util.getLiteralType(a);"http://www.w3.org/2001/XMLSchema#string"!=a&&"http://www.w3.org/2001/XMLSchema#boolean"!=a&&(b=Number(b));return b}function g(a,b,c){b?jsonld.toRDF(a,{format:"application/nquads"},function(a,b){c(b)}):c(a)}var k=this,l=N3.Store(),f={},n={};this.addValueObserver=function(a,b,c){f[a]||(f[a]={});f[a][b]||(f[a][b]=[]);f[a][b].push(c)};
this.addTypeObserver=function(a,b,c){n[a]||(n[a]=[]);n[a].push(c)};this.removeValueObserver=function(a,b,c){f[a]&&f[a][b]&&(c=f[a][b].indexOf(c),-1<c&&(f[a][b].splice(c,1),f[a]&&0==f[a][b].length&&(delete f[a][b],0===Object.keys(f[a]).length&&delete f[a])))};this.removeTypeObserver=function(a,b,c){n[a]&&(b=n[a].indexOf(c),-1<b&&(n[a].splice(b,1),0==n[a].length&&delete n[a]))};this.getValueObservers=function(a,b){return f[a]?f[a][b]?f[a][b]:flattenArray(Object.values(f[a])):null==a&&null==b?flattenArray(Object.keys(f).map(function(a){return flattenArray(Object.values(f[a]))})):
[]};this.getTypeObservers=function(a){return n[a]?n[a]:null==a?flattenArray(Object.keys(n).map(function(a){return n[a]})):[]};this.addTriple=function(a,b,c){if(null!=a&&null!=b&&null!=c)return l.addTriple(a,b,c)};this.removeTriple=function(a,b,c){c||(c=this.findObject(a,b));return l.removeTriple(a,b,c)};this.createBlankNode=function(){return l.createBlankNode()};this.setTriple=function(a,b,c){this.removeTriple(a,b);this.addTriple(a,b,c)};this.setValue=function(b,c,d){var e=this.findObjectValue(b,
c);b&&c&&null!=d&&d!=e&&!Number.isNaN(d)&&(Array.isArray(d)?(d=d.map(function(a){return N3.Util.createLiteral(a)}),this.removeTriple(b,c),this.addObjectsToList(b,c,d)):this.setTriple(b,c,N3.Util.createLiteral(d)),a(b,c,d))};this.setObjectValue=function(a,b,c,d,e){var h;a&&b?h=this.findObjectOfType(a,b,c):a||(h=this.findSubject(TYPE,c));h||(h=this.createBlankNode(),a&&b&&this.addTriple(a,b,h),this.addTriple(h,TYPE,c));this.setValue(h,d,e);return h};this.addObjectToList=function(a,b,c){var e=this.findObject(a,
b),h=this.createBlankNode();e?(a=d(e),this.removeTriple(a,REST,NIL),this.addTriple(a,REST,h)):this.addTriple(a,b,h);this.addTriple(h,FIRST,c);this.addTriple(h,REST,NIL)};this.addObjectsToList=function(a,b,c){for(var d=0,e=c.length;d<e;d++)this.addObjectToList(a,b,c[d])};this.replaceObjectInList=function(a,b,c,e){a=this.findObject(a,b);e=d(a,e);a=this.findObject(e,FIRST);this.setTriple(e,FIRST,c);return a};this.removeObjectFromList=function(a,b,c){a=this.findObject(a,b);this.createBlankNode();c=d(a,
c-1);a=k.findObject(c,REST);b=k.findObject(a,REST);this.setTriple(c,REST,b);this.removeTriple(a,FIRST);this.removeTriple(a,REST)};this.deleteList=function(a,b){var c=this.findObject(a,b);if(c){for(;c!=NIL;){this.removeTriple(c,FIRST);var d=k.findObject(c,REST);this.removeTriple(c,REST);c=d}this.removeTriple(a,b)}};this.find=function(a,b,c){return l.find(a,b,c)};this.findObject=function(a,b){if(a&&b&&(a=l.find(a,b),0<a.length))return a[0].object};this.findObjectOrList=function(a,b){return c(this.findObject(a,
b))};this.findObjectValue=function(a,b){if(a=this.findObjectOrList(a,b))return Array.isArray(a)?a.map(e):e(a)};this.findObjectOfType=function(a,b,c){if(b&&c)if(a){a=this.findAllObjects(a,b);b=0;for(var d=a.length;b<d;b++)if(0<this.find(a[b],TYPE,c).length)return a[b]}else return this.findSubject(TYPE,c)};this.findObjectValueOfType=function(a,b,c,d){a=this.findObjectOfType(a,b,c);return this.findObjectValue(a,d)};this.findAllObjects=function(a,b){a=l.find(a,b).map(function(a){return a.object});a=a.map(c);
return flattenArray(a)};this.findAllObjectValues=function(a,b){return this.findAllObjects(a,b).filter(N3.Util.isLiteral).map(e)};this.findAllObjectValuesOfType=function(a,b,c){var d=[];a=this.findAllObjects(a,b);b=0;for(var e=a.length;b<e;b++){var h=k.findObjectValue(a[b],c);null!=h&&d.push(h)}return d};this.findSubject=function(a,c){var d=b(a,c);d||(d=b(a,N3.Util.createLiteral(c)));return d};this.findAllSubjects=function(a,b){var c=l.find(null,a,b);0==c.length&&(c=l.find(null,a,N3.Util.createLiteral(b)));
return removeDuplicates(c.map(function(a){return a.subject}))};this.findObjectIndexInList=function(a,b,c){if(a&&b){a:{var d=0;for(a=this.findObject(a,b);a!=NIL;){if(k.findObject(a,FIRST)==c){c=d;break a}a=k.findObject(a,REST);d++}c=-1}return c}};this.findObjectInListAt=function(a,b,c){if(a&&b&&(a=d(this.findObject(a,b),c)))return k.findObject(a,FIRST)};this.findContainingLists=function(a){var b=[],c=[];a=this.findAllSubjects(FIRST,a);for(var d=0;d<a.length;d++){for(var e=a[d],h=this.findSubject(REST,
e);h;)e=h,h=this.findSubject(REST,e);if(e=this.find(null,null,e)[0])b[d]=e.subject,c[d]=e.predicate}return[b,c]};this.recursiveFindAllTriples=function(a,b){a=l.find(a,null,null);for(var c=[],d=a.length-1;0<=d;d--)b&&0<l.find(a[d].object,TYPE,b).length?a.splice(d,1):c=c.concat(this.recursiveFindAllTriples(a[d].object,b));return a.concat(c)};this.recursiveDeleteAllTriples=function(a,b){a=this.recursiveFindAllTriples(a,b);for(b=0;b<a.length;b++){var c=a[b].subject;this.removeTriple(c,a[b].predicate,
a[b].object);for(var c=this.find(null,null,c),d=0;d<c.length;d++)this.removeTriple(c[d].subject,c[d].predicate,c[d].object)}};this.recursiveFindAllSubClasses=function(a){a=this.findAllSubjects(RDFS_URI+"subClassOf",a);for(var b=0;b<a.length;b++){var c=this.recursiveFindAllSubClasses(a[b]);c&&(a=a.concat(c))}return a};this.isSubclassOf=function(a,b){for(a=this.findObject(a,RDFS_URI+"subClassOf");a;){if(a==b)return!0;a=this.findObject(a,RDFS_URI+"subClassOf")}return!1};this.isSubtypeOf=function(a,b){for(a=
this.findObject(a,TYPE);a;){if(a==b)return!0;a=this.findObject(a,TYPE)}return!1};this.loadData=function(a,b,c){g(a,b,function(a){N3.Parser().parse(a,function(a,b,d){b?l.addTriple(b):c&&c()})})};this.loadFileIntoStore=function(a,b,c){loadFile(a,function(a){k.loadData(a,b,c)})};this.toRdf=function(a){var b=l.find(null,null,null);this.triplesToRdf(b,a)};this.triplesToRdf=function(a,b){for(var c=N3.Writer({format:"application/nquads"}),d=0;d<a.length;d++)c.addTriple(a[d]);c.end(function(a,c){b(c)})};
this.logData=function(){var a=l.find(null).map(function(a){return a.subject+"\n"+a.predicate+"\n"+a.object}),b;for(b in a)console.log(a[b])}};function FunctionTools(){}FunctionTools.IDENTITY_JSON={args:["a"],body:"return a;"};FunctionTools.inverted={};FunctionTools.created={};FunctionTools.createFunction=function(a,b){FunctionTools.created[b]||(FunctionTools.created[b]=Function.apply(null,a.concat(b)));return FunctionTools.created[b]};
FunctionTools.invertFunction=function(a){var b=FunctionTools.toReturnValueString(a);FunctionTools.inverted[a]||(b=FunctionTools.invertReturnValue(b),null!=b&&(FunctionTools.inverted[a]=FunctionTools.toJavaScriptFunction(b[0],b[1])));return FunctionTools.inverted[a]};
FunctionTools.invertReturnValue=function(a){var b;try{b=math.parse(a)}catch(e){e instanceof SyntaxError||console.log(e);return}for(var c=a=new math.expression.node.SymbolNode("a");b;)if(b.isSymbolNode)a.name=b.name,b=void 0;else if(b.isParenthesisNode)b=b.content;else if(b.isOperatorNode){var d=FunctionTools.getInvertedOperator(b.fn);if("unaryMinus"==b.fn)c=new math.expression.node.OperatorNode("-","unaryMinus",[c]),b=FunctionTools.ifNextNode(b.args[0]);else if("add"==b.fn||"multiply"==b.fn)if(b.args[0].isConstantNode)c=
new math.expression.node.OperatorNode(FunctionTools.getOp(d),d,[c,b.args[0]]),b=FunctionTools.ifNextNode(b.args[1]);else if(b.args[1].isConstantNode)c=new math.expression.node.OperatorNode(FunctionTools.getOp(d),d,[c,b.args[1]]),b=FunctionTools.ifNextNode(b.args[0]);else return;else if("subtract"==b.fn||"divide"==b.fn)if(b.args[0].isConstantNode)c=new math.expression.node.OperatorNode(FunctionTools.getOp(b.fn),b.fn,[b.args[0],c]),b=FunctionTools.ifNextNode(b.args[1]);else if(b.args[1].isConstantNode)c=
new math.expression.node.OperatorNode(FunctionTools.getOp(d),d,[c,b.args[1]]),b=FunctionTools.ifNextNode(b.args[0]);else return;else return}else return;return[a.name,c.toString()]};FunctionTools.toJavaScriptFunction=function(a,b){try{return new Function(a,"return "+b+";")}catch(c){}};FunctionTools.toReturnValueString=function(a){return a.substring(a.indexOf("return ")+7,a.indexOf(";"))};FunctionTools.ifNextNode=function(a){if(a.isOperatorNode||a.isParenthesisNode||a.isSymbolNode)return a};
FunctionTools.getInvertedOperator=function(a){if("add"==a)return"subtract";if("subtract"==a)return"add";if("multiply"==a)return"divide";if("divide"==a)return"multiply";if("unaryMinus"==a)return"unaryMinus"};FunctionTools.getOp=function(a){if("add"==a)return"+";if("subtract"==a||"unaryMinus"==a)return"-";if("multiply"==a)return"*";if("divide"==a)return"/"};function LogicTools(){}LogicTools.created={};LogicTools.varCount=0;LogicTools.createConstraint=function(a){LogicTools.created[a]||(LogicTools.created[a]=LogicTools.createGoal(LogicTools.toEquation(a)));return LogicTools.created[a]};LogicTools.createGoal=function(a){var b;try{b=math.parse(a)}catch(c){c instanceof SyntaxError||console.log(c);return}return LogicTools.createGoalFunction(b)};
LogicTools.createGoalFunction=function(a){var b=[],c=[];if(a=LogicTools.recursiveCreateGoalString(a,b,c)){a=a.slice(0,-1);for(var d="",e=0;e<c.length;e++)d+="var "+c[e]+" = logic.lvar('"+c[e]+"');\n";return FunctionTools.createFunction(b,d+("return logic.and("+a+");"))}};
LogicTools.recursiveCreateGoalString=function(a,b,c,d,e){d||(d="");var g=LogicTools.recursiveCreateGoalString;if(a.isParenthesisNode)return g(a.content,b,c,d,e);if(a.isOperatorNode){for(var k=LogicTools.toLogicJsOperatorString(a),k=k+"(",l=0;l<a.args.length;l++){if(a.args[l].isSymbolNode){var f=a.args[l].name,k=k+f;if(0>b.indexOf(f))b.push(f);else return}else if(a.args[l].isConstantNode&&"number"==a.args[l].valueType)k+=a.args[l].value;else{f="v"+LogicTools.varCount++;c.push(f);k+=f;f=g(a.args[l],
b,c,d,f);if(!f)return;d+=f}l<a.args.length-1&&(k+=",")}e&&(k+=","+e);return d+(k+"),")}};LogicTools.toLogicJsOperatorString=function(a){if("=="==a.op)return"logic.eq";if("+"==a.op)return"logic.add";if("-"==a.op)return"logic.sub";if("*"==a.op)return"logic.mul";if("/"==a.op)return"logic.div"};LogicTools.toEquation=function(a){a=0<=a.indexOf(";")?a.substring(a.indexOf("return ")+7,a.indexOf(";")):a.substring(a.indexOf("return ")+7);return"ret == "+a};function PolygonTools(){}PolygonTools.isPointInPolygon=function(a,b){for(var c=!1,d=-1,e=a.length,g=e-1;++d<e;g=d)(a[d][1]<=b[1]&&b[1]<a[g][1]||a[g][1]<=b[1]&&b[1]<a[d][1])&&b[0]<(a[g][0]-a[d][0])*(b[1]-a[d][1])/(a[g][1]-a[d][1])+a[d][0]&&(c=!c);return c};PolygonTools.getArea=function(a){var b=0,c,d,e=0;for(d=a.length-1;e<a.length;d=e,e++)c=a[e],d=a[d],b+=c[0]*d[1],b-=c[1]*d[0];return b/2};
PolygonTools.getCentroid=function(a){var b,c,d,e=0,g=0,k=0;for(c=a.length-1;k<a.length;c=k,k++)b=a[k],c=a[c],d=b[0]*c[1]-c[0]*b[1],e+=(b[0]+c[0])*d,g+=(b[1]+c[1])*d;d=6*PolygonTools.getArea(a);return{0:e/d,1:g/d}};function sqDist(a,b){return Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)}
PolygonTools.getDistanceFromSegment=function(a,b,c){var d=sqDist(b,c);if(0==d)return sqDist(a,b);d=((a[0]-b[0])*(c[0]-b[0])+(a[1]-b[1])*(c[1]-b[1]))/d;return 0>d?sqDist(a,b):1<d?sqDist(a,c):Math.sqrt(sqDist(a,{0:b[0]+d*(c[0]-b[0]),1:b[1]+d*(c[1]-b[1])}))};PolygonTools.getMinDistanceFromEdge=function(a,b){for(var c=Number.POSITIVE_INFINITY,d=0;d<a.length;d++)var e=PolygonTools.getDistanceFromSegment(b,a[d],a[(d+1)%a.length]),c=Math.min(e,c);return c};
PolygonTools.howFarIsPointInPolygon=function(a,b,c){return PolygonTools.isPointInPolygon(a,c)?(b=Math.sqrt(Math.pow(c[0]-b[0],2)+Math.pow(c[1]-b[1],2)),a=PolygonTools.getMinDistanceFromEdge(a,c),Math.sqrt((1-b)*a/Math.abs(b+a))):0};PolygonTools.getPolygonFunctionArgs=function(a){return[["a","b"],"return PolygonTools.isPointInPolygon("+getPolygonOrPointString(a)+", {0:a, 1:b});"]};
PolygonTools.getInterpolatedPolygonFunctionArgs=function(a){var b=getPolygonOrPointString(a);a=getPolygonOrPointString(PolygonTools.getCentroid(a));return[["a","b"],"return PolygonTools.howFarIsPointInPolygon("+b+","+a+", {0:a, 1:b});"]};function getPolygonOrPointString(a){return JSON.stringify(a).replace(/"/g,"'")};function Control(a,b,c){this.uri=a;this.name=b;this.type=c;this.observers=[]}Control.prototype.getName=function(){return this.name};Control.prototype.getUri=function(){return this.uri};Control.prototype.getValue=function(){return this.value};Control.prototype.getType=function(){return this.type};Control.prototype.setUpdateFunction=function(a){this.updateFunction=a};Control.prototype.addObserver=function(a){this.observers.push(a)};
Control.prototype.removeObserver=function(a){a=this.observers.indexOf(a);-1<a&&this.observers.splice(a,1)};Control.prototype.backpropagate=function(a,b){isFinite(a)&&(this.setValue(a,b),this.updateFunction&&this.updateFunction(this.value))};Control.prototype.updateValue=function(a){isNaN(a)||this.setValue(a)};Control.prototype.setValue=function(a,b){if(void 0==this.value||1E-6<Math.abs(a-this.value))this.value=a,this.updateMappings(b)};
Control.prototype.updateMappings=function(a){for(var b=0;b<this.observers.length;b++)this.observers[b]!=a&&this.observers[b].observedControlChanged(this.value,this)};function DymoFunction(a,b,c,d,e){this.vars=a;this.args=b;this.argTypes=c;this.body=d;this.argCache={};this.resultCache={};this.isDymoSpecificParam=[];this.observers=[];this.isUnidirectional=e;this.init()}
DymoFunction.prototype.init=function(){this.vars||(this.vars=FunctionTools.IDENTITY_JSON.args,this.body=FunctionTools.IDENTITY_JSON.body);1>=this.vars.length||this.isUnidirectional?(this.directFunction=FunctionTools.createFunction(this.vars,this.body),this.inverseFunction=FunctionTools.invertFunction(this.body)):(this.constraintFunction=LogicTools.createConstraint(this.body),this.constraintFunction||(this.directFunction=FunctionTools.createFunction(this.vars,this.body)));for(var a=0;a<this.args.length;a++)if(this.args[a].addObserver)this.args[a].addObserver(this);
else if("string"===typeof this.args[a]||this.args[a]instanceof String){var b=DYMO_STORE.findObject(this.args[a],TYPE);b==PARAMETER_TYPE||DYMO_STORE.isSubclassOf(b,PARAMETER_TYPE)?(DYMO_STORE.addTypeObserver(this.args[a],VALUE,this),this.isDymoSpecificParam[a]=!0):("string"===typeof this.args[a]||this.args[a]instanceof String)&&DYMO_STORE.addSpecificParameterObserver(this.args[a],this)}};
DymoFunction.prototype.disconnect=function(){for(var a=0;a<this.args.length;a++)if(this.args[a].removeObserver)this.args[a].removeObserver(this);else if("string"===typeof this.args[a]||this.args[a]instanceof String){var b=DYMO_STORE.findObject(this.args[a],TYPE);DYMO_STORE.isSubclassOf(b,PARAMETER_TYPE)&&DYMO_STORE.removeValueObserver(this.args[a],VALUE,this)}};DymoFunction.prototype.getArgs=function(){return this.args};DymoFunction.prototype.addObserver=function(a){this.observers.push(a)};
DymoFunction.prototype.notifyObservers=function(){var a=this;this.observers.forEach(function(b){b.observedFunctionChanged(a)})};DymoFunction.prototype.applyDirect=function(a,b,c){a=this.getArgValues(a,b,c);this.constraintFunction?(b=logic.lvar(),this.resultCache[c]=this.applyConstraint([b].concat(a),b)):this.resultCache[c]=this.directFunction.apply(this,a);return this.resultCache[c]};
DymoFunction.prototype.applyInverse=function(a,b){var c=this;if(!this.resultCache[b]||this.resultCache[b]!=a)if(this.constraintFunction){var d=this.args.filter(function(a,b){return a.backpropagate||c.argTypes[b]==PARAMETER_TYPE}),d=this.args.indexOf(d[Math.floor(Math.random()*d.length)]);b=this.getArgValues(null,null,b);var e=logic.lvar();b.splice(d,1,e);a=this.applyConstraint([a].concat(b),e);this.updateArg(d,a)}else this.inverseFunction&&this.args&&1==this.args.length&&(a=this.inverseFunction(a),
this.updateArg(0,a))};DymoFunction.prototype.updateArg=function(a,b){this.args[a].backpropagate?this.args[a].backpropagate(b,this):DYMO_STORE.setValue(this.args[a],VALUE,b)};DymoFunction.prototype.applyConstraint=function(a,b){a=logic.run(this.constraintFunction.apply(null,a),b,1);if(0<a.length&&!isNaN(a[0]))return a[0]};DymoFunction.prototype.observedControlChanged=function(a,b){b=this.args.indexOf(b);this.getArgValues(b,a,null);this.notifyObservers()};
DymoFunction.prototype.observedValueChanged=function(a,b,c){var d=this.args.indexOf(a);0>d&&(d=this.args.indexOf(b));-1<d&&(a=DYMO_STORE.findSubject(HAS_PARAMETER,a),this.getArgValues(d,c,a),this.notifyObservers())};
DymoFunction.prototype.getArgValues=function(a,b,c){var d=c?c:"";this.argCache[d]||(this.argCache[d]=[]);if(null!=a)if(this.isDymoSpecificParam[a])this.argCache[d][a]=b;else{var e=this.argCache;Object.keys(e).map(function(c){e[c][a]=b})}for(var g=0;g<this.args.length;g++)null==this.argCache[d][g]&&(this.argCache[d][g]=this.getArgValue(g,c));return this.argCache[d].slice(0)};
DymoFunction.prototype.getArgValue=function(a,b){if("string"===typeof this.args[a]||this.args[a]instanceof String){var c=DYMO_STORE.findObjectValue(this.args[a],VALUE);return null==c?DYMO_STORE.findAttributeValue(b,this.args[a]):c}return this.args[a].getValue()};DymoFunction.prototype.requestValue=function(a){for(var b=0;b<this.args.length;b++)this.args[b].requestValue&&this.args[b].requestValue();return this.applyDirect(null,null,a)};function Mapping(a,b,c,d){this.mappingFunction=a;this.mappingFunction.addObserver(this);this.parameterName=c;b&&(b.length?this.setTargetUris(b):b&&(this.targetFunction=b,this.targetFunction.addObserver(this)));this.isUnidirectional=d;this.updateAll()}
Mapping.prototype.setTargetUris=function(a){if(this.targetUris)for(var b=0,c=this.targetUris.length;b<c;b++)DYMO_STORE.removeParameterObserver(this.targetUris[b],this.parameterName,this);this.targetUris=a;b=0;for(c=this.targetUris.length;b<c;b++)DYMO_STORE.addParameterObserver(this.targetUris[b],this.parameterName,this)};
Mapping.prototype.getTargets=function(){if(this.targetUris&&0<this.targetUris.length)return this.targetUris;if(this.targetFunction){var a=DYMO_STORE.findAllSubjects(TYPE,DYMO),b=this.targetFunction;return a.filter(function(a){return b.applyDirect(null,null,a)})}};
Mapping.prototype.disconnect=function(){this.mappingFunction&&this.mappingFunction.disconnect();this.targetFunction&&this.targetFunction.disconnect();this.constraintFunction&&this.constraintFunction.disconnect();for(var a=0,b=this.targetUris.length;a<b;a++)DYMO_STORE.removeParameterObserver(this.targetUris[a],this.parameterName,this)};Mapping.prototype.updateAll=function(a,b){var c=this.getTargets();if(c)for(var d=0,e=c.length;d<e;d++)this.update(a,b,c[d]);else this.update(a,b)};
Mapping.prototype.update=function(a,b,c){a=this.mappingFunction.applyDirect(a,b,c);DYMO_STORE.setParameter(c,this.parameterName,a)};Mapping.prototype.observedValueChanged=function(a,b,c){this.isUnidirectional||b!=this.parameterName||(a=DYMO_STORE.findSubject(HAS_PARAMETER,a),this.mappingFunction.applyInverse(c,a))};Mapping.prototype.observedFunctionChanged=function(a){this.updateAll()};Mapping.prototype.requestValue=function(a){return this.mappingFunction.requestValue(a)};function Rendering(a){var b;this.play=function(){a&&DYMO_STORE.setParameter(a,PLAY,1)};this.stop=function(){a&&DYMO_STORE.setParameter(a,PLAY,0)};this.addSubsetNavigator=function(c,d){b||(b=new DymoNavigator(a));b.addSubsetNavigator(c,d)};this.getNavigator=function(){return b}};function GraphNavigator(a,b){SequentialNavigator.call(this,a,!1,b);this.getType=function(){return GRAPH_NAVIGATOR};this.getCopy=function(a,b){return new GraphNavigator(a,b)};this.getNextParts=function(){var a=SequentialNavigator.prototype.getNextParts.call(this);this.partsNavigated=this.getNextPosition(a[0]);return a};this.getNextPosition=function(a){if(a&&0<a.length&&(a=DYMO_STORE.findSuccessors(a[0]),0<a.length))return DYMO_STORE.findPartIndex(a[Math.floor(Math.random()*a.length)])}}
inheritPrototype(GraphNavigator,SequentialNavigator);function DymoNavigator(a,b,c){function d(a){for(var c=0,f=e.length;c<f;c++)if(e[c][0].applyDirect(null,null,a))return e[c][1].getCopy(a,d);return a&&b?b.getCopy(a,d):new OneShotNavigator(a)}var e=[],g;g=null;this.reset=function(a){g=null};this.addSubsetNavigator=function(a,b){e.push([a,b])};this.getSubsetNavigators=function(){return e};this.getPosition=function(a,b){};this.setPosition=function(b,c,e){e||(e=a);for(var f=0;f<=c&&e;){var g=d(e);f==c&&g.setPartsNavigated?(g.setPartsNavigated(b),this.reset(e)):
e=void 0;f++}};this.getNextParts=function(){g||(g=d(a));return g.getNextParts()[0]}};function OneShotNavigator(a){this.getNextParts=function(){return[[a],DONE]}};function SequentialNavigator(a,b,c){this.dymoUri=a;this.parts=DYMO_STORE.findParts(a);this.dymoType=DYMO_STORE.findObject(this.dymoUri,CDT);this.backwards=b;this.getNavigator=c;this.partsNavigated=0;this.currentSubNavs=null}SequentialNavigator.prototype.resetPartsNavigated=function(){this.partsNavigated=0;this.currentSubNavs=null};SequentialNavigator.prototype.setPartsNavigated=function(a){this.partsNavigated=a};SequentialNavigator.prototype.getPartsNavigated=function(){return this.partsNavigated};
SequentialNavigator.prototype.getType=function(){return SEQUENTIAL_NAVIGATOR};SequentialNavigator.prototype.getCopy=function(a,b){return new SequentialNavigator(a,this.backwards,b)};SequentialNavigator.prototype.getDymo=function(){return this.dymoUri};
SequentialNavigator.prototype.getNextParts=function(){var a=this;if(this.dymoType==CONJUNCTION){this.currentSubNavs||(this.currentSubNavs=this.parts.map(function(b){return a.getNavigator(b)}),this.doneSubNavs=new Set);var b=this.currentSubNavs.map(function(a){return a.getNextParts()}),c=b.map(function(a){return a[1]});this.currentSubNavs.filter(function(a,b){return c[b]!=MORE}).forEach(function(b){return a.doneSubNavs.add(b)});b=flattenArray(b.map(function(a){return a[0]}));return this.doneSubNavs.size<
this.currentSubNavs.length?[b,MORE]:[b,DONE]}return this.dymoType==DISJUNCTION?(this.currentSubNavs||(this.currentSubNavs=this.getRandomSubNav()),b=this.currentSubNavs.getNextParts(),b[1]!=MORE&&this.resetPartsNavigated(),b):0<this.parts.length?(this.currentSubNavs||(this.currentSubNavs=this.getNextSubNav()),b=this.currentSubNavs.getNextParts(),b[1]!=MORE&&(this.partsNavigated++,this.partsNavigated<this.parts.length?(b[1]=MORE,this.currentSubNavs=this.getNextSubNav()):(b[1]=DONE,this.resetPartsNavigated())),
b):[[this.dymoUri],DONE]};SequentialNavigator.prototype.getRandomSubNav=function(){return this.getNavigator(this.parts[Math.floor(Math.random()*this.parts.length)])};SequentialNavigator.prototype.getNextSubNav=function(){var a;if(a=this.backwards?this.parts[this.parts.length-1-this.partsNavigated]:this.parts[this.partsNavigated])return this.getNavigator(a)};function SimilarityNavigator(a,b){SequentialNavigator.call(this,a,!1,b);this.getType=function(){return SIMILARITY_NAVIGATOR};this.getCopy=function(a,b){return new SimilarityNavigator(a,b)};this.getNextParts=function(){var a=SequentialNavigator.prototype.getNextParts.call(this);a[0]=this.replaceWithSimilars(a[0]);return a};this.replaceWithSimilars=function(a){if(a){if(a&&0<a.length)for(var b=0;b<a.length;b++){var c=DYMO_STORE.findSimilars(a[b]);if(0<c.length&&Math.random()<DYMO_STORE.findParameterValue(null,
LEAPING_PROBABILITY)){var g=Math.floor(Math.random()*c.length);if(0<DYMO_STORE.findParameterValue(null,CONTINUE_AFTER_LEAPING)){var k=DYMO_STORE.findParts(this.dymoUri).indexOf(g);k&&(this.partsNavigated=k+1)}a[b]=c[g]}}return a}}}inheritPrototype(SimilarityNavigator,SequentialNavigator);function flattenArray(a){return a.reduce(function(a,c){return a.concat(Array.isArray(c)?flattenArray(c):c)},[])}function flattenArrayOnce(a){return[].concat.apply([],a)}function intersectArrays(a,b){if(a&&b){var c;b.length>a.length&&(c=b,b=a,a=c);return a.filter(function(a){if(-1!==b.indexOf(a))return!0})}return[]}function removeDuplicates(a){for(var b={},c=[],d=a.length,e=0,g=0;g<d;g++){var k=a[g];1!==b[k]&&(b[k]=1,c[e++]=k)}return c};function loadFile(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.onload=function(){b(this.responseText)};c.error=function(a){console.log(a)};c.send()};function inheritPrototype(a,b){b=Object.create(b.prototype);b.constructor=a;a.prototype=b};function Ramp(){var a,b,c=0;this.setValue=function(a){c=a};this.startOrUpdate=function(d,e,g,k){e>g&&(clearInterval(a),b=(d-c)/(e/g),a=setInterval(function(){var e=c+b;Math.abs(d-e)<Math.abs(d-c)?(c=e,k(c)):clearInterval(a)},g))}};var DataStreamControl=function(a){DataControl.call(this,a,"","")};$jscomp.inherits(DataStreamControl,DataControl);var WeatherControl=function(a){DataControl.call(this,a,"http://api.openweathermap.org/data/2.5/weather?appid=3d77879a046ee9e970e66bb2f5c5200d&q=london",function(a){return a.main.temp})};$jscomp.inherits(WeatherControl,DataControl);var BrownianControl=function(a,b){AutoControl.call(this,a,BROWNIAN);b||(b=.5);this.min=0;this.max=1;DYMO_STORE.addParameter(a,BROWNIAN_MAX_STEP_SIZE,.1,self);this.updateValue(b);DYMO_STORE.setParameter(a,AUTO_CONTROL_TRIGGER,1)};$jscomp.inherits(BrownianControl,AutoControl);BrownianControl.prototype.update=function(){var a=DYMO_STORE.findParameterValue(this.uri,BROWNIAN_MAX_STEP_SIZE),a=2*a*Math.random()-a,a=this.getValue()+a,a=Math.min(Math.max(a,this.min),this.max);this.updateValue(a)};var RampControl=function(a,b,c){AutoControl.call(this,a,RAMP);this.duration=b?b:1E4;this.currentValue=c?c:0;this.isIncreasing=1!=this.currentValue;this.updateValue(this.currentValue)};$jscomp.inherits(RampControl,AutoControl);
RampControl.prototype.update=function(){var a=1/this.duration*DYMO_STORE.findParameterValue(this.uri,AUTO_CONTROL_FREQUENCY);this.isIncreasing||(a*=-1);this.currentValue+=a;0<this.currentValue&&1>this.currentValue?this.updateValue(this.currentValue):1<=this.currentValue?(this.updateValue(1),this.reset()):0>=this.currentValue&&(this.updateValue(0),this.reset())};RampControl.prototype.reset=function(){AutoControl.prototype.reset.call(this);this.isIncreasing=!this.isIncreasing};var RandomControl=function(a){AutoControl.call(this,a,RANDOM);DYMO_STORE.setParameter(a,AUTO_CONTROL_TRIGGER,1)};$jscomp.inherits(RandomControl,AutoControl);RandomControl.prototype.update=function(){this.updateValue(Math.random())};function SoundTouch(a){this.rateTransposer=new RateTransposer(!1);this.tdStretch=new Stretch(!1,a);this._inputBuffer=new FifoSampleBuffer;this._intermediateBuffer=new FifoSampleBuffer;this._outputBuffer=new FifoSampleBuffer;this.tempo=this._rate=0;this.virtualTempo=this.virtualRate=this.virtualPitch=1;this._calculateEffectiveRateAndTempo()}
extend(SoundTouch.prototype,{clear:function(){this.rateTransposer.clear();this.tdStretch.clear()},clone:function(){var a=new SoundTouch;a.rate=this._rate;a.tempo=this.tempo;return a},get rate(){return this._rate},set rate(a){this.virtualRate=a;this._calculateEffectiveRateAndTempo()},set rateChange(a){this.rate=1+.01*a},get tempo(){return this._tempo},set tempo(a){this.virtualTempo=a;this._calculateEffectiveRateAndTempo()},set tempoChange(a){this.tempo=1+.01*a},set pitch(a){this.virtualPitch=a;this._calculateEffectiveRateAndTempo()},
set pitchOctaves(a){this.pitch=Math.exp(.69314718056*a);this._calculateEffectiveRateAndTempo()},set pitchSemitones(a){this.pitchOctaves=a/12},get inputBuffer(){return this._inputBuffer},get outputBuffer(){return this._outputBuffer},_calculateEffectiveRateAndTempo:function(){var a=this._tempo,b=this._rate;this._tempo=this.virtualTempo/this.virtualPitch;this._rate=this.virtualRate*this.virtualPitch;testFloatEqual(this._tempo,a)&&(this.tdStretch.tempo=this._tempo);testFloatEqual(this._rate,b)&&(this.rateTransposer.rate=
this._rate);1<this._rate?this._outputBuffer!=this.rateTransposer.outputBuffer&&(this.tdStretch.inputBuffer=this._inputBuffer,this.tdStretch.outputBuffer=this._intermediateBuffer,this.rateTransposer.inputBuffer=this._intermediateBuffer,this.rateTransposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.tdStretch.outputBuffer&&(this.rateTransposer.inputBuffer=this._inputBuffer,this.rateTransposer.outputBuffer=this._intermediateBuffer,this.tdStretch.inputBuffer=this._intermediateBuffer,this.tdStretch.outputBuffer=
this._outputBuffer)},process:function(){1<this._rate?(this.tdStretch.process(),this.rateTransposer.process()):(this.rateTransposer.process(),this.tdStretch.process())}});function FifoSampleBuffer(){this._vector=new Float32Array;this._frameCount=this._position=0}
FifoSampleBuffer.prototype={get vector(){return this._vector},get position(){return this._position},get startIndex(){return 2*this._position},get frameCount(){return this._frameCount},get endIndex(){return 2*(this._position+this._frameCount)},clear:function(){this.receive();this.rewind()},put:function(a){this._frameCount+=a},putSamples:function(a,b,c){b=2*(b||0);0<=c||(c=(a.length-b)/2);var d=2*c;this.ensureCapacity(c+this._frameCount);var e=this.endIndex;this._vector.set(a.subarray(b,b+d),e);this._frameCount+=
c},putBuffer:function(a,b,c){b=b||0;0<=c||(c=a.frameCount-b);this.putSamples(a.vector,a.position+b,c)},receive:function(a){if(!(0<=a)||a>this._frameCount)a=this._frameCount;this._frameCount-=a;this._position+=a},receiveSamples:function(a,b){var c=this.startIndex;a.set(this._vector.subarray(c,c+2*b));this.receive(b)},extract:function(a,b,c){b=this.startIndex+2*b;a.set(this._vector.subarray(b,b+2*c))},ensureCapacity:function(a){a*=2;this._vector.length<a?(a=new Float32Array(a),a.set(this._vector.subarray(this.startIndex,
this.endIndex)),this._vector=a,this._position=0):this.rewind()},ensureAdditionalCapacity:function(a){this.ensureCapacity(this.frameCount+a)},rewind:function(){0<this._position&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}};function extend(a,b){for(var c in b){var d=b.__lookupGetter__(c),e=b.__lookupSetter__(c);d||e?(d&&a.__defineGetter__(c,d),e&&a.__defineSetter__(c,e)):a[c]=b[c]}return a}function testFloatEqual(a,b){return 1E-10<(a>b?a-b:b-a)}
function FilterSupport(a){this._pipe=a}
FilterSupport.prototype={get pipe(){return this._pipe},get inputBuffer(){return this._pipe.inputBuffer},get outputBuffer(){return this._pipe.outputBuffer},fillOutputBuffer:function(a){for(;this.outputBuffer.frameCount<a;){this.fillInputBuffer(16-this.inputBuffer.frameCount);if(16>this.inputBuffer.frameCount)break;this._pipe.process()}},clear:function(){this._pipe.clear();this.outputBufferPosition=0},get position(){return this._position},set position(a){if(a>this._position)throw new RangeError("New position may not be greater than current position");
var b=this.outputBufferPosition-(this._position-a);if(0>b)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=b;this._position=a},get sourcePosition(){return this._sourcePosition},set sourcePosition(a){this.clear();this._sourcePosition=a},fillInputBuffer:function(a){var b=new Float32Array(2*a);a=this.sourceSound.extract(b,a,this._sourcePosition);this._sourcePosition+=a;this.inputBuffer.putSamples(b,0,a)},extract:function(a,b){this.fillOutputBuffer(this.outputBufferPosition+
b);b=Math.min(b,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(a,this.outputBufferPosition,b);a=this.outputBufferPosition+b;this.outputBufferPosition=Math.min(this.historyBufferSize,a);this.outputBuffer.receive(Math.max(a-this.historyBufferSize,0));this._position+=b;return b},handleSampleData:function(a){this.extract(a.data,4096)}};
function SimpleFilter(a,b){FilterSupport.call(this,b);this.sourceSound=a;this.historyBufferSize=22050;this._position=this.outputBufferPosition=this._sourcePosition=0}extend(SimpleFilter.prototype,FilterSupport.prototype);function AbstractFifoSamplePipe(a){a?(this.inputBuffer=new FifoSampleBuffer,this.outputBuffer=new FifoSampleBuffer):this.inputBuffer=this.outputBuffer=null}
AbstractFifoSamplePipe.prototype={get inputBuffer(){return this._inputBuffer},set inputBuffer(a){this._inputBuffer=a},get outputBuffer(){return this._outputBuffer},set outputBuffer(a){this._outputBuffer=a},clear:function(){this._inputBuffer.clear();this._outputBuffer.clear()}};function RateTransposer(a){AbstractFifoSamplePipe.call(this,a);this._reset();this.rate=1}extend(RateTransposer.prototype,AbstractFifoSamplePipe.prototype);
extend(RateTransposer.prototype,{set rate(a){this._rate=a},_reset:function(){this.prevSampleR=this.prevSampleL=this.slopeCount=0},clone:function(){var a=new RateTransposer;a.rate=this._rate;return a},process:function(){var a=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(a/this._rate+1);a=this._transpose(a);this._inputBuffer.receive();this._outputBuffer.put(a)},_transpose:function(a){if(0==a)return 0;for(var b=this._inputBuffer.vector,c=this._inputBuffer.startIndex,d=this._outputBuffer.vector,
e=this._outputBuffer.endIndex,g=0,k=0;1>this.slopeCount;)d[e+2*k]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*b[c],d[e+2*k+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*b[c+1],k++,this.slopeCount+=this._rate;--this.slopeCount;if(1!=a)a:for(;;){for(;1<this.slopeCount;)if(--this.slopeCount,g++,g>=a-1)break a;var l=c+2*g;d[e+2*k]=(1-this.slopeCount)*b[l]+this.slopeCount*b[l+2];d[e+2*k+1]=(1-this.slopeCount)*b[l+1]+this.slopeCount*b[l+3];k++;this.slopeCount+=this._rate}this.prevSampleL=
b[c+2*a-2];this.prevSampleR=b[c+2*a-1];return k}});
var USE_AUTO_SEQUENCE_LEN=0,DEFAULT_SEQUENCE_MS=USE_AUTO_SEQUENCE_LEN,USE_AUTO_SEEKWINDOW_LEN=0,DEFAULT_SEEKWINDOW_MS=USE_AUTO_SEEKWINDOW_LEN,DEFAULT_OVERLAP_MS=8,_SCAN_OFFSETS=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],AUTOSEQ_TEMPO_LOW=.5,AUTOSEQ_TEMPO_TOP=2,
AUTOSEQ_AT_MIN=125,AUTOSEQ_AT_MAX=50,AUTOSEQ_K=(AUTOSEQ_AT_MAX-AUTOSEQ_AT_MIN)/(AUTOSEQ_TEMPO_TOP-AUTOSEQ_TEMPO_LOW),AUTOSEQ_C=AUTOSEQ_AT_MIN-AUTOSEQ_K*AUTOSEQ_TEMPO_LOW,AUTOSEEK_AT_MIN=25,AUTOSEEK_AT_MAX=15,AUTOSEEK_K=(AUTOSEEK_AT_MAX-AUTOSEEK_AT_MIN)/(AUTOSEQ_TEMPO_TOP-AUTOSEQ_TEMPO_LOW),AUTOSEEK_C=AUTOSEEK_AT_MIN-AUTOSEEK_K*AUTOSEQ_TEMPO_LOW;
function Stretch(a,b){AbstractFifoSamplePipe.call(this,a);this.bQuickSeek=!0;this.bMidBufferDirty=!1;this.pMidBuffer=null;this.overlapLength=0;this.bAutoSeekSetting=this.bAutoSeqSetting=!0;this._tempo=1;this.setParameters(b,DEFAULT_SEQUENCE_MS,DEFAULT_SEEKWINDOW_MS,DEFAULT_OVERLAP_MS)}extend(Stretch.prototype,AbstractFifoSamplePipe.prototype);
extend(Stretch.prototype,{clear:function(){AbstractFifoSamplePipe.prototype.clear.call(this);this._clearMidBuffer()},_clearMidBuffer:function(){this.bMidBufferDirty&&(this.bMidBufferDirty=!1,this.pMidBuffer=null)},setParameters:function(a,b,c,d){0<a&&(this.sampleRate=a);0<d&&(this.overlapMs=d);0<b?(this.sequenceMs=b,this.bAutoSeqSetting=!1):this.bAutoSeqSetting=!0;0<c?(this.seekWindowMs=c,this.bAutoSeekSetting=!1):this.bAutoSeekSetting=!0;this.calcSeqParameters();this.calculateOverlapLength(this.overlapMs);
this.tempo=this._tempo},set tempo(a){this._tempo=a;this.calcSeqParameters();this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength);this.skipFract=0;this.sampleReq=Math.max(Math.floor(this.nominalSkip+.5)+this.overlapLength,this.seekWindowLength)+this.seekLength},get inputChunkSize(){return this.sampleReq},get outputChunkSize(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)},calculateOverlapLength:function(a){a=this.sampleRate*a/1E3;16>a&&(a=16);this.overlapLength=
a-a%8;this.pRefMidBuffer=new Float32Array(2*this.overlapLength);this.pMidBuffer=new Float32Array(2*this.overlapLength)},checkLimits:function(a,b,c){return a<b?b:a>c?c:a},calcSeqParameters:function(){var a;this.bAutoSeqSetting&&(a=AUTOSEQ_C+AUTOSEQ_K*this._tempo,a=this.checkLimits(a,AUTOSEQ_AT_MAX,AUTOSEQ_AT_MIN),this.sequenceMs=Math.floor(a+.5));this.bAutoSeekSetting&&(a=AUTOSEEK_C+AUTOSEEK_K*this._tempo,a=this.checkLimits(a,AUTOSEEK_AT_MAX,AUTOSEEK_AT_MIN),this.seekWindowMs=Math.floor(a+.5));this.seekWindowLength=
Math.floor(this.sampleRate*this.sequenceMs/1E3);this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1E3)},set quickSeek(a){this.bQuickSeek=a},clone:function(){var a=new Stretch;a.tempo=this.tempo;a.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs);return a},seekBestOverlapPosition:function(){return this.bQuickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()},seekBestOverlapPositionStereo:function(){var a,b,c,d;this.precalcCorrReferenceStereo();
b=Number.MIN_VALUE;for(d=a=0;d<this.seekLength;d++)c=this.calcCrossCorrStereo(2*d,this.pRefMidBuffer),c>b&&(b=c,a=d);return a},seekBestOverlapPositionStereoQuick:function(){var a,b,c,d,e,g,k;this.precalcCorrReferenceStereo();c=Number.MIN_VALUE;for(e=g=b=0;4>e;e++){for(a=0;_SCAN_OFFSETS[e][a];){k=g+_SCAN_OFFSETS[e][a];if(k>=this.seekLength)break;d=this.calcCrossCorrStereo(2*k,this.pRefMidBuffer);d>c&&(c=d,b=k);a++}g=b}return b},precalcCorrReferenceStereo:function(){var a,b,c;for(a=0;a<this.overlapLength;a++)c=
a*(this.overlapLength-a),b=2*a,this.pRefMidBuffer[b]=this.pMidBuffer[b]*c,this.pRefMidBuffer[b+1]=this.pMidBuffer[b+1]*c},calcCrossCorrStereo:function(a,b){var c=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var d,e,g;d=0;for(e=2;e<2*this.overlapLength;e+=2)g=e+a,d+=c[g]*b[e]+c[g+1]*b[e+1];return d},overlap:function(a){this.overlapStereo(2*a)},overlapStereo:function(a){var b=this._inputBuffer.vector;a+=this._inputBuffer.startIndex;var c=this._outputBuffer.vector,d=this._outputBuffer.endIndex,
e,g,k,l,f,n,h;l=1/this.overlapLength;for(e=0;e<this.overlapLength;e++)k=(this.overlapLength-e)*l,f=e*l,g=2*e,n=g+a,h=g+d,c[h+0]=b[n+0]*f+this.pMidBuffer[g+0]*k,c[h+1]=b[n+1]*f+this.pMidBuffer[g+1]*k},process:function(){var a,b;if(null==this.pMidBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.pMidBuffer=new Float32Array(2*this.overlapLength);this._inputBuffer.receiveSamples(this.pMidBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;)a=this.seekBestOverlapPosition(),
this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(a)),this._outputBuffer.put(this.overlapLength),b=this.seekWindowLength-2*this.overlapLength,0<b&&this._outputBuffer.putBuffer(this._inputBuffer,a+this.overlapLength,b),a=this.inputBuffer.startIndex+2*(a+this.seekWindowLength-this.overlapLength),this.pMidBuffer.set(this._inputBuffer.vector.subarray(a,a+2*this.overlapLength)),this.skipFract+=this.nominalSkip,a=Math.floor(this.skipFract),this.skipFract-=a,this._inputBuffer.receive(a)}});
extend(Stretch.prototype,{get tempo(){return this._tempo}});function assert(a,b){if(!1===a)throw Error(b);}var logic={},write="object"===typeof console&&"undefined"!==typeof console.log?console.log:function(){},inf=1/0,minus_inf=-1*inf,REAL_DOMAIN=make_domain(minus_inf,inf);function Domain(a,b){this.min=a;this.max=b}Domain.prototype.toString=function(){return"["+this.min+", "+this.max+"]"};Domain.prototype.is_member=function(a){return a>=this.min&&a<=this.max};Domain.prototype.add=function(a){return make_domain(this.min+a.min,this.max+a.max)};
Domain.prototype.sub=function(a){return make_domain(this.min-a.max,this.max-a.min)};Domain.prototype.mul=function(a){var b=[this.min*a.min,this.min*a.max,this.max*a.min,this.max*a.max];a=Math.min.apply(null,b);b=Math.max.apply(null,b);return make_domain(a,b)};
Domain.prototype.div=function(a){var b;if(0>=a.min&&0<=a.max){if(0===a.min&&0===a.max)return!1;if(0===a.min)return make_domain(Math.min(this.min/a.max,this.max/a.max),inf);if(0===a.max)return make_domain(minus_inf,Math.max(this.min/a.min,this.max/a.max))}if(!(isFinite(a.min)&&isFinite(a.max)||a.min!==minus_inf||a.max!==inf))return REAL_DOMAIN;b=[this.min/a.min,this.min/a.max,this.max/a.min,this.max/a.max];a=Math.min.apply(null,b);b=Math.max.apply(null,b);return make_domain(a,b)};
function make_domain(a,b){return new Domain(fixFloatError(a),fixFloatError(b))}function fixFloatError(a){return Math.round(1E13*a)/1E13}function intersection(a,b){var c;c=a.min<b.min?b.min:a.min;a=a.max>b.max?b.max:a.max;return a<c?!1:make_domain(c,a)}function get_domain(a,b){return logic.is_lvar(b)?(a=a.lookup_domain_binding(b))?a.val:REAL_DOMAIN:make_domain(b,b)}function Constraint(a,b,c){this.fn=a;this.args=b||[];this.name=c||""}
Constraint.prototype.toString=function(){return"["+this.name+" "+this.args+"]"};Constraint.prototype.proc=function(a){return this.fn.apply(null,this.args)(a)};function make_constraint(a,b,c){assert("function"===typeof a,"#1 of make-constraint is function");assert("object"===typeof b,"#2 of make-constraint is array");return new Constraint(a,b,c)}function run_constraints(a,b){for(;!a.is_empty();){b=a.first.proc(b);if(!1===b)return!1;a=a.rest}return b}
function less_equal_c(a,b){return function(c){var d=c.walk(a),e=c.walk(b),d=get_domain(c,d),g=get_domain(c,e);return(e=intersection(d,make_domain(minus_inf,g.max)))?(d=intersection(g,make_domain(d.min,inf)))?c.extend_domain(a,e).extend_domain(b,d):!1:!1}}
function add_c(a,b,c){return function(d){var e=d.walk(a),g=d.walk(b),k=d.walk(c),e=get_domain(d,e),g=get_domain(d,g),k=get_domain(d,k);if(k=intersection(k,e.add(g)))if(e=intersection(e,k.sub(g)))if(g=intersection(g,k.sub(e)))return d.extend_domain(a,e).extend_domain(b,g).extend_domain(c,k);return!1}}
function mul_c(a,b,c){return function(d){var e=d.walk(a),g=d.walk(b),k=d.walk(c),e=get_domain(d,e),g=get_domain(d,g),k=get_domain(d,k);if(k=intersection(k,e.mul(g)))if(e=intersection(e,k.div(g)))if(g=intersection(g,k.div(e)))return d.extend_domain(a,e).extend_domain(b,g).extend_domain(c,k);return!1}}
var clpr={dom:function(a,b,c){assert("number"===typeof b&&"number"===typeof c,"#2-3 arguments of dom must be number.");return function(d){var e=make_domain(b,c);d.walk(a);var g=get_domain(d,a);return(e=intersection(g,e))?logic.win(d.extend_domain(a,e)):logic.fail()}},add:function(a,b,c){return goal_construct(add_c,[a,b,c],"+")},sub:function(a,b,c){return clpr.add(c,b,a)},mul:function(a,b,c){return goal_construct(mul_c,[a,b,c],"*")},div:function(a,b,c){return clpr.mul(c,b,a)},less_equal:function(a,
b){return goal_construct(less_equal_c,[a,b],"<=")},make_domain:make_domain,intersection:intersection,get_domain:get_domain};function goal_construct(a,b,c){var d=make_constraint(a,b,c);return function(a){a=a.extend_constraint(d);return(a=d.proc(a))?logic.win(a):logic.fail()}}clpr.REAL_DOMAIN=REAL_DOMAIN;logic.dom=clpr.dom;logic.add=clpr.add;logic.sub=clpr.sub;logic.mul=clpr.mul;logic.div=clpr.div;logic.less_equal=clpr.less_equal;logic.clpr=clpr;
function List(a,b){this.first=a;this.rest=b;this.type="list"}
List.prototype={is_empty:function(){return"undefined"===typeof this.rest},append:function(a){return this.is_empty()?a:logic.make_list(this.first,this.append(a))},interleave:function(a){return this.is_empty()?a:logic.make_list(this.first,a.interleave(this.rest))},forEach:function(a){this.is_empty()||(a(this.first),this.rest.forEach(a))},foldr:function(a,b){return this.is_empty()?b:a(this.first,this.rest.foldr(a,b))},map:function(a){if(this.is_empty())return EMPTY_STREAM;var b=this.rest.map(a);return logic.make_list(a(this.first),
b)},extend:function(a){return logic.make_list(a,this)},toString:function(){for(var a="|",b=this;!b.is_empty();)a+=b.first.toString()+(b.rest.is_empty()?"":"; "),b=b.rest;return a+"|"},write:function(){write(this.toString())}};List.prototype.walk=function(a){var b=this,c=b;if(logic.is_lvar(a))for(;!b.is_empty();){var d=b.first;if(d.variable===a)return c.walk(d.val);b=b.rest}return a};function Package(a,b,c){this.frame=a;this.store=b;this.domains=c;this.type="package"}
Package.prototype.lookup_binding_helper=function(a,b){return a===EMPTY_LIST?!1:a.first.variable===b?a.first:this.lookup_binding_helper(a.rest,b)};Package.prototype.lookup_binding=function(a){return this.lookup_binding_helper(this.frame,a)};Package.prototype.lookup_domain_binding=function(a){return this.lookup_binding_helper(this.domains,a)};Package.prototype.is_empty=function(){return this.frame.is_empty(arguments)};Package.prototype.set_frame=function(a){return logic.make_package(a,this.store,this.domains)};
Package.prototype.extend_binding=function(a,b){return logic.make_package(this.frame.extend(logic.make_binding(a,b),this.store,this.domains),this.store,this.domains)};Package.prototype.extend_domain=function(a,b){return b.min===b.max?logic.is_lvar(a)?this.extend_binding(a,b.min):this:new Package(this.frame,this.store,this.domains.extend(logic.make_binding(a,b)))};Package.prototype.extend_constraint=function(a){return logic.make_package(this.frame,this.store.extend(a),this.domains)};
Package.prototype.extend=function(){return logic.make_package(this.frame.extend(arguments),this.store,this.domains)};Package.prototype.toString=function(){return"{"+(this.frame.is_empty()?"":this.frame.toString()+(this.store.is_empty()?"":", "))+(this.store.is_empty()?"":this.store+", ")+(this.domains.is_empty()?"":this.domains)+"}"};Package.prototype.write=function(){write(this.toString())};Package.prototype.walk=function(a){return this.frame.walk(a)};
Package.prototype.get_value=function(a){if(!logic.is_lvar(a))return a;var b=this.lookup_binding(a).val;return"undefined"===typeof b?this.lookup_domain_binding(a).val:b};function Stream(a,b){this.first=a;this.rest=b;this.type="stream"}
Stream.prototype={is_empty:function(){return"undefined"===typeof this.rest},iterate:function(a,b,c){c=c||0;c>=b||this.is_empty()||(a(this.first),this.rest().iterate(a,b,c+1))},forEach:function(a){this.is_empty()||(a(this.first),this.rest().iterate(a))},foldr:function(a,b){return this.is_empty()?b:a(this.first,this.rest().foldr(a,b))},map:function(a){if(this.is_empty())return EMPTY_STREAM;var b=this.rest().map(a);return logic.make_stream(a(this.first),function(){return b})},flatten:function(){if(this.is_empty())return this;
if(logic.is_stream(this.first)){var a=this.first,b=this.rest();return a.append(b.flatten())}return logic.make_stream(this.first).append(this.rest().flatten())},append:function(a){var b=this;return b.is_empty()?a:logic.make_stream(b.first,function(){return b.rest().append(a)})},interleave:function(a){var b=this;return b.is_empty()?a:logic.make_stream(b.first,function(){return a.interleave(b.rest())})},extend:function(a){var b=this;return logic.make_stream(a,function(){return b})},toString:function(){for(var a=
"(",b=this;!b.is_empty();)a+=b.first.toString()+(b.rest().is_empty()?"":", "),b=b.rest();return a+")"},write:function(){write(this.toString())}};function Binding(a,b){this.variable=a;this.val=b;this.type="binding"}Binding.prototype.toString=function(){return("undefined"!==typeof this.variable.name?this.variable.name:"_")+"="+this.val.toString()};var EMPTY_STREAM=new Stream(void 0,void 0),EMPTY_LIST=new List(void 0,void 0),EMPTY_PACKAGE=new Package(EMPTY_LIST,EMPTY_LIST,EMPTY_LIST);logic.nil=EMPTY_PACKAGE;
logic.EMPTY_STREAM=EMPTY_STREAM;logic.EMPTY_LIST=EMPTY_LIST;function has_type(a,b){return"object"===typeof a&&"undefined"!==typeof a.type&&a.type===b}logic.is_stream=function(a){return has_type(a,"stream")};logic.is_list=function(a){return has_type(a,"list")};logic.is_package=function(a){return has_type(a,"package")};logic.is_binding=function(a){return has_type(a,"binding")};logic.is_lvar=function(a){return has_type(a,"logic_var")};logic.is_logic_list=function(a){return has_type(a,"logic_list")};
logic.is_array=function(a){return"[object Array]"===Object.prototype.toString.call(a)};logic.is_object=function(a){return"[object Object]"===Object.prototype.toString.call(a)};logic.lvar=function(a){return{type:"logic_var",name:a}};logic.list=function(){var a=Array.prototype.slice.call(arguments);a.type="logic_list";return a};logic.make_binding=function(a,b,c){return new Binding(a,b)};
logic.make_stream=function(a,b){"undefined"===typeof b&&(b=function(){return EMPTY_STREAM});assert("function"===typeof b,"#2 argument must be function.");return new Stream(a,b)};logic.make_list=function(a,b){"undefined"===typeof b&&(b=EMPTY_LIST);assert("object"===typeof b,"#2 argument must be object.");return new List(a,b)};
logic.make_package=function(a,b,c){assert(logic.is_list(a),"#1 argument of package must be list");assert(logic.is_list(b),"#2 argument of package must be list");assert(logic.is_list(c),"#3 argument of package must be list");return new Package(a,b,c)};
logic.unify=function(a,b,c){if(!1===c)return!1;a=c.walk(a);b=c.walk(b);if(a===b)return c;if(logic.is_lvar(a))return c.extend(logic.make_binding(a,b));if(logic.is_lvar(b))return c.extend(logic.make_binding(b,a));if(logic.is_logic_list(a)&&logic.is_logic_list(b)){if(a.length!==b.length)return!1;for(var d=0;d<a.length;++d)c=logic.unify(a[d],b[d],c);return c}return!1};
logic.eq=function(a,b){return function(c){var d=c.frame,e=logic.unify(a,b,d);if(e){var g=c.set_frame(e);return d==e||c.store.is_empty()?logic.win(g):(c=run_constraints(g.store,g))?logic.win(c):logic.fail()}return logic.fail()}};logic.win=function(a){return logic.make_stream(a||logic.nil)};logic.fail=function(){return EMPTY_STREAM};logic.disj=function(a,b){return function(c){return a(c).append(b(c))}};
logic.or=function(){var a=Array.prototype.slice.call(arguments);return 0===a.length?logic.fail:1===a.length?a[0]:logic.disj(a[0],logic.or.apply(null,a.slice(1)))};logic.conj=function(a,b){return function(c){return a(c).map(function(a){return b(a)}).flatten()}};logic.and=function(){var a=Array.prototype.slice.call(arguments);return 0===a.length?logic.win:1===a.length?a[0]:logic.conj(a[0],logic.and.apply(null,a.slice(1)))};
logic.implies=function(a,b,c){return function(d){var e=a(d);return e.is_empty()?c?c(d):logic.win(d):e.map(function(a){return b(a)}).flatten()}};var _between=function(a,b,c){return a>b?logic.fail:logic.disj(logic.eq(c,a),logic.between(a+1,b,c))};logic.between=function(a,b,c){assert("number"===typeof a,"#1 argument of between is number");assert("number"===typeof b,"#2 argument of between is number");return _between(a,b,c)};
logic.run=function(a,b,c){assert(logic.is_lvar(b)||logic.is_array(b),"#2 of run must be variable/array");c="undefined"===typeof c?inf:c;a=a(logic.nil);for(var d=[],e=0;e<c&&!a.is_empty();++e){var g=a.first,k=g.frame;if(logic.is_lvar(b)){var l=k.walk(b),l=logic.is_lvar(l)?g.get_value(b):l;d.push(l)}else{for(var f=[],n=0;n<b.length;++n)l=k.walk(b[n]),l=logic.is_lvar(l)?g.get_value(l):l,f.push(l);d.push(f)}a=a.rest()}return d};
